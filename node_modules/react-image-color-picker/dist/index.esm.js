import n,{useRef as t,useState as e,useEffect as i}from"react";import o from"styled-components";function r(n,t,e,i){return new(e||(e=Promise))((function(o,r){function a(n){try{s(i.next(n))}catch(n){r(n)}}function c(n){try{s(i.throw(n))}catch(n){r(n)}}function s(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(a,c)}s((i=i.apply(n,t||[])).next())}))}function a(n,t){var e,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(e=1,i&&(o=2&c[0]?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(n,a)}catch(n){c=[6,n],i=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}function c(n,t){var e="function"==typeof Symbol&&n[Symbol.iterator];if(!e)return n;var i,o,r=e.call(n),a=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(n){o={error:n}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(o)throw o.error}}return a}function s(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}var l,u,d,h=o.div(l||(l=s(["\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  width: 40px;\n  height: 40px;\n  border-radius: 10px;\n  border: 3px solid white;\n  z-index: 100;\n\n  @media (max-width: 768px) {\n    width: 30px;\n    height: 30px;\n  }\n"],["\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  width: 40px;\n  height: 40px;\n  border-radius: 10px;\n  border: 3px solid white;\n  z-index: 100;\n\n  @media (max-width: 768px) {\n    width: 30px;\n    height: 30px;\n  }\n"]))),p=function(t){var e=t.color;return n.createElement(h,{"data-testid":"color-preview",style:{backgroundColor:e}})},f=o.div(u||(u=s(["\n  position: absolute;\n  top: 10px;\n  left: 10px;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  z-index: 100;\n"],["\n  position: absolute;\n  top: 10px;\n  left: 10px;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  z-index: 100;\n"]))),v=o.div(d||(d=s(["\n  width: 100px;\n  height: 100px;\n  box-shadow: 1px 1px 1px #000;\n  border: 4px solid red;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  @media (max-width: 768px) {\n    width: 60px;\n    height: 60px;\n  }\n"],["\n  width: 100px;\n  height: 100px;\n  box-shadow: 1px 1px 1px #000;\n  border: 4px solid red;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  @media (max-width: 768px) {\n    width: 60px;\n    height: 60px;\n  }\n"]))),x=function(){function n(n){this.canvas=n,this.context=this.canvas.getContext("2d",{willReadFrequently:!0})}return n.prototype.listenMovements=function(n){this.canvas.addEventListener("touchmove",n),this.canvas.addEventListener("pointermove",n)},n.prototype.cleanUp=function(n){this.canvas.removeEventListener("touchmove",n),this.canvas.addEventListener("pointermove",n)},n.prototype.drawImage=function(n){this.context.drawImage(n,0,0)},n.prototype.setDimensions=function(n,t){this.canvas.width=n,this.canvas.height=t},n.prototype.getDimensions=function(){return{width:this.canvas.width,height:this.canvas.height}},n.prototype.getCanvasCenterPoint=function(){return{x:this.canvas.width/2,y:this.canvas.height/2}},n.prototype.getCanvasCoordinates=function(n){var t=this.canvas.getBoundingClientRect(),e=this.canvas.width/t.width,i=this.canvas.height/t.height;return{x:(n.x-t.left)*e,y:(n.y-t.top)*i}},n.prototype.getPixelColor=function(n){var t=this.context.getImageData(n.x,n.y,1,1).data;if(t.length<4)return"rgb(0,0,0)";var e=c(t,3),i=e[0],o=e[1],r=e[2];return"rgb(".concat(i,", ").concat(o,", ").concat(r,")")},n}();var m,g,w=function(t){var o=t.color,r=t.coordinates,a=t.dimensions,s=t.image,l=t.zoom,u=void 0===l?.5:l,d=function(){var n=c(e(!0),2),t=n[0],o=n[1];return i((function(){if("undefined"!=typeof window){var n=window.matchMedia("(max-width: 768px)");o(n.matches);var t=function(n){o(n.matches)};return n.addEventListener("change",t),function(){n.removeEventListener("change",t)}}}),[]),t}(),h=r.x,p=r.y,x=u,m=d?30:50,g=a.width*x,w=a.height*x,y=h*x-m,b=p*x-m;return n.createElement(n.Fragment,null,n.createElement(f,{"data-testid":"zoom-preview-container"},n.createElement(v,{"data-testid":"zoom-preview",style:{backgroundSize:"".concat(g,"px ").concat(w,"px"),backgroundImage:"url(".concat(s,")"),backgroundRepeat:"no-repeat",backgroundPosition:"-".concat(y,"px -").concat(b,"px"),borderColor:o}})))},y=o.canvas(m||(m=s(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  z-index: 50;\n  touch-action: none;\n  object-fit: cover;\n"],["\n  position: relative;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  z-index: 50;\n  touch-action: none;\n  object-fit: cover;\n"]))),b=o.div(g||(g=s(["\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n"],["\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n"]))),C=function(o){var s=o.onColorPick,l=o.imgSrc,u=o.zoom,d=t(null),h=function(n,o){var s,l,u=t(null),d=c(e("tranparent"),2),h=d[0],p=d[1],f=c(e({x:0,y:0}),2),v=f[0],m=f[1],g=function(n){n.preventDefault();var t="touches"in n?n.touches[0]:n,e={x:t.clientX,y:t.clientY},i=u.current,o=i.getCanvasCoordinates(e),r=i.getPixelColor(o);p(r),m(o)};return i((function(){null===u.current&&(u.current=new x(n.current),u.current.listenMovements(g));var t=u.current;return function(){r(this,void 0,void 0,(function(){var n,e,i;return a(this,(function(c){switch(c.label){case 0:return[4,(s=o,r(void 0,void 0,void 0,(function(){return a(this,(function(n){return[2,new Promise((function(n){var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){return n(t)},t.src=s}))]}))})))];case 1:return n=c.sent(),t.setDimensions(n.width,n.height),t.drawImage(n),e=t.getCanvasCenterPoint(),i=t.getPixelColor(e),p(i),m(e),[2]}var s}))}))}(),function(){t.cleanUp(g)}}),[o]),{color:h,coordinates:v,dimensions:null!==(l=null===(s=u.current)||void 0===s?void 0:s.getDimensions())&&void 0!==l?l:{width:0,height:0}}}(d,l),f=h.color,v=h.coordinates,m=h.dimensions;return n.createElement(b,{"data-testid":"image-color-pick-container"},n.createElement(p,{color:f}),n.createElement(w,{zoom:u,color:f,coordinates:v,dimensions:m,image:l}),n.createElement(y,{"data-testid":"image-color-pick-canvas",id:"image-color-pick-canvas",ref:d,onClick:function(){return s(f)},onTouchEnd:function(){return s(f)}}))};export{C as ImageColorPicker};
//# sourceMappingURL=index.esm.js.map
