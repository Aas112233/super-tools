var qy=Object.defineProperty;var Xy=(l,t,e)=>t in l?qy(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var I=(l,t,e)=>(Xy(l,typeof t!="symbol"?t+"":t,e),e),bf=(l,t,e)=>{if(!t.has(l))throw TypeError("Cannot "+e)};var a=(l,t,e)=>(bf(l,t,"read from private field"),e?e.call(l):t.get(l)),f=(l,t,e)=>{if(t.has(l))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(l):t.set(l,e)},g=(l,t,e,i)=>(bf(l,t,"write to private field"),i?i.call(l,e):t.set(l,e),e);var fe=(l,t,e,i)=>({set _(s){g(l,t,s,e)},get _(){return a(l,t,i)}}),v=(l,t,e)=>(bf(l,t,"access private method"),e);import{c as al,g as av,r as L,R as Yy}from"./vendor-8a332d8f.js";import{j as R}from"./index-425a4db3.js";import{_ as nr}from"./tslib.es6-1f0a9ae4.js";import{aa as Ky,a3 as rv,at as Jy,X as Qy,E as Zy,au as tx,C as ex,av as ix,aw as sx,R as nx,a1 as ax,ab as rx,ax as ox}from"./ui-86c81d4e.js";import{_ as lx}from"./router-2c18f3be.js";var ov={exports:{}};(function(l,t){(function(e,i){i()})(al,function(){function e(h,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,d,u){var p=new XMLHttpRequest;p.open("GET",h),p.responseType="blob",p.onload=function(){c(p.response,d,u)},p.onerror=function(){console.error("could not download file")},p.send()}function s(h){var d=new XMLHttpRequest;d.open("HEAD",h,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function n(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(d)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof al=="object"&&al.global===al?al:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(h,d,u){var p=r.URL||r.webkitURL,m=document.createElement("a");d=d||h.name||"download",m.download=d,m.rel="noopener",typeof h=="string"?(m.href=h,m.origin===location.origin?n(m):s(m.href)?i(h,d,u):n(m,m.target="_blank")):(m.href=p.createObjectURL(h),setTimeout(function(){p.revokeObjectURL(m.href)},4e4),setTimeout(function(){n(m)},0))}:"msSaveOrOpenBlob"in navigator?function(h,d,u){if(d=d||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(e(h,u),d);else if(s(h))i(h,d,u);else{var p=document.createElement("a");p.href=h,p.target="_blank",setTimeout(function(){n(p)})}}:function(h,d,u,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof h=="string")return i(h,d,u);var m=h.type==="application/octet-stream",y=/constructor/i.test(r.HTMLElement)||r.safari,b=/CriOS\/[\d]+/.test(navigator.userAgent);if((b||m&&y||o)&&typeof FileReader<"u"){var x=new FileReader;x.onloadend=function(){var A=x.result;A=b?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=A:location=A,p=null},x.readAsDataURL(h)}else{var w=r.URL||r.webkitURL,E=w.createObjectURL(h);p?p.location=E:location.href=E,p=null,setTimeout(function(){w.revokeObjectURL(E)},4e4)}});r.saveAs=c.saveAs=c,l.exports=c})})(ov);var G0=ov.exports,lv={exports:{}},cx="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",hx=cx,dx=hx;function cv(){}function hv(){}hv.resetWarningCache=cv;var ux=function(){function l(i,s,n,r,o,c){if(c!==dx){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}l.isRequired=l;function t(){return l}var e={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:t,element:l,elementType:l,instanceOf:t,node:l,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:hv,resetWarningCache:cv};return e.PropTypes=e,e};lv.exports=ux();var px=lv.exports;const dt=av(px),fx=new Map([["1km","application/vnd.1000minds.decision-model+xml"],["3dml","text/vnd.in3d.3dml"],["3ds","image/x-3ds"],["3g2","video/3gpp2"],["3gp","video/3gp"],["3gpp","video/3gpp"],["3mf","model/3mf"],["7z","application/x-7z-compressed"],["7zip","application/x-7z-compressed"],["123","application/vnd.lotus-1-2-3"],["aab","application/x-authorware-bin"],["aac","audio/x-acc"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abw","application/x-abiword"],["ac","application/vnd.nokia.n-gage.ac+xml"],["ac3","audio/ac3"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acu","application/vnd.acucobol"],["acutc","application/vnd.acucorp"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afm","application/x-font-type1"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/pdf"],["aif","audio/x-aiff"],["aifc","audio/x-aiff"],["aiff","audio/x-aiff"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["amr","audio/amr"],["apk","application/vnd.android.package-archive"],["apng","image/apng"],["appcache","text/cache-manifest"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["arc","application/x-freearc"],["arj","application/x-arj"],["asc","application/pgp-signature"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asx","video/x-ms-asf"],["atc","application/vnd.acucorp"],["atom","application/atom+xml"],["atomcat","application/atomcat+xml"],["atomdeleted","application/atomdeleted+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au","audio/x-au"],["avi","video/x-msvideo"],["avif","image/avif"],["aw","application/applixware"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azv","image/vnd.airzip.accelerator.azv"],["azw","application/vnd.amazon.ebook"],["b16","image/vnd.pco.b16"],["bat","application/x-msdownload"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bdoc","application/x-bdoc"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin","application/octet-stream"],["blb","application/x-blorb"],["blorb","application/x-blorb"],["bmi","application/vnd.bmi"],["bmml","application/vnd.balsamiq.bmml+xml"],["bmp","image/bmp"],["book","application/vnd.framemaker"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bpk","application/octet-stream"],["bpmn","application/octet-stream"],["bsp","model/vnd.valve.source.compiled-map"],["btif","image/prs.btif"],["buffer","application/octet-stream"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c","text/x-c"],["c4d","application/vnd.clonk.c4group"],["c4f","application/vnd.clonk.c4group"],["c4g","application/vnd.clonk.c4group"],["c4p","application/vnd.clonk.c4group"],["c4u","application/vnd.clonk.c4group"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["cab","application/vnd.ms-cab-compressed"],["caf","audio/x-caf"],["cap","application/vnd.tcpdump.pcap"],["car","application/vnd.curl.car"],["cat","application/vnd.ms-pki.seccat"],["cb7","application/x-cbr"],["cba","application/x-cbr"],["cbr","application/x-cbr"],["cbt","application/x-cbr"],["cbz","application/x-cbr"],["cc","text/x-c"],["cco","application/x-cocoa"],["cct","application/x-director"],["ccxml","application/ccxml+xml"],["cdbcmsg","application/vnd.contact.cmsg"],["cda","application/x-cdf"],["cdf","application/x-netcdf"],["cdfx","application/cdfx+xml"],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdr","application/cdr"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer","application/pkix-cert"],["cfs","application/x-cfs-compressed"],["cgm","image/cgm"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cjs","application/node"],["cla","application/vnd.claymore"],["class","application/octet-stream"],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod","application/vnd.rim.cod"],["coffee","text/coffeescript"],["com","application/x-msdownload"],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt","application/mac-compactpro"],["crd","application/x-mscardfile"],["crl","application/pkix-crl"],["crt","application/x-x509-ca-cert"],["crx","application/x-chrome-extension"],["cryptonote","application/vnd.rig.cryptonote"],["csh","application/x-csh"],["csl","application/vnd.citationstyles.style+xml"],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["csr","application/octet-stream"],["css","text/css"],["cst","application/x-director"],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxt","application/x-director"],["cxx","text/x-c"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["dart","application/vnd.dart"],["dataless","application/vnd.fdsn.seed"],["davmount","application/davmount+xml"],["dbf","application/vnd.dbf"],["dbk","application/docbook+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["ddf","application/vnd.syncml.dmddf+xml"],["dds","image/vnd.ms-dds"],["deb","application/x-debian-package"],["def","text/plain"],["deploy","application/octet-stream"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dgc","application/x-dgc-compressed"],["dic","text/x-c"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["disposition-notification","message/disposition-notification"],["dist","application/octet-stream"],["distz","application/octet-stream"],["djv","image/vnd.djvu"],["djvu","image/vnd.djvu"],["dll","application/octet-stream"],["dmg","application/x-apple-diskimage"],["dmn","application/octet-stream"],["dmp","application/vnd.tcpdump.pcap"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.template.macroEnabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroEnabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp","application/vnd.osgi.dp"],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drle","image/dicom-rle"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dvb","video/vnd.dvb.file"],["dvi","application/x-dvi"],["dwd","application/atsc-dwd+xml"],["dwf","model/vnd.dwf"],["dwg","image/vnd.dwg"],["dxf","image/vnd.dxf"],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ear","application/java-archive"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["ecma","application/ecmascript"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["elc","application/octet-stream"],["emf","image/emf"],["eml","message/rfc822"],["emma","application/emma+xml"],["emotionml","application/emotionml+xml"],["emz","application/x-msmetafile"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es","application/ecmascript"],["es3","application/vnd.eszigno3+xml"],["esa","application/vnd.osgi.subsystem"],["esf","application/vnd.epson.esf"],["et3","application/vnd.eszigno3+xml"],["etx","text/x-setext"],["eva","application/x-eva"],["evy","application/x-envoy"],["exe","application/octet-stream"],["exi","application/exi"],["exp","application/express"],["exr","image/aces"],["ext","application/vnd.novadigm.ext"],["ez","application/andrew-inset"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f","text/x-fortran"],["f4v","video/mp4"],["f77","text/x-fortran"],["f90","text/x-fortran"],["fbs","image/vnd.fastbidsheet"],["fcdt","application/vnd.adobe.formscentral.fcdt"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fdt","application/fdt+xml"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fgd","application/x-director"],["fh","image/x-freehand"],["fh4","image/x-freehand"],["fh5","image/x-freehand"],["fh7","image/x-freehand"],["fhc","image/x-freehand"],["fig","application/x-xfig"],["fits","image/fits"],["flac","audio/x-flac"],["fli","video/x-fli"],["flo","application/vnd.micrografx.flo"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fnc","application/vnd.frogans.fnc"],["fo","application/vnd.software602.filler.form+xml"],["for","text/x-fortran"],["fpx","image/vnd.fpx"],["frame","application/vnd.framemaker"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fxpl","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gam","application/x-tads"],["gbr","application/rpki-ghostbusters"],["gca","application/x-gca-compressed"],["gdl","model/vnd.gdl"],["gdoc","application/vnd.google-apps.document"],["geo","application/vnd.dynageo"],["geojson","application/geo+json"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["glb","model/gltf-binary"],["gltf","model/gltf+json"],["gml","application/gml+xml"],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gpg","application/gpg-keys"],["gph","application/vnd.flographit"],["gpx","application/gpx+xml"],["gqf","application/vnd.grafeq"],["gqs","application/vnd.grafeq"],["gram","application/srgs"],["gramps","application/x-gramps-xml"],["gre","application/vnd.geometry-explorer"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsf","application/x-font-ghostscript"],["gsheet","application/vnd.google-apps.spreadsheet"],["gslides","application/vnd.google-apps.presentation"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxf","application/gxf"],["gxt","application/vnd.geonext"],["gz","application/gzip"],["gzip","application/gzip"],["h","text/x-c"],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hbs","text/x-handlebars-template"],["hdd","application/x-virtualbox-hdd"],["hdf","application/x-hdf"],["heic","image/heic"],["heics","image/heic-sequence"],["heif","image/heif"],["heifs","image/heif-sequence"],["hej2","image/hej2k"],["held","application/atsc-held+xml"],["hh","text/x-c"],["hjson","application/hjson"],["hlp","application/winhlp"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx","application/mac-binhex40"],["hsj2","image/hsj2"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["icm","application/vnd.iccprofile"],["ico","image/x-icon"],["ics","text/calendar"],["ief","image/ief"],["ifb","text/calendar"],["ifm","application/vnd.shana.informed.formdata"],["iges","model/iges"],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs","model/iges"],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["img","application/octet-stream"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["in","text/plain"],["ini","text/plain"],["ink","application/inkml+xml"],["inkml","application/inkml+xml"],["install","application/x-install-instructions"],["iota","application/vnd.astraea-software.iota"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["iso","application/x-iso9660-image"],["itp","application/vnd.shana.informed.formtemplate"],["its","application/its+xml"],["ivp","application/vnd.immervision-ivp"],["ivu","application/vnd.immervision-ivu"],["jad","text/vnd.sun.j2me.app-descriptor"],["jade","text/jade"],["jam","application/vnd.jam"],["jar","application/java-archive"],["jardiff","application/x-java-archive-diff"],["java","text/x-java-source"],["jhc","image/jphc"],["jisp","application/vnd.jisp"],["jls","image/jls"],["jlt","application/vnd.hp-jlyt"],["jng","image/x-jng"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jp2","image/jp2"],["jpe","image/jpeg"],["jpeg","image/jpeg"],["jpf","image/jpx"],["jpg","image/jpeg"],["jpg2","image/jp2"],["jpgm","video/jpm"],["jpgv","video/jpeg"],["jph","image/jph"],["jpm","video/jpm"],["jpx","image/jpx"],["js","application/javascript"],["json","application/json"],["json5","application/json5"],["jsonld","application/ld+json"],["jsonl","application/jsonl"],["jsonml","application/jsonml+json"],["jsx","text/jsx"],["jxr","image/jxr"],["jxra","image/jxra"],["jxrs","image/jxrs"],["jxs","image/jxs"],["jxsc","image/jxsc"],["jxsi","image/jxsi"],["jxss","image/jxss"],["kar","audio/midi"],["karbon","application/vnd.kde.karbon"],["kdb","application/octet-stream"],["kdbx","application/x-keepass2"],["key","application/x-iwork-keynote-sffkey"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["knp","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["kpt","application/vnd.kde.kpresenter"],["kpxx","application/vnd.ds-keypoint"],["ksp","application/vnd.kde.kspread"],["ktr","application/vnd.kahootz"],["ktx","image/ktx"],["ktx2","image/ktx2"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["kwt","application/vnd.kde.kword"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["less","text/less"],["lgr","application/lgr+xml"],["lha","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["list3820","application/vnd.ibm.modcap"],["listafp","application/vnd.ibm.modcap"],["litcoffee","text/coffeescript"],["lnk","application/x-ms-shortcut"],["log","text/plain"],["lostxml","application/lost+xml"],["lrf","application/octet-stream"],["lrm","application/vnd.ms-lrm"],["ltf","application/vnd.frogans.ltf"],["lua","text/x-lua"],["luac","application/x-lua-bytecode"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh","application/octet-stream"],["m1v","video/mpeg"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3a","audio/mpeg"],["m3u","text/plain"],["m3u8","application/vnd.apple.mpegurl"],["m4a","audio/x-m4a"],["m4p","application/mp4"],["m4s","video/iso.segment"],["m4u","application/vnd.mpegurl"],["m4v","video/x-m4v"],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m21","application/mp21"],["ma","application/mathematica"],["mads","application/mads+xml"],["maei","application/mmt-aei+xml"],["mag","application/vnd.ecowin.chart"],["maker","application/vnd.framemaker"],["man","text/troff"],["manifest","text/cache-manifest"],["map","application/json"],["mar","application/octet-stream"],["markdown","text/markdown"],["mathml","application/mathml+xml"],["mb","application/mathematica"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc1","application/vnd.medcalcdata"],["mcd","application/vnd.mcd"],["mcurl","text/vnd.curl.mcurl"],["md","text/markdown"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["mdx","text/mdx"],["me","text/troff"],["mesh","model/mesh"],["meta4","application/metalink4+xml"],["metalink","application/metalink+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mft","application/rpki-manifest"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mid","audio/midi"],["midi","audio/midi"],["mie","application/x-mie"],["mif","application/vnd.mif"],["mime","message/rfc822"],["mj2","video/mj2"],["mjp2","video/mj2"],["mjs","application/javascript"],["mk3d","video/x-matroska"],["mka","audio/x-matroska"],["mkd","text/x-markdown"],["mks","video/x-matroska"],["mkv","video/x-matroska"],["mlp","application/vnd.dolby.mlp"],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mmf","application/vnd.smaf"],["mml","text/mathml"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mng","video/x-mng"],["mny","application/x-msmoney"],["mobi","application/x-mobipocket-ebook"],["mods","application/mods+xml"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2","audio/mpeg"],["mp2a","audio/mpeg"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mp4a","audio/mp4"],["mp4s","application/mp4"],["mp4v","video/mp4"],["mp21","application/mp21"],["mpc","application/vnd.mophun.certificate"],["mpd","application/dash+xml"],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg","video/mpeg"],["mpg4","video/mp4"],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/vnd.ms-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","text/troff"],["mscml","application/mediaservercontrol+xml"],["mseed","application/vnd.fdsn.mseed"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msi","application/x-msdownload"],["msl","application/vnd.mobius.msl"],["msm","application/octet-stream"],["msp","application/octet-stream"],["msty","application/vnd.muvee.style"],["mtl","model/mtl"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musd","application/mmt-usd+xml"],["musicxml","application/vnd.recordare.musicxml+xml"],["mvb","application/x-msmediaview"],["mvt","application/vnd.mapbox-vector-tile"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxmf","audio/mobile-xmf"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nb","application/mathematica"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncx","application/x-dtbncx+xml"],["nfo","text/x-nfo"],["ngdat","application/vnd.nokia.n-gage.data"],["nitf","application/vnd.nitf"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nq","application/n-quads"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nt","application/n-triples"],["ntf","application/vnd.nitf"],["numbers","application/x-iwork-numbers-sffnumbers"],["nzb","application/x-nzb"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["obgx","application/vnd.openblox.game+xml"],["obj","model/obj"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogex","model/vnd.opengex"],["ogg","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omdoc","application/omdoc+xml"],["onepkg","application/onenote"],["onetmp","application/onenote"],["onetoc","application/onenote"],["onetoc2","application/onenote"],["opf","application/oebps-package+xml"],["opml","text/x-opml"],["oprc","application/vnd.palm"],["opus","audio/ogg"],["org","text/x-org"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["osm","application/vnd.openstreetmap.data+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","font/otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["ova","application/x-virtualbox-ova"],["ovf","application/x-virtualbox-ovf"],["owl","application/rdf+xml"],["oxps","application/oxps"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c","application/pkcs7-mime"],["p7m","application/pkcs7-mime"],["p7r","application/x-pkcs7-certreqresp"],["p7s","application/pkcs7-signature"],["p8","application/pkcs8"],["p10","application/x-pkcs10"],["p12","application/x-pkcs12"],["pac","application/x-ns-proxy-autoconfig"],["pages","application/x-iwork-pages-sffpages"],["pas","text/x-pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcap","application/vnd.tcpdump.pcap"],["pcf","application/x-font-pcf"],["pcl","application/vnd.hp-pcl"],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb","application/x-pilot"],["pde","text/x-processing"],["pdf","application/pdf"],["pem","application/x-x509-user-cert"],["pfa","application/x-font-type1"],["pfb","application/x-font-type1"],["pfm","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfx","application/x-pkcs12"],["pgm","image/x-portable-graymap"],["pgn","application/x-chess-pgn"],["pgp","application/pgp"],["php","application/x-httpd-php"],["php3","application/x-httpd-php"],["php4","application/x-httpd-php"],["phps","application/x-httpd-php-source"],["phtml","application/x-httpd-php"],["pic","image/x-pict"],["pkg","application/octet-stream"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pkpass","application/vnd.apple.pkpass"],["pl","application/x-perl"],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["pm","application/x-perl"],["pml","application/vnd.ctc-posml"],["png","image/png"],["pnm","image/x-portable-anymap"],["portpkg","application/vnd.macports.portpkg"],["pot","application/vnd.ms-powerpoint"],["potm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps","application/vnd.ms-powerpoint"],["ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt","application/powerpoint"],["pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["pqa","application/vnd.palm"],["prc","application/x-pilot"],["pre","application/vnd.lotus-freelance"],["prf","application/pics-rules"],["provx","application/provenance+xml"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd","application/x-photoshop"],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["pti","image/prs.pti"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pwn","application/vnd.3m.post-it-notes"],["pya","audio/vnd.ms-playready.media.pya"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qfx","application/vnd.intu.qfx"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qwd","application/vnd.quark.quarkxpress"],["qwt","application/vnd.quark.quarkxpress"],["qxb","application/vnd.quark.quarkxpress"],["qxd","application/vnd.quark.quarkxpress"],["qxl","application/vnd.quark.quarkxpress"],["qxt","application/vnd.quark.quarkxpress"],["ra","audio/x-realaudio"],["ram","audio/x-pn-realaudio"],["raml","application/raml+yaml"],["rapd","application/route-apd+xml"],["rar","application/x-rar"],["ras","image/x-cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["relo","application/p2p-overlay+xml"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["ris","application/x-research-info-systems"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm","audio/x-pn-realaudio"],["rmi","audio/midi"],["rmp","audio/x-pn-realaudio-plugin"],["rms","application/vnd.jcp.javame.midlet-rms"],["rmvb","application/vnd.rn-realmedia-vbr"],["rnc","application/relax-ng-compact-syntax"],["rng","application/xml"],["roa","application/rpki-roa"],["roff","text/troff"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsa","application/x-pkcs7"],["rsat","application/atsc-rsat+xml"],["rsd","application/rsd+xml"],["rsheet","application/urc-ressheet+xml"],["rss","application/rss+xml"],["rtf","text/rtf"],["rtx","text/richtext"],["run","application/x-makeself"],["rusd","application/route-usd+xml"],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["sass","text/x-sass"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm","application/vnd.lotus-screencam"],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["scss","text/x-scss"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkd","application/vnd.solent.sdkm+xml"],["sdkm","application/vnd.solent.sdkm+xml"],["sdp","application/sdp"],["sdw","application/vnd.stardivision.writer"],["sea","application/octet-stream"],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["senmlx","application/senml+xml"],["sensmlx","application/sensml+xml"],["ser","application/java-serialized-object"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sfv","text/x-sfv"],["sgi","image/sgi"],["sgl","application/vnd.stardivision.writer-global"],["sgm","text/sgml"],["sgml","text/sgml"],["sh","application/x-sh"],["shar","application/x-shar"],["shex","text/shex"],["shf","application/shf+xml"],["shtml","text/html"],["sid","image/x-mrsid-image"],["sieve","application/sieve"],["sig","application/pgp-signature"],["sil","audio/silk"],["silo","model/mesh"],["sis","application/vnd.symbian.install"],["sisx","application/vnd.symbian.install"],["sit","application/x-stuffit"],["sitx","application/x-stuffitx"],["siv","application/sieve"],["skd","application/vnd.koan"],["skm","application/vnd.koan"],["skp","application/vnd.koan"],["skt","application/vnd.koan"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slim","text/slim"],["slm","text/slim"],["sls","application/route-s-tsid+xml"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi","application/smil"],["smil","application/smil"],["smv","video/x-smv"],["smzip","application/vnd.stepmania.package"],["snd","audio/basic"],["snf","application/x-font-snf"],["so","application/octet-stream"],["spc","application/x-pkcs7-certificates"],["spdx","text/spdx"],["spf","application/vnd.yamaha.smaf-phrase"],["spl","application/x-futuresplash"],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spx","audio/ogg"],["sql","application/x-sql"],["src","application/x-wais-source"],["srt","application/x-subrip"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["ssdl","application/ssdl+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssml","application/ssml+xml"],["sst","application/octet-stream"],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl","model/stl"],["stpx","model/step+xml"],["stpxz","model/step-xml+zip"],["stpz","model/step+zip"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["styl","text/stylus"],["stylus","text/stylus"],["sub","text/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["susp","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svg","image/svg+xml"],["svgz","image/svg+xml"],["swa","application/x-director"],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["swidtag","application/swid+xml"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t","text/troff"],["t3","application/x-t3vm-image"],["t38","image/t38"],["taglet","application/vnd.mynfc"],["tao","application/vnd.tao.intent-module-archive"],["tap","image/vnd.tencent.tap"],["tar","application/x-tar"],["tcap","application/vnd.3gpp2.tcap"],["tcl","application/x-tcl"],["td","application/urc-targetdesc+xml"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["teicorpus","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text","text/plain"],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tfx","image/tiff-fx"],["tga","image/x-tga"],["tgz","application/x-tar"],["thmx","application/vnd.ms-officetheme"],["tif","image/tiff"],["tiff","image/tiff"],["tk","application/x-tcl"],["tmo","application/vnd.tmobile-livetv"],["toml","application/toml"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","text/troff"],["tra","application/vnd.trueapp"],["trig","application/trig"],["trm","application/x-msterminal"],["ts","video/mp2t"],["tsd","application/timestamped-data"],["tsv","text/tab-separated-values"],["ttc","font/collection"],["ttf","font/ttf"],["ttl","text/turtle"],["ttml","application/ttml+xml"],["twd","application/vnd.simtech-mindmapper"],["twds","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["u8dsn","message/global-delivery-status"],["u8hdr","message/global-headers"],["u8mdn","message/global-disposition-notification"],["u8msg","message/global"],["u32","application/x-authorware-bin"],["ubj","application/ubjson"],["udeb","application/x-debian-package"],["ufd","application/vnd.ufdl"],["ufdl","application/vnd.ufdl"],["ulx","application/x-glulx"],["umj","application/vnd.umajin"],["unityweb","application/vnd.unity"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["urls","text/uri-list"],["usdz","model/vnd.usdz+zip"],["ustar","application/x-ustar"],["utz","application/vnd.uiq.theme"],["uu","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvd","application/vnd.dece.data"],["uvf","application/vnd.dece.data"],["uvg","image/vnd.dece.graphic"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvt","application/vnd.dece.ttml+xml"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["uvva","audio/vnd.dece.audio"],["uvvd","application/vnd.dece.data"],["uvvf","application/vnd.dece.data"],["uvvg","image/vnd.dece.graphic"],["uvvh","video/vnd.dece.hd"],["uvvi","image/vnd.dece.graphic"],["uvvm","video/vnd.dece.mobile"],["uvvp","video/vnd.dece.pd"],["uvvs","video/vnd.dece.sd"],["uvvt","application/vnd.dece.ttml+xml"],["uvvu","video/vnd.uvvu.mp4"],["uvvv","video/vnd.dece.video"],["uvvx","application/vnd.dece.unspecified"],["uvvz","application/vnd.dece.zip"],["uvx","application/vnd.dece.unspecified"],["uvz","application/vnd.dece.zip"],["vbox","application/x-virtualbox-vbox"],["vbox-extpack","application/x-virtualbox-vbox-extpack"],["vcard","text/vcard"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vdi","application/x-virtualbox-vdi"],["vds","model/vnd.sap.vds"],["vhd","application/x-virtualbox-vhd"],["vis","application/vnd.visionary"],["viv","video/vnd.vivo"],["vlc","application/videolan"],["vmdk","application/x-virtualbox-vmdk"],["vob","video/x-ms-vob"],["vor","application/vnd.stardivision.writer"],["vox","application/x-authorware-bin"],["vrml","model/vrml"],["vsd","application/vnd.visio"],["vsf","application/vnd.vsf"],["vss","application/vnd.visio"],["vst","application/vnd.visio"],["vsw","application/vnd.visio"],["vtf","image/vnd.valve.source.texture"],["vtt","text/vtt"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w3d","application/x-director"],["wad","application/x-doom"],["wadl","application/vnd.sun.wadl+xml"],["war","application/java-archive"],["wasm","application/wasm"],["wav","audio/x-wav"],["wax","audio/x-ms-wax"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["wdp","image/vnd.ms-photo"],["weba","audio/webm"],["webapp","application/x-web-app-manifest+json"],["webm","video/webm"],["webmanifest","application/manifest+json"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf","image/wmf"],["wml","text/vnd.wap.wml"],["wmlc","application/wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-msmetafile"],["woff","font/woff"],["woff2","font/woff2"],["word","application/msword"],["wpd","application/vnd.wordperfect"],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wqd","application/vnd.wqd"],["wri","application/x-mswrite"],["wrl","model/vrml"],["wsc","message/vnd.wfa.wsc"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wtb","application/vnd.webturbo"],["wvx","video/x-ms-wvx"],["x3d","model/x3d+xml"],["x3db","model/x3d+fastinfoset"],["x3dbz","model/x3d+binary"],["x3dv","model/x3d-vrml"],["x3dvz","model/x3d+vrml"],["x3dz","model/x3d+xml"],["x32","application/x-authorware-bin"],["x_b","model/vnd.parasolid.transmit.binary"],["x_t","model/vnd.parasolid.transmit.text"],["xaml","application/xaml+xml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xav","application/xcap-att+xml"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm","image/x-xbitmap"],["xca","application/xcap-caps+xml"],["xcs","application/calendar+xml"],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xel","application/xcap-el+xml"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xht","application/xhtml+xml"],["xhtml","application/xhtml+xml"],["xhvml","application/xv+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla","application/vnd.ms-excel"],["xlam","application/vnd.ms-excel.addin.macroEnabled.12"],["xlc","application/vnd.ms-excel"],["xlf","application/xliff+xml"],["xlm","application/vnd.ms-excel"],["xls","application/vnd.ms-excel"],["xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt","application/vnd.ms-excel"],["xltm","application/vnd.ms-excel.template.macroEnabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlw","application/vnd.ms-excel"],["xm","audio/xm"],["xml","application/xml"],["xns","application/xcap-ns+xml"],["xo","application/vnd.olpc-sugar"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpl","application/xproc+xml"],["xpm","image/x-xpixmap"],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xpx","application/vnd.intercon.formnet"],["xsd","application/xml"],["xsl","application/xml"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xul","application/vnd.mozilla.xul+xml"],["xvm","application/xv+xml"],["xvml","application/xv+xml"],["xwd","image/x-xwindowdump"],["xyz","chemical/x-xyz"],["xz","application/x-xz"],["yaml","text/yaml"],["yang","application/yang"],["yin","application/yin+xml"],["yml","text/yaml"],["ymp","text/x-suse-ymp"],["z","application/x-compress"],["z1","application/x-zmachine"],["z2","application/x-zmachine"],["z3","application/x-zmachine"],["z4","application/x-zmachine"],["z5","application/x-zmachine"],["z6","application/x-zmachine"],["z7","application/x-zmachine"],["z8","application/x-zmachine"],["zaz","application/vnd.zzazz.deck+xml"],["zip","application/zip"],["zir","application/vnd.zul"],["zirz","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zsh","text/x-scriptzsh"]]);function el(l,t,e){const i=gx(l),{webkitRelativePath:s}=l,n=typeof t=="string"?t:typeof s=="string"&&s.length>0?s:`./${l.name}`;return typeof i.path!="string"&&vm(i,"path",n),e!==void 0&&Object.defineProperty(i,"handle",{value:e,writable:!1,configurable:!1,enumerable:!0}),vm(i,"relativePath",n),i}function gx(l){const{name:t}=l;if(t&&t.lastIndexOf(".")!==-1&&!l.type){const i=t.split(".").pop().toLowerCase(),s=fx.get(i);s&&Object.defineProperty(l,"type",{value:s,writable:!1,configurable:!1,enumerable:!0})}return l}function vm(l,t,e){Object.defineProperty(l,t,{value:e,writable:!1,configurable:!1,enumerable:!0})}const mx=[".DS_Store","Thumbs.db"];function vx(l){return nr(this,void 0,void 0,function*(){return Yd(l)&&bx(l.dataTransfer)?Ax(l.dataTransfer,l.type):yx(l)?xx(l):Array.isArray(l)&&l.every(t=>"getFile"in t&&typeof t.getFile=="function")?wx(l):[]})}function bx(l){return Yd(l)}function yx(l){return Yd(l)&&Yd(l.target)}function Yd(l){return typeof l=="object"&&l!==null}function xx(l){return Rf(l.target.files).map(t=>el(t))}function wx(l){return nr(this,void 0,void 0,function*(){return(yield Promise.all(l.map(e=>e.getFile()))).map(e=>el(e))})}function Ax(l,t){return nr(this,void 0,void 0,function*(){if(l.items){const e=Rf(l.items).filter(s=>s.kind==="file");if(t!=="drop")return e;const i=yield Promise.all(e.map(Ex));return bm(dv(i))}return bm(Rf(l.files).map(e=>el(e)))})}function bm(l){return l.filter(t=>mx.indexOf(t.name)===-1)}function Rf(l){if(l===null)return[];const t=[];for(let e=0;e<l.length;e++){const i=l[e];t.push(i)}return t}function Ex(l){if(typeof l.webkitGetAsEntry!="function")return ym(l);const t=l.webkitGetAsEntry();return t&&t.isDirectory?uv(t):ym(l,t)}function dv(l){return l.reduce((t,e)=>[...t,...Array.isArray(e)?dv(e):[e]],[])}function ym(l,t){return nr(this,void 0,void 0,function*(){var e;if(globalThis.isSecureContext&&typeof l.getAsFileSystemHandle=="function"){const n=yield l.getAsFileSystemHandle();if(n===null)throw new Error(`${l} is not a File`);if(n!==void 0){const r=yield n.getFile();return r.handle=n,el(r)}}const i=l.getAsFile();if(!i)throw new Error(`${l} is not a File`);return el(i,(e=t==null?void 0:t.fullPath)!==null&&e!==void 0?e:void 0)})}function _x(l){return nr(this,void 0,void 0,function*(){return l.isDirectory?uv(l):Sx(l)})}function uv(l){const t=l.createReader();return new Promise((e,i)=>{const s=[];function n(){t.readEntries(r=>nr(this,void 0,void 0,function*(){if(r.length){const o=Promise.all(r.map(_x));s.push(o),n()}else try{const o=yield Promise.all(s);e(o)}catch(o){i(o)}}),r=>{i(r)})}n()})}function Sx(l){return nr(this,void 0,void 0,function*(){return new Promise((t,e)=>{l.file(i=>{const s=el(i,l.fullPath);t(s)},i=>{e(i)})})})}var yf=function(l,t){if(l&&t){var e=Array.isArray(t)?t:t.split(",");if(e.length===0)return!0;var i=l.name||"",s=(l.type||"").toLowerCase(),n=s.replace(/\/.*$/,"");return e.some(function(r){var o=r.trim().toLowerCase();return o.charAt(0)==="."?i.toLowerCase().endsWith(o):o.endsWith("/*")?n===o.replace(/\/.*$/,""):s===o})}return!0};function xm(l){return kx(l)||Tx(l)||fv(l)||Cx()}function Cx(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tx(l){if(typeof Symbol<"u"&&l[Symbol.iterator]!=null||l["@@iterator"]!=null)return Array.from(l)}function kx(l){if(Array.isArray(l))return Lf(l)}function wm(l,t){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),e.push.apply(e,i)}return e}function Am(l){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?wm(Object(e),!0).forEach(function(i){pv(l,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):wm(Object(e)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(e,i))})}return l}function pv(l,t,e){return t in l?Object.defineProperty(l,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[t]=e,l}function Rl(l,t){return Lx(l)||Rx(l,t)||fv(l,t)||Px()}function Px(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fv(l,t){if(l){if(typeof l=="string")return Lf(l,t);var e=Object.prototype.toString.call(l).slice(8,-1);if(e==="Object"&&l.constructor&&(e=l.constructor.name),e==="Map"||e==="Set")return Array.from(l);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Lf(l,t)}}function Lf(l,t){(t==null||t>l.length)&&(t=l.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=l[e];return i}function Rx(l,t){var e=l==null?null:typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(e!=null){var i=[],s=!0,n=!1,r,o;try{for(e=e.call(l);!(s=(r=e.next()).done)&&(i.push(r.value),!(t&&i.length===t));s=!0);}catch(c){n=!0,o=c}finally{try{!s&&e.return!=null&&e.return()}finally{if(n)throw o}}return i}}function Lx(l){if(Array.isArray(l))return l}var Dx=typeof yf=="function"?yf:yf.default,Ix="file-invalid-type",Mx="file-too-large",Fx="file-too-small",Nx="too-many-files",Ox=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=t.split(","),i=e.length>1?"one of ".concat(e.join(", ")):e[0];return{code:Ix,message:"File type must be ".concat(i)}},Em=function(t){return{code:Mx,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},_m=function(t){return{code:Fx,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},jx={code:Nx,message:"Too many files"};function gv(l,t){var e=l.type==="application/x-moz-file"||Dx(l,t);return[e,e?null:Ox(t)]}function mv(l,t,e){if(Rn(l.size))if(Rn(t)&&Rn(e)){if(l.size>e)return[!1,Em(e)];if(l.size<t)return[!1,_m(t)]}else{if(Rn(t)&&l.size<t)return[!1,_m(t)];if(Rn(e)&&l.size>e)return[!1,Em(e)]}return[!0,null]}function Rn(l){return l!=null}function Bx(l){var t=l.files,e=l.accept,i=l.minSize,s=l.maxSize,n=l.multiple,r=l.maxFiles,o=l.validator;return!n&&t.length>1||n&&r>=1&&t.length>r?!1:t.every(function(c){var h=gv(c,e),d=Rl(h,1),u=d[0],p=mv(c,i,s),m=Rl(p,1),y=m[0],b=o?o(c):null;return u&&y&&!b})}function Kd(l){return typeof l.isPropagationStopped=="function"?l.isPropagationStopped():typeof l.cancelBubble<"u"?l.cancelBubble:!1}function dd(l){return l.dataTransfer?Array.prototype.some.call(l.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!l.target&&!!l.target.files}function Sm(l){l.preventDefault()}function zx(l){return l.indexOf("MSIE")!==-1||l.indexOf("Trident/")!==-1}function Hx(l){return l.indexOf("Edge/")!==-1}function $x(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return zx(l)||Hx(l)}function Ei(){for(var l=arguments.length,t=new Array(l),e=0;e<l;e++)t[e]=arguments[e];return function(i){for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];return t.some(function(o){return!Kd(i)&&o&&o.apply(void 0,[i].concat(n)),Kd(i)})}}function Ux(){return"showOpenFilePicker"in window}function Gx(l){if(Rn(l)){var t=Object.entries(l).filter(function(e){var i=Rl(e,2),s=i[0],n=i[1],r=!0;return vv(s)||(console.warn('Skipped "'.concat(s,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),r=!1),(!Array.isArray(n)||!n.every(bv))&&(console.warn('Skipped "'.concat(s,'" because an invalid file extension was provided.')),r=!1),r}).reduce(function(e,i){var s=Rl(i,2),n=s[0],r=s[1];return Am(Am({},e),{},pv({},n,r))},{});return[{description:"Files",accept:t}]}return l}function Vx(l){if(Rn(l))return Object.entries(l).reduce(function(t,e){var i=Rl(e,2),s=i[0],n=i[1];return[].concat(xm(t),[s],xm(n))},[]).filter(function(t){return vv(t)||bv(t)}).join(",")}function Wx(l){return l instanceof DOMException&&(l.name==="AbortError"||l.code===l.ABORT_ERR)}function qx(l){return l instanceof DOMException&&(l.name==="SecurityError"||l.code===l.SECURITY_ERR)}function vv(l){return l==="audio/*"||l==="video/*"||l==="image/*"||l==="text/*"||l==="application/*"||/\w+\/[-+.\w]+/g.test(l)}function bv(l){return/^.*\.[\w]+$/.test(l)}var Xx=["children"],Yx=["open"],Kx=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Jx=["refKey","onChange","onClick"];function Qx(l){return ew(l)||tw(l)||yv(l)||Zx()}function Zx(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tw(l){if(typeof Symbol<"u"&&l[Symbol.iterator]!=null||l["@@iterator"]!=null)return Array.from(l)}function ew(l){if(Array.isArray(l))return Df(l)}function xf(l,t){return nw(l)||sw(l,t)||yv(l,t)||iw()}function iw(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yv(l,t){if(l){if(typeof l=="string")return Df(l,t);var e=Object.prototype.toString.call(l).slice(8,-1);if(e==="Object"&&l.constructor&&(e=l.constructor.name),e==="Map"||e==="Set")return Array.from(l);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Df(l,t)}}function Df(l,t){(t==null||t>l.length)&&(t=l.length);for(var e=0,i=new Array(t);e<t;e++)i[e]=l[e];return i}function sw(l,t){var e=l==null?null:typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(e!=null){var i=[],s=!0,n=!1,r,o;try{for(e=e.call(l);!(s=(r=e.next()).done)&&(i.push(r.value),!(t&&i.length===t));s=!0);}catch(c){n=!0,o=c}finally{try{!s&&e.return!=null&&e.return()}finally{if(n)throw o}}return i}}function nw(l){if(Array.isArray(l))return l}function Cm(l,t){var e=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),e.push.apply(e,i)}return e}function Et(l){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Cm(Object(e),!0).forEach(function(i){If(l,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(e)):Cm(Object(e)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(e,i))})}return l}function If(l,t,e){return t in l?Object.defineProperty(l,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):l[t]=e,l}function Jd(l,t){if(l==null)return{};var e=aw(l,t),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);for(s=0;s<n.length;s++)i=n[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(l,i)&&(e[i]=l[i])}return e}function aw(l,t){if(l==null)return{};var e={},i=Object.keys(l),s,n;for(n=0;n<i.length;n++)s=i[n],!(t.indexOf(s)>=0)&&(e[s]=l[s]);return e}var Kg=L.forwardRef(function(l,t){var e=l.children,i=Jd(l,Xx),s=wv(i),n=s.open,r=Jd(s,Yx);return L.useImperativeHandle(t,function(){return{open:n}},[n]),Yy.createElement(L.Fragment,null,e(Et(Et({},r),{},{open:n})))});Kg.displayName="Dropzone";var xv={disabled:!1,getFilesFromEvent:vx,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Kg.defaultProps=xv;Kg.propTypes={children:dt.func,accept:dt.objectOf(dt.arrayOf(dt.string)),multiple:dt.bool,preventDropOnDocument:dt.bool,noClick:dt.bool,noKeyboard:dt.bool,noDrag:dt.bool,noDragEventsBubbling:dt.bool,minSize:dt.number,maxSize:dt.number,maxFiles:dt.number,disabled:dt.bool,getFilesFromEvent:dt.func,onFileDialogCancel:dt.func,onFileDialogOpen:dt.func,useFsAccessApi:dt.bool,autoFocus:dt.bool,onDragEnter:dt.func,onDragLeave:dt.func,onDragOver:dt.func,onDrop:dt.func,onDropAccepted:dt.func,onDropRejected:dt.func,onError:dt.func,validator:dt.func};var Mf={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function wv(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Et(Et({},xv),l),e=t.accept,i=t.disabled,s=t.getFilesFromEvent,n=t.maxSize,r=t.minSize,o=t.multiple,c=t.maxFiles,h=t.onDragEnter,d=t.onDragLeave,u=t.onDragOver,p=t.onDrop,m=t.onDropAccepted,y=t.onDropRejected,b=t.onFileDialogCancel,x=t.onFileDialogOpen,w=t.useFsAccessApi,E=t.autoFocus,A=t.preventDropOnDocument,_=t.noClick,S=t.noKeyboard,T=t.noDrag,C=t.noDragEventsBubbling,P=t.onError,k=t.validator,D=L.useMemo(function(){return Vx(e)},[e]),M=L.useMemo(function(){return Gx(e)},[e]),q=L.useMemo(function(){return typeof x=="function"?x:Tm},[x]),G=L.useMemo(function(){return typeof b=="function"?b:Tm},[b]),O=L.useRef(null),X=L.useRef(null),F=L.useReducer(rw,Mf),N=xf(F,2),ft=N[0],et=N[1],pe=ft.isFocused,ne=ft.isFileDialogActive,nt=L.useRef(typeof window<"u"&&window.isSecureContext&&w&&Ux()),st=function(){!nt.current&&ne&&setTimeout(function(){if(X.current){var U=X.current.files;U.length||(et({type:"closeDialog"}),G())}},300)};L.useEffect(function(){return window.addEventListener("focus",st,!1),function(){window.removeEventListener("focus",st,!1)}},[X,ne,G,nt]);var Tt=L.useRef([]),Kt=function(U){O.current&&O.current.contains(U.target)||(U.preventDefault(),Tt.current=[])};L.useEffect(function(){return A&&(document.addEventListener("dragover",Sm,!1),document.addEventListener("drop",Kt,!1)),function(){A&&(document.removeEventListener("dragover",Sm),document.removeEventListener("drop",Kt))}},[O,A]),L.useEffect(function(){return!i&&E&&O.current&&O.current.focus(),function(){}},[O,E,i]);var xt=L.useCallback(function(j){P?P(j):console.error(j)},[P]),it=L.useCallback(function(j){j.preventDefault(),j.persist(),or(j),Tt.current=[].concat(Qx(Tt.current),[j.target]),dd(j)&&Promise.resolve(s(j)).then(function(U){if(!(Kd(j)&&!C)){var St=U.length,ht=St>0&&Bx({files:U,accept:D,minSize:r,maxSize:n,multiple:o,maxFiles:c,validator:k}),Mt=St>0&&!ht;et({isDragAccept:ht,isDragReject:Mt,isDragActive:!0,type:"setDraggedFiles"}),h&&h(j)}}).catch(function(U){return xt(U)})},[s,h,xt,C,D,r,n,o,c,k]),Re=L.useCallback(function(j){j.preventDefault(),j.persist(),or(j);var U=dd(j);if(U&&j.dataTransfer)try{j.dataTransfer.dropEffect="copy"}catch{}return U&&u&&u(j),!1},[u,C]),we=L.useCallback(function(j){j.preventDefault(),j.persist(),or(j);var U=Tt.current.filter(function(ht){return O.current&&O.current.contains(ht)}),St=U.indexOf(j.target);St!==-1&&U.splice(St,1),Tt.current=U,!(U.length>0)&&(et({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),dd(j)&&d&&d(j))},[O,d,C]),rt=L.useCallback(function(j,U){var St=[],ht=[];j.forEach(function(Mt){var Ee=gv(Mt,D),Ai=xf(Ee,2),df=Ai[0],uf=Ai[1],pf=mv(Mt,r,n),hd=xf(pf,2),ff=hd[0],gf=hd[1],mf=k?k(Mt):null;if(df&&ff&&!mf)St.push(Mt);else{var vf=[uf,gf];mf&&(vf=vf.concat(mf)),ht.push({file:Mt,errors:vf.filter(function(Wy){return Wy})})}}),(!o&&St.length>1||o&&c>=1&&St.length>c)&&(St.forEach(function(Mt){ht.push({file:Mt,errors:[jx]})}),St.splice(0)),et({acceptedFiles:St,fileRejections:ht,isDragReject:ht.length>0,type:"setFiles"}),p&&p(St,ht,U),ht.length>0&&y&&y(ht,U),St.length>0&&m&&m(St,U)},[et,o,D,r,n,c,p,m,y,k]),Ae=L.useCallback(function(j){j.preventDefault(),j.persist(),or(j),Tt.current=[],dd(j)&&Promise.resolve(s(j)).then(function(U){Kd(j)&&!C||rt(U,j)}).catch(function(U){return xt(U)}),et({type:"reset"})},[s,rt,xt,C]),ae=L.useCallback(function(){if(nt.current){et({type:"openDialog"}),q();var j={multiple:o,types:M};window.showOpenFilePicker(j).then(function(U){return s(U)}).then(function(U){rt(U,null),et({type:"closeDialog"})}).catch(function(U){Wx(U)?(G(U),et({type:"closeDialog"})):qx(U)?(nt.current=!1,X.current?(X.current.value=null,X.current.click()):xt(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):xt(U)});return}X.current&&(et({type:"openDialog"}),q(),X.current.value=null,X.current.click())},[et,q,G,w,rt,xt,M,o]),Z=L.useCallback(function(j){!O.current||!O.current.isEqualNode(j.target)||(j.key===" "||j.key==="Enter"||j.keyCode===32||j.keyCode===13)&&(j.preventDefault(),ae())},[O,ae]),ct=L.useCallback(function(){et({type:"focus"})},[]),_t=L.useCallback(function(){et({type:"blur"})},[]),kt=L.useCallback(function(){_||($x()?setTimeout(ae,0):ae())},[_,ae]),Le=function(U){return i?null:U},Wi=function(U){return S?null:Le(U)},Is=function(U){return T?null:Le(U)},or=function(U){C&&U.stopPropagation()},lr=L.useMemo(function(){return function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=j.refKey,St=U===void 0?"ref":U,ht=j.role,Mt=j.onKeyDown,Ee=j.onFocus,Ai=j.onBlur,df=j.onClick,uf=j.onDragEnter,pf=j.onDragOver,hd=j.onDragLeave,ff=j.onDrop,gf=Jd(j,Kx);return Et(Et(If({onKeyDown:Wi(Ei(Mt,Z)),onFocus:Wi(Ei(Ee,ct)),onBlur:Wi(Ei(Ai,_t)),onClick:Le(Ei(df,kt)),onDragEnter:Is(Ei(uf,it)),onDragOver:Is(Ei(pf,Re)),onDragLeave:Is(Ei(hd,we)),onDrop:Is(Ei(ff,Ae)),role:typeof ht=="string"&&ht!==""?ht:"presentation"},St,O),!i&&!S?{tabIndex:0}:{}),gf)}},[O,Z,ct,_t,kt,it,Re,we,Ae,S,T,i]),cf=L.useCallback(function(j){j.stopPropagation()},[]),hf=L.useMemo(function(){return function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},U=j.refKey,St=U===void 0?"ref":U,ht=j.onChange,Mt=j.onClick,Ee=Jd(j,Jx),Ai=If({accept:D,multiple:o,type:"file",style:{border:0,clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:0,position:"absolute",width:"1px",whiteSpace:"nowrap"},onChange:Le(Ei(ht,Ae)),onClick:Le(Ei(Mt,cf)),tabIndex:-1},St,X);return Et(Et({},Ai),Ee)}},[X,e,o,Ae,i]);return Et(Et({},ft),{},{isFocused:pe&&!i,getRootProps:lr,getInputProps:hf,rootRef:O,inputRef:X,open:Le(ae)})}function rw(l,t){switch(t.type){case"focus":return Et(Et({},l),{},{isFocused:!0});case"blur":return Et(Et({},l),{},{isFocused:!1});case"openDialog":return Et(Et({},Mf),{},{isFileDialogActive:!0});case"closeDialog":return Et(Et({},l),{},{isFileDialogActive:!1});case"setDraggedFiles":return Et(Et({},l),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return Et(Et({},l),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections,isDragReject:t.isDragReject});case"reset":return Et({},Mf);default:return l}}function Tm(){}const V0=({onFilesSelected:l,multiple:t=!1,maxFiles:e=1,accept:i={"application/pdf":[".pdf"]},disabled:s=!1,className:n=""})=>{const[r,o]=L.useState([]),[c,h]=L.useState(null),d=L.useCallback((b,x)=>{var w,E,A,_;if(h(null),x.length>0){const S=x[0];((E=(w=S.errors)==null?void 0:w[0])==null?void 0:E.code)==="file-invalid-type"?h("Please select PDF files only"):((_=(A=S.errors)==null?void 0:A[0])==null?void 0:_.code)==="file-too-large"?h("File size is too large. Maximum size is 100MB"):h("Invalid file selected");return}if(b.length>0){const S=t?[...r,...b]:b;o(S),l(S)}},[r,t,l]),u=L.useCallback(b=>{const x=r.filter((w,E)=>E!==b);o(x),l(x)},[r,l]),{getRootProps:p,getInputProps:m,isDragActive:y}=wv({onDrop:d,accept:i,multiple:t,maxFiles:e,disabled:s,maxSize:100*1024*1024});return R.jsxs("div",{className:`w-full ${n}`,children:[R.jsxs("div",{...p(),className:`
          border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200
          ${y?"border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 hover:bg-gray-50 dark:hover:bg-gray-800"}
          ${s?"opacity-50 cursor-not-allowed":""}
          ${c?"border-red-400 bg-red-50 dark:bg-red-900/20":""}
        `,children:[R.jsx("input",{...m()}),R.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3",children:[R.jsx(Ky,{className:`w-12 h-12 ${c?"text-red-400":"text-blue-400"}`}),R.jsxs("div",{className:"space-y-1",children:[R.jsx("p",{className:`text-lg font-medium ${c?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:y?"Drop PDF files here...":t?"Drop PDF files here or click to browse":"Drop a PDF file here or click to browse"}),R.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t?`Maximum ${e} files, up to 100MB each`:"Maximum file size: 100MB"})]})]})]}),c&&R.jsxs("div",{className:"mt-3 flex items-center space-x-2 text-red-600 dark:text-red-400",children:[R.jsx(rv,{className:"w-4 h-4"}),R.jsx("span",{className:"text-sm",children:c})]}),r.length>0&&R.jsxs("div",{className:"mt-4 space-y-2",children:[R.jsxs("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Uploaded Files (",r.length,")"]}),R.jsx("div",{className:"space-y-1",children:r.map((b,x)=>R.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsx(Jy,{className:"w-5 h-5 text-red-500"}),R.jsxs("div",{children:[R.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:b.name}),R.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(b.size/(1024*1024)).toFixed(2)," MB"]})]})]}),R.jsx("button",{onClick:()=>u(x),className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Remove file",children:R.jsx(Qy,{className:"w-4 h-4"})})]},`${b.name}-${x}`))})]})]})},xe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Ff=[.001,0,0,.001,0,0],wf=1.35,qe={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Vi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Av="pdfjs_internal_editor_",V={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},Q={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Ev={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},re={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Pl={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Pt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},cr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},id={ERRORS:0,WARNINGS:1,INFOS:5},Ll={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ud={moveTo:0,lineTo:1,curveTo:2,closePath:3},_v={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Jp=id.WARNINGS;function ow(l){Number.isInteger(l)&&(Jp=l)}function lw(){return Jp}function Qp(l){Jp>=id.INFOS&&console.log(`Info: ${l}`)}function W(l){Jp>=id.WARNINGS&&console.log(`Warning: ${l}`)}function lt(l){throw new Error(l)}function Ot(l,t){l||lt(t)}function cw(l){switch(l==null?void 0:l.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Jg(l,t=null,e=null){if(!l)return null;if(e&&typeof l=="string"){if(e.addDefaultProtocol&&l.startsWith("www.")){const s=l.match(/\./g);(s==null?void 0:s.length)>=2&&(l=`http://${l}`)}if(e.tryConvertEncoding)try{l=fw(l)}catch{}}const i=t?URL.parse(l,t):URL.parse(l);return cw(i)?i:null}function Qg(l,t,e=!1){const i=URL.parse(l);return i?(i.hash=t,i.href):e&&Jg(l,"http://example.com")?l.split("#",1)[0]+`${t?`#${t}`:""}`:""}function J(l,t,e,i=!1){return Object.defineProperty(l,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}const ar=function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}();class km extends ar{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Af extends ar{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Qd extends ar{constructor(t){super(t,"InvalidPDFException")}}class Dl extends ar{constructor(t,e,i){super(t,"ResponseException"),this.status=e,this.missing=i}}class hw extends ar{constructor(t){super(t,"FormatError")}}class Ls extends ar{constructor(t){super(t,"AbortException")}}function Sv(l){(typeof l!="object"||(l==null?void 0:l.length)===void 0)&&lt("Invalid argument for bytesToString");const t=l.length,e=8192;if(t<e)return String.fromCharCode.apply(null,l);const i=[];for(let s=0;s<t;s+=e){const n=Math.min(s+e,t),r=l.subarray(s,n);i.push(String.fromCharCode.apply(null,r))}return i.join("")}function sd(l){typeof l!="string"&&lt("Invalid argument for stringToBytes");const t=l.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=l.charCodeAt(i)&255;return e}function dw(l){return String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,l&255)}function uw(){const l=new Uint8Array(4);return l[0]=1,new Uint32Array(l.buffer,0,1)[0]===1}function pw(){try{return new Function(""),!0}catch{return!1}}class Yt{static get isLittleEndian(){return J(this,"isLittleEndian",uw())}static get isEvalSupported(){return J(this,"isEvalSupported",pw())}static get isOffscreenCanvasSupported(){return J(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return J(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return J(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){var t,e;return J(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const Ef=Array.from(Array(256).keys(),l=>l.toString(16).padStart(2,"0"));var Ar,yd,jl,Nf;class ${static makeHexColor(t,e,i){return`#${Ef[t]}${Ef[e]}${Ef[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e,i=0){const s=t[i],n=t[i+1];t[i]=s*e[0]+n*e[2]+e[4],t[i+1]=s*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,i=0){const s=e[0],n=e[1],r=e[2],o=e[3],c=e[4],h=e[5];for(let d=0;d<6;d+=2){const u=t[i+d],p=t[i+d+1];t[i+d]=u*s+p*r+c,t[i+d+1]=u*n+p*o+h}}static applyInverseTransform(t,e){const i=t[0],s=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(i*e[3]-s*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-i*e[1]+s*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,i){const s=e[0],n=e[1],r=e[2],o=e[3],c=e[4],h=e[5],d=t[0],u=t[1],p=t[2],m=t[3];let y=s*d+c,b=y,x=s*p+c,w=x,E=o*u+h,A=E,_=o*m+h,S=_;if(n!==0||r!==0){const T=n*d,C=n*p,P=r*u,k=r*m;y+=P,w+=P,x+=k,b+=k,E+=T,S+=T,_+=C,A+=C}i[0]=Math.min(i[0],y,x,b,w),i[1]=Math.min(i[1],E,_,A,S),i[2]=Math.max(i[2],y,x,b,w),i[3]=Math.max(i[3],E,_,A,S)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const i=t[0],s=t[1],n=t[2],r=t[3],o=i**2+s**2,c=i*n+s*r,h=n**2+r**2,d=(o+h)/2,u=Math.sqrt(d**2-(o*h-c**2));e[0]=Math.sqrt(d+u||1),e[1]=Math.sqrt(d-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[i,n,s,r]}static pointBoundingBox(t,e,i){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}static rectBoundingBox(t,e,i,s,n){n[0]=Math.min(n[0],t,i),n[1]=Math.min(n[1],e,s),n[2]=Math.max(n[2],t,i),n[3]=Math.max(n[3],e,s)}static bezierBoundingBox(t,e,i,s,n,r,o,c,h){h[0]=Math.min(h[0],t,o),h[1]=Math.min(h[1],e,c),h[2]=Math.max(h[2],t,o),h[3]=Math.max(h[3],e,c),v(this,jl,Nf).call(this,t,i,n,o,e,s,r,c,3*(-t+3*(i-n)+o),6*(t-2*i+n),3*(i-t),h),v(this,jl,Nf).call(this,t,i,n,o,e,s,r,c,3*(-e+3*(s-r)+c),6*(e-2*s+r),3*(s-e),h)}}Ar=new WeakSet,yd=function(t,e,i,s,n,r,o,c,h,d){if(h<=0||h>=1)return;const u=1-h,p=h*h,m=p*h,y=u*(u*(u*t+3*h*e)+3*p*i)+m*s,b=u*(u*(u*n+3*h*r)+3*p*o)+m*c;d[0]=Math.min(d[0],y),d[1]=Math.min(d[1],b),d[2]=Math.max(d[2],y),d[3]=Math.max(d[3],b)},jl=new WeakSet,Nf=function(t,e,i,s,n,r,o,c,h,d,u,p){if(Math.abs(h)<1e-12){Math.abs(d)>=1e-12&&v(this,Ar,yd).call(this,t,e,i,s,n,r,o,c,-u/d,p);return}const m=d**2-4*u*h;if(m<0)return;const y=Math.sqrt(m),b=2*h;v(this,Ar,yd).call(this,t,e,i,s,n,r,o,c,(-d+y)/b,p),v(this,Ar,yd).call(this,t,e,i,s,n,r,o,c,(-d-y)/b,p)},f($,Ar),f($,jl);function fw(l){return decodeURIComponent(escape(l))}let _f=null,Pm=null;function Cv(l){return _f||(_f=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Pm=new Map([["","t"]])),l.replaceAll(_f,(t,e,i)=>e?e.normalize("NFKC"):Pm.get(i))}function Zg(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const l=new Uint8Array(32);return crypto.getRandomValues(l),Sv(l)}const tm="pdfjs_internal_id_";function gw(l,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[i,s,...n]=e;if(!l(i)&&!Number.isInteger(i)||!t(s))return!1;const r=n.length;let o=!0;switch(s.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;o=!1;break;default:return!1}for(const c of n)if(!(typeof c=="number"||o&&c===null))return!1;return!0}function de(l,t,e){return Math.min(Math.max(l,t),e)}function Tv(l){return Uint8Array.prototype.toBase64?l.toBase64():btoa(Sv(l))}function mw(l){return Uint8Array.fromBase64?Uint8Array.fromBase64(l):sd(atob(l))}typeof Promise.try!="function"&&(Promise.try=function(l,...t){return new Promise(e=>{e(l(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(l){return l.reduce((t,e)=>t+e,0)});const qi="http://www.w3.org/2000/svg",Ln=class Ln{};I(Ln,"CSS",96),I(Ln,"PDF",72),I(Ln,"PDF_TO_CSS_UNITS",Ln.CSS/Ln.PDF);let Ds=Ln;async function nl(l,t="text"){if(hl(l,document.baseURI)){const e=await fetch(l);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{const s=new XMLHttpRequest;s.open("GET",l,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class nd{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:r=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=r,i*=e;const c=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let d,u,p,m;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,u=0,p=0,m=1;break;case 90:d=0,u=1,p=1,m=0;break;case 270:d=0,u=-1,p=-1,m=0;break;case 0:d=1,u=0,p=0,m=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,m=-m);let y,b,x,w;d===0?(y=Math.abs(h-t[1])*i+n,b=Math.abs(c-t[0])*i+r,x=(t[3]-t[1])*i,w=(t[2]-t[0])*i):(y=Math.abs(c-t[0])*i+n,b=Math.abs(h-t[1])*i+r,x=(t[2]-t[0])*i,w=(t[3]-t[1])*i),this.transform=[d*i,u*i,p*i,m*i,y-d*i*c-p*i*h,b-u*i*c-m*i*h],this.width=x,this.height=w}get rawDims(){const t=this.viewBox;return J(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new nd({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){const i=[t,e];return $.applyTransform(i,this.transform),i}convertToViewportRectangle(t){const e=[t[0],t[1]];$.applyTransform(e,this.transform);const i=[t[2],t[3]];return $.applyTransform(i,this.transform),[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){const i=[t,e];return $.applyInverseTransform(i,this.transform),i}}class Zp extends ar{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function ad(l){const t=l.length;let e=0;for(;e<t&&l[e].trim()==="";)e++;return l.substring(e,e+5).toLowerCase()==="data:"}function tf(l){return typeof l=="string"&&/\.pdf$/i.test(l)}function kv(l){return[l]=l.split(/[#?]/,1),l.substring(l.lastIndexOf("/")+1)}function Pv(l,t="document.pdf"){if(typeof l!="string")return t;if(ad(l))return W('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(l);if(!i)return t;const s=o=>{try{let c=decodeURIComponent(o);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:o):c}catch{return o}},n=/\.pdf$/i,r=i.pathname.split("/").at(-1);if(n.test(r))return s(r);if(i.searchParams.size>0){const o=Array.from(i.searchParams.values()).reverse();for(const h of o)if(n.test(h))return s(h);const c=Array.from(i.searchParams.keys()).reverse();for(const h of c)if(n.test(h))return s(h)}if(i.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(c)return s(c[0])}return t}class Rm{constructor(){I(this,"started",Object.create(null));I(this,"times",[])}time(t){t in this.started&&W(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||W(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:i}of this.times)e=Math.max(i.length,e);for(const{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}}function hl(l,t){const e=t?URL.parse(l,t):URL.parse(l);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function ai(l){l.preventDefault()}function Dt(l){l.preventDefault(),l.stopPropagation()}function vw(l){console.log("Deprecated API usage: "+l)}var Bl;class ef{static toDateObject(t){if(!t||typeof t!="string")return null;a(this,Bl)||g(this,Bl,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=a(this,Bl).exec(t);if(!e)return null;const i=parseInt(e[1],10);let s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let c=parseInt(e[6],10);c=c>=0&&c<=59?c:0;const h=e[7]||"Z";let d=parseInt(e[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(r+=d,o+=u):h==="+"&&(r-=d,o-=u),new Date(Date.UTC(i,s,n,r,o,c))}}Bl=new WeakMap,f(ef,Bl,void 0);function Rv(l,{scale:t=1,rotation:e=0}){const{width:i,height:s}=l.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new nd({viewBox:n,userUnit:1,scale:t,rotation:e})}function em(l){if(l.startsWith("#")){const t=parseInt(l.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return l.startsWith("rgb(")?l.slice(4,-1).split(",").map(t=>parseInt(t)):l.startsWith("rgba(")?l.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(W(`Not a valid color format: "${l}"`),[0,0,0])}function bw(l){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of l.keys()){t.style.color=e;const i=window.getComputedStyle(t).color;l.set(e,em(i))}t.remove()}function At(l){const{a:t,b:e,c:i,d:s,e:n,f:r}=l.getTransform();return[t,e,i,s,n,r]}function _i(l){const{a:t,b:e,c:i,d:s,e:n,f:r}=l.getTransform().invertSelf();return[t,e,i,s,n,r]}function _n(l,t,e=!1,i=!0){if(t instanceof nd){const{pageWidth:s,pageHeight:n}=t.rawDims,{style:r}=l,o=Yt.isCSSRoundSupported,c=`var(--total-scale-factor) * ${s}px`,h=`var(--total-scale-factor) * ${n}px`,d=o?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(r.width=d,r.height=u):(r.width=u,r.height=d)}i&&l.setAttribute("data-main-rotation",t.rotation)}class wi{constructor(){const{pixelRatio:t}=wi;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,i,s,n=-1){let r=1/0,o=1/0,c=1/0;i=wi.capPixels(i,n),i>0&&(r=Math.sqrt(i/(t*e))),s!==-1&&(o=s/t,c=s/e);const h=Math.min(r,o,c);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,i):i}return t}}const Zd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Fs,In,Ke,Ns,zl,Er,Hl,ru,Lv,ou,Dv,lu,Iv,Mn,dl,_r,xd;const Ki=class Ki{constructor(t){f(this,ou);f(this,lu);f(this,Mn);f(this,_r);f(this,Fs,null);f(this,In,null);f(this,Ke,void 0);f(this,Ns,null);f(this,zl,null);f(this,Er,null);g(this,Ke,t),a(Ki,Hl)||g(Ki,Hl,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=g(this,Fs,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=a(this,Ke)._uiManager._signal;t.addEventListener("contextmenu",ai,{signal:e}),t.addEventListener("pointerdown",v(Ki,ru,Lv),{signal:e});const i=g(this,Ns,document.createElement("div"));i.className="buttons",t.append(i);const s=a(this,Ke).toolbarPosition;if(s){const{style:n}=t,r=a(this,Ke)._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return a(this,Fs)}hide(){var t;a(this,Fs).classList.add("hidden"),(t=a(this,In))==null||t.hideDropdown()}show(){var t;a(this,Fs).classList.remove("hidden"),(t=a(this,zl))==null||t.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=a(this,Ke),i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",a(Ki,Hl)[t]),v(this,Mn,dl).call(this,i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),a(this,Ns).append(i)}async addAltText(t){const e=await t.render();v(this,Mn,dl).call(this,e),a(this,Ns).append(e,a(this,_r,xd)),g(this,zl,t)}addColorPicker(t){g(this,In,t);const e=t.renderButton();v(this,Mn,dl).call(this,e),a(this,Ns).append(e,a(this,_r,xd))}async addEditSignatureButton(t){const e=g(this,Er,await t.renderEditButton(a(this,Ke)));v(this,Mn,dl).call(this,e),a(this,Ns).append(e,a(this,_r,xd))}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break}}updateEditSignatureButton(t){a(this,Er)&&(a(this,Er).title=t)}remove(){var t;a(this,Fs).remove(),(t=a(this,In))==null||t.destroy(),g(this,In,null)}};Fs=new WeakMap,In=new WeakMap,Ke=new WeakMap,Ns=new WeakMap,zl=new WeakMap,Er=new WeakMap,Hl=new WeakMap,ru=new WeakSet,Lv=function(t){t.stopPropagation()},ou=new WeakSet,Dv=function(t){a(this,Ke)._focusEventsAllowed=!1,Dt(t)},lu=new WeakSet,Iv=function(t){a(this,Ke)._focusEventsAllowed=!0,Dt(t)},Mn=new WeakSet,dl=function(t){const e=a(this,Ke)._uiManager._signal;t.addEventListener("focusin",v(this,ou,Dv).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",v(this,lu,Iv).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",ai,{signal:e})},_r=new WeakSet,xd=function(){const t=document.createElement("div");return t.className="divider",t},f(Ki,ru),f(Ki,Hl,null);let Of=Ki;var $l,Fn,Nn,cu,Mv,hu,Fv,du,Nv;class yw{constructor(t){f(this,cu);f(this,hu);f(this,du);f(this,$l,null);f(this,Fn,null);f(this,Nn,void 0);g(this,Nn,t)}show(t,e,i){const[s,n]=v(this,hu,Fv).call(this,e,i),{style:r}=a(this,Fn)||g(this,Fn,v(this,cu,Mv).call(this));t.append(a(this,Fn)),r.insetInlineEnd=`${100*s}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,Fn).remove()}}$l=new WeakMap,Fn=new WeakMap,Nn=new WeakMap,cu=new WeakSet,Mv=function(){const t=g(this,Fn,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",ai,{signal:a(this,Nn)._signal});const e=g(this,$l,document.createElement("div"));return e.className="buttons",t.append(e),v(this,du,Nv).call(this),t},hu=new WeakSet,Fv=function(t,e){let i=0,s=0;for(const n of t){const r=n.y+n.height;if(r<i)continue;const o=n.x+(e?n.width:0);if(r>i){s=o,i=r;continue}e?o>s&&(s=o):o<s&&(s=o)}return[e?1-s:s,i]},du=new WeakSet,Nv=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=a(this,Nn)._signal;t.addEventListener("contextmenu",ai,{signal:i}),t.addEventListener("click",()=>{a(this,Nn).highlightSelection("floating_button")},{signal:i}),a(this,$l).append(t)};function Ov(l,t,e){for(const i of e)t.addEventListener(i,l[i].bind(l))}var uu;class xw{constructor(){f(this,uu,0)}get id(){return`${Av}${fe(this,uu)._++}`}}uu=new WeakMap;var Sr,Ul,le,Cr,wd;const pm=class pm{constructor(){f(this,Cr);f(this,Sr,Zg());f(this,Ul,0);f(this,le,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return J(this,"_isSVGFittingCanvas",n)}async getFromFile(t){const{lastModified:e,name:i,size:s,type:n}=t;return v(this,Cr,wd).call(this,`${e}_${i}_${s}_${n}`,t)}async getFromUrl(t){return v(this,Cr,wd).call(this,t,t)}async getFromBlob(t,e){const i=await e;return v(this,Cr,wd).call(this,t,i)}async getFromId(t){a(this,le)||g(this,le,new Map);const e=a(this,le).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)}getFromCanvas(t,e){a(this,le)||g(this,le,new Map);let i=a(this,le).get(t);if(i!=null&&i.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${a(this,Sr)}_${fe(this,Ul)._++}`,refCounter:1,isSvg:!1},a(this,le).set(t,i),a(this,le).set(i.id,i),i}getSvgUrl(t){const e=a(this,le).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var s;a(this,le)||g(this,le,new Map);const e=a(this,le).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:i}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=n.convertToBlob()}(s=i.close)==null||s.call(i),e.bitmap=null}isValidId(t){return t.startsWith(`image_${a(this,Sr)}_`)}};Sr=new WeakMap,Ul=new WeakMap,le=new WeakMap,Cr=new WeakSet,wd=async function(t,e){a(this,le)||g(this,le,new Map);let i=a(this,le).get(t);if(i===null)return null;if(i!=null&&i.bitmap)return i.refCounter+=1,i;try{i||(i={bitmap:null,id:`image_${a(this,Sr)}_${fe(this,Ul)._++}`,refCounter:0,isSvg:!1});let s;if(typeof e=="string"?(i.url=e,s=await nl(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){const n=pm._isSVGFittingCanvas,r=new FileReader,o=new Image,c=new Promise((h,d)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,h()},r.onload=async()=>{const u=i.svgUrl=r.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=r.onerror=d});r.readAsDataURL(s),await c}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){W(s),i=null}return a(this,le).set(t,i),i&&a(this,le).set(i.id,i),i};let jf=pm;var Rt,Os,Gl,wt;class ww{constructor(t=128){f(this,Rt,[]);f(this,Os,!1);f(this,Gl,void 0);f(this,wt,-1);g(this,Gl,t)}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:o=!1}){if(s&&t(),a(this,Os))return;const c={cmd:t,undo:e,post:i,type:n};if(a(this,wt)===-1){a(this,Rt).length>0&&(a(this,Rt).length=0),g(this,wt,0),a(this,Rt).push(c);return}if(r&&a(this,Rt)[a(this,wt)].type===n){o&&(c.undo=a(this,Rt)[a(this,wt)].undo),a(this,Rt)[a(this,wt)]=c;return}const h=a(this,wt)+1;h===a(this,Gl)?a(this,Rt).splice(0,1):(g(this,wt,h),h<a(this,Rt).length&&a(this,Rt).splice(h)),a(this,Rt).push(c)}undo(){if(a(this,wt)===-1)return;g(this,Os,!0);const{undo:t,post:e}=a(this,Rt)[a(this,wt)];t(),e==null||e(),g(this,Os,!1),g(this,wt,a(this,wt)-1)}redo(){if(a(this,wt)<a(this,Rt).length-1){g(this,wt,a(this,wt)+1),g(this,Os,!0);const{cmd:t,post:e}=a(this,Rt)[a(this,wt)];t(),e==null||e(),g(this,Os,!1)}}hasSomethingToUndo(){return a(this,wt)!==-1}hasSomethingToRedo(){return a(this,wt)<a(this,Rt).length-1}cleanType(t){if(a(this,wt)!==-1){for(let e=a(this,wt);e>=0;e--)if(a(this,Rt)[e].type!==t){a(this,Rt).splice(e+1,a(this,wt)-e),g(this,wt,e);return}a(this,Rt).length=0,g(this,wt,-1)}}destroy(){g(this,Rt,null)}}Rt=new WeakMap,Os=new WeakMap,Gl=new WeakMap,wt=new WeakMap;var pu,jv;class rd{constructor(t){f(this,pu);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Yt.platform;for(const[i,s,n={}]of t)for(const r of i){const o=r.startsWith("mac+");e&&o?(this.callbacks.set(r.slice(4),{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!o&&(this.callbacks.set(r,{callback:s,options:n}),this.allKeys.add(r.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const i=this.callbacks.get(v(this,pu,jv).call(this,e));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:r=[],checker:o=null}}=i;o&&!o(t,e)||(s.bind(t,...r,e)(),n||Dt(e))}}pu=new WeakSet,jv=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const fu=class fu{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return bw(t),J(this,"_colors",t)}convert(t){const e=em(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[i,s]of this._colors)if(s.every((n,r)=>n===e[r]))return fu._colorsMapping.get(i);return e}getHexCode(t){const e=this._colors.get(t);return e?$.makeHexColor(...e):t}};I(fu,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Bf=fu;var Tr,Ie,Bt,Jt,kr,Qi,Pr,Je,js,Bs,Rr,On,Ti,oi,jn,Vl,Wl,Lr,ql,ki,zs,Dr,Hs,Pi,gu,$s,Xl,Us,Bn,zn,Gs,Yl,Ht,at,Zi,Vs,Hn,Kl,Jl,Ws,Ri,ts,Ql,Zl,Qe,Ir,Ad,tc,zf,mu,Bv,vu,zv,Mr,Ed,bu,Hv,yu,$v,xu,Uv,ec,Hf,wu,Gv,ic,$f,sc,Uf,Au,Vv,Qt,ge,li,Xi,Eu,Wv,_u,qv,nc,Gf,Su,Xv,$n,ul,ac,Vf;const vr=class vr{constructor(t,e,i,s,n,r,o,c,h,d,u,p,m,y,b){f(this,Ir);f(this,tc);f(this,mu);f(this,vu);f(this,Mr);f(this,bu);f(this,yu);f(this,xu);f(this,ec);f(this,wu);f(this,ic);f(this,sc);f(this,Au);f(this,Qt);f(this,li);f(this,Eu);f(this,_u);f(this,nc);f(this,Su);f(this,$n);f(this,ac);f(this,Tr,new AbortController);f(this,Ie,null);f(this,Bt,new Map);f(this,Jt,new Map);f(this,kr,null);f(this,Qi,null);f(this,Pr,null);f(this,Je,new ww);f(this,js,null);f(this,Bs,null);f(this,Rr,0);f(this,On,new Set);f(this,Ti,null);f(this,oi,null);f(this,jn,new Set);I(this,"_editorUndoBar",null);f(this,Vl,!1);f(this,Wl,!1);f(this,Lr,!1);f(this,ql,null);f(this,ki,null);f(this,zs,null);f(this,Dr,null);f(this,Hs,!1);f(this,Pi,null);f(this,gu,new xw);f(this,$s,!1);f(this,Xl,!1);f(this,Us,null);f(this,Bn,null);f(this,zn,null);f(this,Gs,null);f(this,Yl,null);f(this,Ht,V.NONE);f(this,at,new Set);f(this,Zi,null);f(this,Vs,null);f(this,Hn,null);f(this,Kl,null);f(this,Jl,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});f(this,Ws,[0,0]);f(this,Ri,null);f(this,ts,null);f(this,Ql,null);f(this,Zl,null);f(this,Qe,null);const x=this._signal=a(this,Tr).signal;g(this,ts,t),g(this,Ql,e),g(this,Zl,i),g(this,kr,s),g(this,Vs,n),this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:x}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:x}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:x}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:x}),r._on("setpreference",this.onSetPreference.bind(this),{signal:x}),r._on("switchannotationeditorparams",w=>this.updateParams(w.type,w.value),{signal:x}),v(this,bu,Hv).call(this),v(this,Au,Vv).call(this),v(this,ec,Hf).call(this),g(this,Qi,o.annotationStorage),g(this,ql,o.filterFactory),g(this,Hn,c),g(this,Dr,h||null),g(this,Vl,d),g(this,Wl,u),g(this,Lr,p),g(this,Yl,m||null),this.viewParameters={realScale:Ds.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=y||null,this._supportsPinchToZoom=b!==!1}static get _keyboardManager(){const t=vr.prototype,e=r=>a(r,ts).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),i=(r,{target:o})=>{if(o instanceof HTMLInputElement){const{type:c}=o;return c!=="text"&&c!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return J(this,"_keyboardManager",new rd([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],t.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:i}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,ts).contains(o)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:o})=>!(o instanceof HTMLButtonElement)&&a(r,ts).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}destroy(){var t,e,i,s,n,r,o,c;(t=a(this,Qe))==null||t.resolve(),g(this,Qe,null),(e=a(this,Tr))==null||e.abort(),g(this,Tr,null),this._signal=null;for(const h of a(this,Jt).values())h.destroy();a(this,Jt).clear(),a(this,Bt).clear(),a(this,jn).clear(),(i=a(this,Gs))==null||i.clear(),g(this,Ie,null),a(this,at).clear(),a(this,Je).destroy(),(s=a(this,kr))==null||s.destroy(),(n=a(this,Vs))==null||n.destroy(),(r=a(this,Pi))==null||r.hide(),g(this,Pi,null),(o=a(this,zn))==null||o.destroy(),g(this,zn,null),a(this,ki)&&(clearTimeout(a(this,ki)),g(this,ki,null)),a(this,Ri)&&(clearTimeout(a(this,Ri)),g(this,Ri,null)),(c=this._editorUndoBar)==null||c.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return a(this,Yl)}get useNewAltTextFlow(){return a(this,Wl)}get useNewAltTextWhenAddingImage(){return a(this,Lr)}get hcmFilter(){return J(this,"hcmFilter",a(this,Hn)?a(this,ql).addHCMFilter(a(this,Hn).foreground,a(this,Hn).background):"none")}get direction(){return J(this,"direction",getComputedStyle(a(this,ts)).direction)}get highlightColors(){return J(this,"highlightColors",a(this,Dr)?new Map(a(this,Dr).split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColorNames(){return J(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,Bs,t)}setMainHighlightColorPicker(t){g(this,zn,t)}editAltText(t,e=!1){var i;(i=a(this,kr))==null||i.editAltText(this,t,e)}getSignature(t){var e;(e=a(this,Vs))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return a(this,Vs)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":g(this,Lr,e);break}}onPageChanging({pageNumber:t}){g(this,Rr,t-1)}focusMainContainer(){a(this,ts).focus()}findParent(t,e){for(const i of a(this,Jt).values()){const{x:s,y:n,width:r,height:o}=i.div.getBoundingClientRect();if(t>=s&&t<=s+r&&e>=n&&e<=n+o)return i}return null}disableUserSelect(t=!1){a(this,Ql).classList.toggle("noUserSelect",t)}addShouldRescale(t){a(this,jn).add(t)}removeShouldRescale(t){a(this,jn).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*Ds.PDF_TO_CSS_UNITS;for(const i of a(this,jn))i.onScaleChanging();(e=a(this,Bs))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r}=e,o=e.toString(),h=v(this,Ir,Ad).call(this,e).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;e.empty();const u=v(this,tc,zf).call(this,h),p=a(this,Ht)===V.NONE,m=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:r,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(V.HIGHLIGHT,m);return}m()}addToAnnotationStorage(t){!t.isEmpty()&&a(this,Qi)&&!a(this,Qi).has(t.id)&&a(this,Qi).setValue(t.id,t)}a11yAlert(t,e=null){const i=a(this,Zl);i&&(i.setAttribute("data-l10n-id",t),e?i.setAttribute("data-l10n-args",JSON.stringify(e)):i.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,a(this,Hs)&&(g(this,Hs,!1),v(this,Mr,Ed).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of a(this,at))if(e.div.contains(t)){g(this,Bn,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!a(this,Bn))return;const[t,e]=a(this,Bn);g(this,Bn,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){v(this,ec,Hf).call(this),v(this,ic,$f).call(this)}removeEditListeners(){v(this,wu,Gv).call(this),v(this,sc,Uf).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const i of a(this,oi))if(i.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const i of a(this,oi))if(i.isHandlingMimeForPasting(e.type)){i.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var i;if(t.preventDefault(),(i=a(this,Ie))==null||i.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of a(this,at)){const n=s.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of a(this,oi))if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let i=e.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){W(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const c of i){const h=await s.deserialize(c);if(!h)return;n.push(h)}const r=()=>{for(const c of n)v(this,nc,Gf).call(this,c);v(this,ac,Vf).call(this,n)},o=()=>{for(const c of n)c.remove()};this.addCommands({cmd:r,undo:o,mustExec:!0})}catch(n){W(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,Ht)!==V.NONE&&!this.isEditorHandlingKeyboard&&vr._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,Hs)&&(g(this,Hs,!1),v(this,Mr,Ed).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(v(this,yu,$v).call(this),v(this,ic,$f).call(this),v(this,Qt,ge).call(this,{isEditing:a(this,Ht)!==V.NONE,isEmpty:v(this,$n,ul).call(this),hasSomethingToUndo:a(this,Je).hasSomethingToUndo(),hasSomethingToRedo:a(this,Je).hasSomethingToRedo(),hasSelectedEditor:!1})):(v(this,xu,Uv).call(this),v(this,sc,Uf).call(this),v(this,Qt,ge).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!a(this,oi)){g(this,oi,t);for(const e of a(this,oi))v(this,li,Xi).call(this,e.defaultPropertiesToUpdate)}}getId(){return a(this,gu).id}get currentLayer(){return a(this,Jt).get(a(this,Rr))}getLayer(t){return a(this,Jt).get(t)}get currentPageIndex(){return a(this,Rr)}addLayer(t){a(this,Jt).set(t.pageIndex,t),a(this,$s)?t.enable():t.disable()}removeLayer(t){a(this,Jt).delete(t.pageIndex)}async updateMode(t,e=null,i=!1,s=!1){var n,r,o;if(a(this,Ht)!==t&&!(a(this,Qe)&&(await a(this,Qe).promise,!a(this,Qe)))){if(g(this,Qe,Promise.withResolvers()),(n=a(this,Bs))==null||n.commitOrRemove(),g(this,Ht,t),t===V.NONE){this.setEditingState(!1),v(this,_u,qv).call(this),(r=this._editorUndoBar)==null||r.hide(),a(this,Qe).resolve();return}t===V.SIGNATURE&&await((o=a(this,Vs))==null?void 0:o.loadSignatures()),this.setEditingState(!0),await v(this,Eu,Wv).call(this),this.unselectAll();for(const c of a(this,Jt).values())c.updateMode(t);if(!e){i&&this.addNewEditorFromKeyboard(),a(this,Qe).resolve();return}for(const c of a(this,Bt).values())c.annotationElementId===e||c.id===e?(this.setSelected(c),s&&c.enterInEditMode()):c.unselect();a(this,Qe).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==a(this,Ht)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){var i;if(a(this,oi)){switch(t){case Q.CREATE:this.currentLayer.addNewEditor(e);return;case Q.HIGHLIGHT_DEFAULT_COLOR:(i=a(this,zn))==null||i.updateColor(e);break;case Q.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,Kl)||g(this,Kl,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const s of a(this,at))s.updateParams(t,e);for(const s of a(this,oi))s.updateDefaultParams(t,e)}}showAllEditors(t,e,i=!1){var n;for(const r of a(this,Bt).values())r.editorType===t&&r.show(e);(((n=a(this,Kl))==null?void 0:n.get(Q.HIGHLIGHT_SHOW_ALL))??!0)!==e&&v(this,li,Xi).call(this,[[Q.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(a(this,Xl)!==t){g(this,Xl,t);for(const e of a(this,Jt).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const i of a(this,Bt).values())i.pageIndex===t&&e.push(i);return e}getEditor(t){return a(this,Bt).get(t)}addEditor(t){a(this,Bt).set(t.id,t)}removeEditor(t){var e,i;t.div.contains(document.activeElement)&&(a(this,ki)&&clearTimeout(a(this,ki)),g(this,ki,setTimeout(()=>{this.focusMainContainer(),g(this,ki,null)},0))),a(this,Bt).delete(t.id),t.annotationElementId&&((e=a(this,Gs))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!a(this,On).has(t.annotationElementId))&&((i=a(this,Qi))==null||i.remove(t.id))}addDeletedAnnotationElement(t){a(this,On).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return a(this,On).has(t)}removeDeletedAnnotationElement(t){a(this,On).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){a(this,Ie)!==t&&(g(this,Ie,t),t&&v(this,li,Xi).call(this,t.propertiesToUpdate))}updateUI(t){a(this,Su,Xv)===t&&v(this,li,Xi).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){v(this,li,Xi).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(a(this,at).has(t)){a(this,at).delete(t),t.unselect(),v(this,Qt,ge).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,at).add(t),t.select(),v(this,li,Xi).call(this,t.propertiesToUpdate),v(this,Qt,ge).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;this.updateToolbar({mode:t.mode,editId:t.id}),(e=a(this,Bs))==null||e.commitOrRemove();for(const i of a(this,at))i!==t&&i.unselect();a(this,at).clear(),a(this,at).add(t),t.select(),v(this,li,Xi).call(this,t.propertiesToUpdate),v(this,Qt,ge).call(this,{hasSelectedEditor:!0})}isSelected(t){return a(this,at).has(t)}get firstSelectedEditor(){return a(this,at).values().next().value}unselect(t){t.unselect(),a(this,at).delete(t),v(this,Qt,ge).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,at).size!==0}get isEnterHandled(){return a(this,at).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;a(this,Je).undo(),v(this,Qt,ge).call(this,{hasSomethingToUndo:a(this,Je).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:v(this,$n,ul).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){a(this,Je).redo(),v(this,Qt,ge).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,Je).hasSomethingToRedo(),isEmpty:v(this,$n,ul).call(this)})}addCommands(t){a(this,Je).add(t),v(this,Qt,ge).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:v(this,$n,ul).call(this)})}cleanUndoStack(t){a(this,Je).cleanType(t)}delete(){var n;this.commitOrRemove();const t=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...a(this,at)],i=()=>{var r;(r=this._editorUndoBar)==null||r.show(s,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},s=()=>{for(const r of e)v(this,nc,Gf).call(this,r)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){var t;(t=a(this,Ie))==null||t.commitOrRemove()}hasSomethingToControl(){return a(this,Ie)||this.hasSelection}selectAll(){for(const t of a(this,at))t.commit();v(this,ac,Vf).call(this,a(this,Bt).values())}unselectAll(){var t;if(!(a(this,Ie)&&(a(this,Ie).commitOrRemove(),a(this,Ht)!==V.NONE))&&!((t=a(this,Bs))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of a(this,at))e.unselect();a(this,at).clear(),v(this,Qt,ge).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;a(this,Ws)[0]+=t,a(this,Ws)[1]+=e;const[s,n]=a(this,Ws),r=[...a(this,at)],o=1e3;a(this,Ri)&&clearTimeout(a(this,Ri)),g(this,Ri,setTimeout(()=>{g(this,Ri,null),a(this,Ws)[0]=a(this,Ws)[1]=0,this.addCommands({cmd:()=>{for(const c of r)a(this,Bt).has(c.id)&&(c.translateInPage(s,n),c.translationDone())},undo:()=>{for(const c of r)a(this,Bt).has(c.id)&&(c.translateInPage(-s,-n),c.translationDone())},mustExec:!1})},o));for(const c of r)c.translateInPage(t,e),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,Ti,new Map);for(const t of a(this,at))a(this,Ti).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,Ti))return!1;this.disableUserSelect(!1);const t=a(this,Ti);g(this,Ti,null);let e=!1;for(const[{x:s,y:n,pageIndex:r},o]of t)o.newX=s,o.newY=n,o.newPageIndex=r,e||(e=s!==o.savedX||n!==o.savedY||r!==o.savedPageIndex);if(!e)return!1;const i=(s,n,r,o)=>{if(a(this,Bt).has(s.id)){const c=a(this,Jt).get(o);c?s._setParentAndPosition(c,n,r):(s.pageIndex=o,s.x=n,s.y=r)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:r,newPageIndex:o}]of t)i(s,n,r,o)},undo:()=>{for(const[s,{savedX:n,savedY:r,savedPageIndex:o}]of t)i(s,n,r,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(a(this,Ti))for(const i of a(this,Ti).keys())i.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||a(this,at).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return a(this,Ie)===t}getActive(){return a(this,Ie)}getMode(){return a(this,Ht)}get imageManager(){return J(this,"imageManager",new jf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,d=e.rangeCount;h<d;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:r}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(h,d,u,p)=>({x:(d-s)/r,y:1-(h+u-i)/n,width:p/r,height:u/n});break;case"180":o=(h,d,u,p)=>({x:1-(h+u-i)/n,y:1-(d+p-s)/r,width:u/n,height:p/r});break;case"270":o=(h,d,u,p)=>({x:1-(d+p-s)/r,y:(h-i)/n,width:p/r,height:u/n});break;default:o=(h,d,u,p)=>({x:(h-i)/n,y:(d-s)/r,width:u/n,height:p/r});break}const c=[];for(let h=0,d=e.rangeCount;h<d;h++){const u=e.getRangeAt(h);if(!u.collapsed)for(const{x:p,y:m,width:y,height:b}of u.getClientRects())y===0||b===0||c.push(o(p,m,y,b))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:t,id:e}){(a(this,Pr)||g(this,Pr,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=a(this,Pr))==null||e.delete(t)}renderAnnotationElement(t){var s;const e=(s=a(this,Pr))==null?void 0:s.get(t.data.id);if(!e)return;const i=a(this,Qi).getRawValue(e);i&&(a(this,Ht)===V.NONE&&!i.hasBeenModified||i.renderAnnotationElement(t))}setMissingCanvas(t,e,i){var n;const s=(n=a(this,Gs))==null?void 0:n.get(t);s&&(s.setCanvas(e,i),a(this,Gs).delete(t))}addMissingCanvas(t,e){(a(this,Gs)||g(this,Gs,new Map)).set(t,e)}};Tr=new WeakMap,Ie=new WeakMap,Bt=new WeakMap,Jt=new WeakMap,kr=new WeakMap,Qi=new WeakMap,Pr=new WeakMap,Je=new WeakMap,js=new WeakMap,Bs=new WeakMap,Rr=new WeakMap,On=new WeakMap,Ti=new WeakMap,oi=new WeakMap,jn=new WeakMap,Vl=new WeakMap,Wl=new WeakMap,Lr=new WeakMap,ql=new WeakMap,ki=new WeakMap,zs=new WeakMap,Dr=new WeakMap,Hs=new WeakMap,Pi=new WeakMap,gu=new WeakMap,$s=new WeakMap,Xl=new WeakMap,Us=new WeakMap,Bn=new WeakMap,zn=new WeakMap,Gs=new WeakMap,Yl=new WeakMap,Ht=new WeakMap,at=new WeakMap,Zi=new WeakMap,Vs=new WeakMap,Hn=new WeakMap,Kl=new WeakMap,Jl=new WeakMap,Ws=new WeakMap,Ri=new WeakMap,ts=new WeakMap,Ql=new WeakMap,Zl=new WeakMap,Qe=new WeakMap,Ir=new WeakSet,Ad=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},tc=new WeakSet,zf=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const i of a(this,Jt).values())if(i.hasTextLayer(t))return i;return null},mu=new WeakSet,Bv=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const i=v(this,Ir,Ad).call(this,t).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(a(this,Pi)||g(this,Pi,new yw(this)),a(this,Pi).show(i,s,this.direction==="ltr"))},vu=new WeakSet,zv=function(){var n,r,o;const t=document.getSelection();if(!t||t.isCollapsed){a(this,Zi)&&((n=a(this,Pi))==null||n.hide(),g(this,Zi,null),v(this,Qt,ge).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===a(this,Zi))return;const s=v(this,Ir,Ad).call(this,t).closest(".textLayer");if(!s){a(this,Zi)&&((r=a(this,Pi))==null||r.hide(),g(this,Zi,null),v(this,Qt,ge).call(this,{hasSelectedText:!1}));return}if((o=a(this,Pi))==null||o.hide(),g(this,Zi,e),v(this,Qt,ge).call(this,{hasSelectedText:!0}),!(a(this,Ht)!==V.HIGHLIGHT&&a(this,Ht)!==V.NONE)&&(a(this,Ht)===V.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,Hs,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=a(this,Ht)===V.HIGHLIGHT?v(this,tc,zf).call(this,s):null;c==null||c.toggleDrawing();const h=new AbortController,d=this.combinedSignal(h),u=p=>{p.type==="pointerup"&&p.button!==0||(h.abort(),c==null||c.toggleDrawing(!0),p.type==="pointerup"&&v(this,Mr,Ed).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("blur",u,{signal:d})}},Mr=new WeakSet,Ed=function(t=""){a(this,Ht)===V.HIGHLIGHT?this.highlightSelection(t):a(this,Vl)&&v(this,mu,Bv).call(this)},bu=new WeakSet,Hv=function(){document.addEventListener("selectionchange",v(this,vu,zv).bind(this),{signal:this._signal})},yu=new WeakSet,$v=function(){if(a(this,zs))return;g(this,zs,new AbortController);const t=this.combinedSignal(a(this,zs));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},xu=new WeakSet,Uv=function(){var t;(t=a(this,zs))==null||t.abort(),g(this,zs,null)},ec=new WeakSet,Hf=function(){if(a(this,Us))return;g(this,Us,new AbortController);const t=this.combinedSignal(a(this,Us));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},wu=new WeakSet,Gv=function(){var t;(t=a(this,Us))==null||t.abort(),g(this,Us,null)},ic=new WeakSet,$f=function(){if(a(this,js))return;g(this,js,new AbortController);const t=this.combinedSignal(a(this,js));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},sc=new WeakSet,Uf=function(){var t;(t=a(this,js))==null||t.abort(),g(this,js,null)},Au=new WeakSet,Vv=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},Qt=new WeakSet,ge=function(t){Object.entries(t).some(([i,s])=>a(this,Jl)[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,Jl),t)}),a(this,Ht)===V.HIGHLIGHT&&t.hasSelectedEditor===!1&&v(this,li,Xi).call(this,[[Q.HIGHLIGHT_FREE,!0]]))},li=new WeakSet,Xi=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},Eu=new WeakSet,Wv=async function(){if(!a(this,$s)){g(this,$s,!0);const t=[];for(const e of a(this,Jt).values())t.push(e.enable());await Promise.all(t);for(const e of a(this,Bt).values())e.enable()}},_u=new WeakSet,qv=function(){if(this.unselectAll(),a(this,$s)){g(this,$s,!1);for(const t of a(this,Jt).values())t.disable();for(const t of a(this,Bt).values())t.disable()}},nc=new WeakSet,Gf=function(t){const e=a(this,Jt).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},Su=new WeakSet,Xv=function(){let t=null;for(t of a(this,at));return t},$n=new WeakSet,ul=function(){if(a(this,Bt).size===0)return!0;if(a(this,Bt).size===1)for(const t of a(this,Bt).values())return t.isEmpty();return!1},ac=new WeakSet,Vf=function(t){for(const e of a(this,at))e.unselect();a(this,at).clear();for(const e of t)e.isEmpty()||(a(this,at).add(e),e.select());v(this,Qt,ge).call(this,{hasSelectedEditor:this.hasSelection})},I(vr,"TRANSLATE_SMALL",1),I(vr,"TRANSLATE_BIG",10);let Sn=vr;var $t,Li,ci,Fr,Di,Me,Nr,Ii,Ce,es,Un,Mi,qs,Gn,pl,Or,_d;const me=class me{constructor(t){f(this,Gn);f(this,Or);f(this,$t,null);f(this,Li,!1);f(this,ci,null);f(this,Fr,null);f(this,Di,null);f(this,Me,null);f(this,Nr,!1);f(this,Ii,null);f(this,Ce,null);f(this,es,null);f(this,Un,null);f(this,Mi,!1);g(this,Ce,t),g(this,Mi,t._uiManager.useNewAltTextFlow),a(me,qs)||g(me,qs,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){me._l10n??(me._l10n=t)}async render(){const t=g(this,ci,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=g(this,Fr,document.createElement("span"));t.append(e),a(this,Mi)?(t.classList.add("new"),t.setAttribute("data-l10n-id",a(me,qs).missing),e.setAttribute("data-l10n-id",a(me,qs)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=a(this,Ce)._uiManager._signal;t.addEventListener("contextmenu",ai,{signal:i}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),a(this,Ce)._uiManager.editAltText(a(this,Ce)),a(this,Mi)&&a(this,Ce)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,Gn,pl)}})};return t.addEventListener("click",s,{capture:!0,signal:i}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(g(this,Nr,!0),s(n))},{signal:i}),await v(this,Or,_d).call(this),t}finish(){a(this,ci)&&(a(this,ci).focus({focusVisible:a(this,Nr)}),g(this,Nr,!1))}isEmpty(){return a(this,Mi)?a(this,$t)===null:!a(this,$t)&&!a(this,Li)}hasData(){return a(this,Mi)?a(this,$t)!==null||!!a(this,es):this.isEmpty()}get guessedText(){return a(this,es)}async setGuessedText(t){a(this,$t)===null&&(g(this,es,t),g(this,Un,await me._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),v(this,Or,_d).call(this))}toggleAltTextBadge(t=!1){var e;if(!a(this,Mi)||a(this,$t)){(e=a(this,Ii))==null||e.remove(),g(this,Ii,null);return}if(!a(this,Ii)){const i=g(this,Ii,document.createElement("div"));i.className="noAltTextBadge",a(this,Ce).div.append(i)}a(this,Ii).classList.toggle("hidden",!t)}serialize(t){let e=a(this,$t);return!t&&a(this,es)===e&&(e=a(this,Un)),{altText:e,decorative:a(this,Li),guessedText:a(this,es),textWithDisclaimer:a(this,Un)}}get data(){return{altText:a(this,$t),decorative:a(this,Li)}}set data({altText:t,decorative:e,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(g(this,es,i),g(this,Un,s)),!(a(this,$t)===t&&a(this,Li)===e)&&(n||(g(this,$t,t),g(this,Li,e)),v(this,Or,_d).call(this))}toggle(t=!1){a(this,ci)&&(!t&&a(this,Me)&&(clearTimeout(a(this,Me)),g(this,Me,null)),a(this,ci).disabled=!t)}shown(){a(this,Ce)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,Gn,pl)}})}destroy(){var t,e;(t=a(this,ci))==null||t.remove(),g(this,ci,null),g(this,Fr,null),g(this,Di,null),(e=a(this,Ii))==null||e.remove(),g(this,Ii,null)}};$t=new WeakMap,Li=new WeakMap,ci=new WeakMap,Fr=new WeakMap,Di=new WeakMap,Me=new WeakMap,Nr=new WeakMap,Ii=new WeakMap,Ce=new WeakMap,es=new WeakMap,Un=new WeakMap,Mi=new WeakMap,qs=new WeakMap,Gn=new WeakSet,pl=function(){return a(this,$t)&&"added"||a(this,$t)===null&&this.guessedText&&"review"||"missing"},Or=new WeakSet,_d=async function(){var s,n,r;const t=a(this,ci);if(!t)return;if(a(this,Mi)){if(t.classList.toggle("done",!!a(this,$t)),t.setAttribute("data-l10n-id",a(me,qs)[a(this,Gn,pl)]),(s=a(this,Fr))==null||s.setAttribute("data-l10n-id",a(me,qs)[`${a(this,Gn,pl)}-label`]),!a(this,$t)){(n=a(this,Di))==null||n.remove();return}}else{if(!a(this,$t)&&!a(this,Li)){t.classList.remove("done"),(r=a(this,Di))==null||r.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=a(this,Di);if(!e){g(this,Di,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${a(this,Ce).id}`;const o=100,c=a(this,Ce)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(a(this,Me)),g(this,Me,null)},{once:!0}),t.addEventListener("mouseenter",()=>{g(this,Me,setTimeout(()=>{g(this,Me,null),a(this,Di).classList.add("show"),a(this,Ce)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:c}),t.addEventListener("mouseleave",()=>{var h;a(this,Me)&&(clearTimeout(a(this,Me)),g(this,Me,null)),(h=a(this,Di))==null||h.classList.remove("show")},{signal:c})}a(this,Li)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=a(this,$t)),e.parentNode||t.append(e);const i=a(this,Ce).getElementForAltText();i==null||i.setAttribute("aria-describedby",e.id)},f(me,qs,null),I(me,"_l10n",null);let tu=me;var jr,Vn,rc,oc,lc,cc,hc,is,Wn,ss,qn,ns,Cu,Yv,Tu,Kv,ku,Jv;const fm=class fm{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:r=null,signal:o}){f(this,Cu);f(this,Tu);f(this,ku);f(this,jr,void 0);f(this,Vn,!1);f(this,rc,null);f(this,oc,void 0);f(this,lc,void 0);f(this,cc,void 0);f(this,hc,void 0);f(this,is,null);f(this,Wn,void 0);f(this,ss,null);f(this,qn,void 0);f(this,ns,null);g(this,jr,t),g(this,rc,i),g(this,oc,e),g(this,lc,s),g(this,cc,n),g(this,hc,r),g(this,qn,new AbortController),g(this,Wn,AbortSignal.any([o,a(this,qn).signal])),t.addEventListener("touchstart",v(this,Cu,Yv).bind(this),{passive:!1,signal:a(this,Wn)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/wi.pixelRatio}destroy(){var t,e;(t=a(this,qn))==null||t.abort(),g(this,qn,null),(e=a(this,is))==null||e.abort(),g(this,is,null)}};jr=new WeakMap,Vn=new WeakMap,rc=new WeakMap,oc=new WeakMap,lc=new WeakMap,cc=new WeakMap,hc=new WeakMap,is=new WeakMap,Wn=new WeakMap,ss=new WeakMap,qn=new WeakMap,ns=new WeakMap,Cu=new WeakSet,Yv=function(t){var s,n,r;if((s=a(this,oc))!=null&&s.call(this))return;if(t.touches.length===1){if(a(this,is))return;const o=g(this,is,new AbortController),c=AbortSignal.any([a(this,Wn),o.signal]),h=a(this,jr),d={capture:!0,signal:c,passive:!1},u=p=>{var m;p.pointerType==="touch"&&((m=a(this,is))==null||m.abort(),g(this,is,null))};h.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Dt(p),u(p))},d),h.addEventListener("pointerup",u,d),h.addEventListener("pointercancel",u,d);return}if(!a(this,ns)){g(this,ns,new AbortController);const o=AbortSignal.any([a(this,Wn),a(this,ns).signal]),c=a(this,jr),h={signal:o,capture:!1,passive:!1};c.addEventListener("touchmove",v(this,Tu,Kv).bind(this),h);const d=v(this,ku,Jv).bind(this);c.addEventListener("touchend",d,h),c.addEventListener("touchcancel",d,h),h.capture=!0,c.addEventListener("pointerdown",Dt,h),c.addEventListener("pointermove",Dt,h),c.addEventListener("pointercancel",Dt,h),c.addEventListener("pointerup",Dt,h),(n=a(this,lc))==null||n.call(this)}if(Dt(t),t.touches.length!==2||(r=a(this,rc))!=null&&r.call(this)){g(this,ss,null);return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),g(this,ss,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY})},Tu=new WeakSet,Kv=function(t){var _;if(!a(this,ss)||t.touches.length!==2)return;Dt(t);let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);const{screenX:s,screenY:n}=e,{screenX:r,screenY:o}=i,c=a(this,ss),{touch0X:h,touch0Y:d,touch1X:u,touch1Y:p}=c,m=u-h,y=p-d,b=r-s,x=o-n,w=Math.hypot(b,x)||1,E=Math.hypot(m,y)||1;if(!a(this,Vn)&&Math.abs(E-w)<=fm.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=s,c.touch0Y=n,c.touch1X=r,c.touch1Y=o,!a(this,Vn)){g(this,Vn,!0);return}const A=[(s+r)/2,(n+o)/2];(_=a(this,cc))==null||_.call(this,A,E,w)},ku=new WeakSet,Jv=function(t){var e;t.touches.length>=2||(a(this,ns)&&(a(this,ns).abort(),g(this,ns,null),(e=a(this,hc))==null||e.call(this)),a(this,ss)&&(Dt(t),g(this,ss,null),g(this,Vn,!1)))};let Il=fm;var Xn,hi,vt,Br,Xs,dc,Yn,Zt,Kn,as,Ys,uc,Jn,Fe,pc,Qn,rs,Fi,zr,Hr,Ze,Zn,fc,Pu,gc,Wf,mc,qf,$r,Sd,Ru,Qv,Lu,Zv,vc,Xf,Ur,Cd,bc,Yf,Du,tb,Iu,eb,Mu,ib,yc,Kf,Fu,sb,xc,Jf,Nu,nb,Ou,ab,ju,rb,wc,Qf,ta,fl;const Y=class Y{constructor(t){f(this,gc);f(this,$r);f(this,Ru);f(this,Lu);f(this,vc);f(this,Ur);f(this,bc);f(this,Du);f(this,Iu);f(this,Mu);f(this,yc);f(this,Fu);f(this,xc);f(this,Nu);f(this,Ou);f(this,ju);f(this,wc);f(this,ta);f(this,Xn,null);f(this,hi,null);f(this,vt,null);f(this,Br,!1);f(this,Xs,null);f(this,dc,"");f(this,Yn,!1);f(this,Zt,null);f(this,Kn,null);f(this,as,null);f(this,Ys,null);f(this,uc,"");f(this,Jn,!1);f(this,Fe,null);f(this,pc,!1);f(this,Qn,!1);f(this,rs,!1);f(this,Fi,null);f(this,zr,0);f(this,Hr,0);f(this,Ze,null);f(this,Zn,null);I(this,"isSelected",!1);I(this,"_isCopy",!1);I(this,"_editToolbar",null);I(this,"_initialOptions",Object.create(null));I(this,"_initialData",null);I(this,"_isVisible",!0);I(this,"_uiManager",null);I(this,"_focusEventsAllowed",!0);f(this,fc,!1);f(this,Pu,Y._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,r];const[o,c]=this.parentDimensions;this.x=t.x/o,this.y=t.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=Y.prototype._resizeWithKeyboard,e=Sn.TRANSLATE_SMALL,i=Sn.TRANSLATE_BIG;return J(this,"_resizerKeyboardManager",new rd([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],Y.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return J(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Aw({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(Y._l10n??(Y._l10n=t),Y._l10nResizer||(Y._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),Y._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);Y._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){lt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,fc)}set _isDraggable(t){var e;g(this,fc,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,Pu)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):v(this,ta,fl).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(a(this,Jn)?g(this,Jn,!1):this.parent.setSelected(this))}focusout(t){var i;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(i=this.parent)!=null&&i.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){const[n,r]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s),this._onTranslated()}translate(t,e){v(this,gc,Wf).call(this,this.parentDimensions,t,e)}translateInPage(t,e){a(this,Fe)||g(this,Fe,[this.x,this.y,this.width,this.height]),v(this,gc,Wf).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){a(this,Fe)||g(this,Fe,[this.x,this.y,this.width,this.height]);const{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:o}=this;const[c,h]=this.getBaseTranslation();r+=c,o+=h;const{style:d}=i;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(r,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!a(this,Fe)&&(a(this,Fe)[0]!==this.x||a(this,Fe)[1]!==this.y)}get _hasBeenResized(){return!!a(this,Fe)&&(a(this,Fe)[2]!==this.width||a(this,Fe)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:i}=Y,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[i,s]}=this;let{x:n,y:r,width:o,height:c}=this;if(o*=i,c*=s,n*=i,r*=s,this._mustFixPosition)switch(t){case 0:n=de(n,0,i-o),r=de(r,0,s-c);break;case 90:n=de(n,0,i-c),r=de(r,o,s);break;case 180:n=de(n,o,i),r=de(r,c,s);break;case 270:n=de(n,c,i),r=de(r,0,s-o);break}this.x=n/=i,this.y=r/=s;const[h,d]=this.getBaseTranslation();n+=h,r+=d,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var i;return v(i=Y,mc,qf).call(i,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var i;return v(i=Y,mc,qf).call(i,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){const[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/i).toFixed(2)}%`,a(this,Yn)||(n.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!a(this,Yn)&&e.endsWith("%");if(s&&n)return;const[r,o]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/r).toFixed(2)}%`),!a(this,Yn)&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=a(this,vt))==null||t.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||a(this,Qn))return this._editToolbar;this._editToolbar=new Of(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,i]of t)await this._editToolbar.addButton(e,i);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=a(this,vt))==null||t.destroy())}addContainer(t){var i;const e=(i=this._editToolbar)==null?void 0:i.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return a(this,vt)||(tu.initialize(Y._l10n),g(this,vt,new tu(this)),a(this,Xn)&&(a(this,vt).data=a(this,Xn),g(this,Xn,null))),a(this,vt)}get altTextData(){var t;return(t=a(this,vt))==null?void 0:t.data}set altTextData(t){a(this,vt)&&(a(this,vt).data=t)}get guessedAltText(){var t;return(t=a(this,vt))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=a(this,vt))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=a(this,vt))==null?void 0:e.serialize(t)}hasAltText(){return!!a(this,vt)&&!a(this,vt).isEmpty()}hasAltTextData(){var t;return((t=a(this,vt))==null?void 0:t.hasData())??!1}render(){var r;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=a(this,Br)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),v(this,xc,Jf).call(this);const[e,i]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*i/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/i).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),Ov(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,Zn)||g(this,Zn,new Il({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:v(this,Du,tb).bind(this),onPinching:v(this,Iu,eb).bind(this),onPinchEnd:v(this,Mu,ib).bind(this),signal:this._uiManager._signal}))),(r=this._uiManager._editorUndoBar)==null||r.hide(),t}pointerdown(t){const{isMac:e}=Yt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(g(this,Jn,!0),this._isDraggable){v(this,Fu,sb).call(this,t);return}v(this,yc,Kf).call(this,t)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,Fi)&&clearTimeout(a(this,Fi)),g(this,Fi,setTimeout(()=>{var t;g(this,Fi,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){const s=this.parentScale,[n,r]=this.pageDimensions,[o,c]=this.pageTranslation,h=t/s,d=e/s,u=this.x*n,p=this.y*r,m=this.width*n,y=this.height*r;switch(i){case 0:return[u+h+o,r-p-d-y+c,u+h+m+o,r-p-d+c];case 90:return[u+d+o,r-p+h+c,u+d+y+o,r-p+h+m+c];case 180:return[u-h-m+o,r-p+d+c,u-h+o,r-p+d+y+c];case 270:return[u-d-y+o,r-p-h-m+c,u-d+o,r-p-h+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[i,s,n,r]=t,o=n-i,c=r-s;switch(this.rotation){case 0:return[i,e-r,o,c];case 90:return[i,e-s,c,o];case 180:return[n,e-s,o,c];case 270:return[n,e-r,c,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),g(this,Qn,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),g(this,Qn,!1),!0):!1}isInEditMode(){return a(this,Qn)}shouldGetKeyboardEvents(){return a(this,rs)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&s>0&&t<n&&i>0}rebuild(){v(this,xc,Jf).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){lt("An editor must be serializable")}static async deserialize(t,e,i){const s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i,annotationElementId:t.annotationElementId});s.rotation=t.rotation,g(s,Xn,t.accessibilityData),s._isCopy=t.isCopy||!1;const[n,r]=s.pageDimensions,[o,c,h,d]=s.getRectInCurrentCoords(t.rect,r);return s.x=o/n,s.y=c/r,s.width=h/n,s.height=d/r,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=a(this,Ys))==null||t.abort(),g(this,Ys,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),a(this,Fi)&&(clearTimeout(a(this,Fi)),g(this,Fi,null)),v(this,ta,fl).call(this),this.removeEditToolbar(),a(this,Ze)){for(const i of a(this,Ze).values())clearTimeout(i);g(this,Ze,null)}this.parent=null,(e=a(this,Zn))==null||e.destroy(),g(this,Zn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(v(this,Ru,Qv).call(this),a(this,Zt).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),g(this,as,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=a(this,Zt).children;if(!a(this,hi)){g(this,hi,Array.from(e));const r=v(this,Nu,nb).bind(this),o=v(this,Ou,ab).bind(this),c=this._uiManager._signal;for(const h of a(this,hi)){const d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",r,{signal:c}),h.addEventListener("blur",o,{signal:c}),h.addEventListener("focus",v(this,ju,rb).bind(this,d),{signal:c}),h.setAttribute("data-l10n-id",Y._l10nResizer[d])}}const i=a(this,hi)[0];let s=0;for(const r of e){if(r===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(a(this,hi).length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)a(this,Zt).append(a(this,Zt).firstChild);else if(n>s)for(let o=0;o<n-s;o++)a(this,Zt).firstChild.before(a(this,Zt).lastChild);let r=0;for(const o of e){const h=a(this,hi)[r++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",Y._l10nResizer[h])}}v(this,wc,Qf).call(this,0),g(this,rs,!0),a(this,Zt).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){a(this,rs)&&v(this,bc,Yf).call(this,a(this,uc),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){v(this,ta,fl).call(this),this.div.focus()}select(){var t,e,i;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,n;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(e=this._editToolbar)==null||e.show(),(i=a(this,vt))==null||i.toggleAltTextBadge(!1)}}unselect(){var t,e,i,s,n;this.isSelected&&(this.isSelected=!1,(t=a(this,Zt))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(i=this.div)!=null&&i.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(n=a(this,vt))==null||n.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return a(this,pc)}set isEditing(t){g(this,pc,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){g(this,Yn,!0);const i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){a(this,Ze)||g(this,Ze,new Map);const{action:i}=t;let s=a(this,Ze).get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),a(this,Ze).delete(i),a(this,Ze).size===0&&g(this,Ze,null)},Y._telemetryTimeout),a(this,Ze).set(i,s);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),g(this,Br,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,Br,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};Xn=new WeakMap,hi=new WeakMap,vt=new WeakMap,Br=new WeakMap,Xs=new WeakMap,dc=new WeakMap,Yn=new WeakMap,Zt=new WeakMap,Kn=new WeakMap,as=new WeakMap,Ys=new WeakMap,uc=new WeakMap,Jn=new WeakMap,Fe=new WeakMap,pc=new WeakMap,Qn=new WeakMap,rs=new WeakMap,Fi=new WeakMap,zr=new WeakMap,Hr=new WeakMap,Ze=new WeakMap,Zn=new WeakMap,fc=new WeakMap,Pu=new WeakMap,gc=new WeakSet,Wf=function([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},mc=new WeakSet,qf=function(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},$r=new WeakSet,Sd=function(t){switch(t){case 90:{const[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}},Ru=new WeakSet,Qv=function(){if(a(this,Zt))return;g(this,Zt,document.createElement("div")),a(this,Zt).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){const s=document.createElement("div");a(this,Zt).append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",v(this,Lu,Zv).bind(this,i),{signal:e}),s.addEventListener("contextmenu",ai,{signal:e}),s.tabIndex=-1}this.div.prepend(a(this,Zt))},Lu=new WeakSet,Zv=function(t,e){var d;e.preventDefault();const{isMac:i}=Yt.platform;if(e.button!==0||e.ctrlKey&&i)return;(d=a(this,vt))==null||d.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,g(this,Kn,[e.screenX,e.screenY]);const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",v(this,bc,Yf).bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",Dt,{passive:!1,signal:r}),window.addEventListener("contextmenu",ai,{signal:r}),g(this,as,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=a(this,vt))==null||u.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=c,v(this,Ur,Cd).call(this)};window.addEventListener("pointerup",h,{signal:r}),window.addEventListener("blur",h,{signal:r})},vc=new WeakSet,Xf=function(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e;const[n,r]=this.parentDimensions;this.setDims(n*i,r*s),this.fixAndSetPosition(),this._onResized()},Ur=new WeakSet,Cd=function(){if(!a(this,as))return;const{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=a(this,as);g(this,as,null);const n=this.x,r=this.y,o=this.width,c=this.height;n===t&&r===e&&o===i&&c===s||this.addCommands({cmd:v(this,vc,Xf).bind(this,n,r,o,c),undo:v(this,vc,Xf).bind(this,t,e,i,s),mustExec:!0})},bc=new WeakSet,Yf=function(t,e){const[i,s]=this.parentDimensions,n=this.x,r=this.y,o=this.width,c=this.height,h=Y.MIN_SIZE/i,d=Y.MIN_SIZE/s,u=v(this,$r,Sd).call(this,this.rotation),p=(F,N)=>[u[0]*F+u[2]*N,u[1]*F+u[3]*N],m=v(this,$r,Sd).call(this,360-this.rotation),y=(F,N)=>[m[0]*F+m[2]*N,m[1]*F+m[3]*N];let b,x,w=!1,E=!1;switch(t){case"topLeft":w=!0,b=(F,N)=>[0,0],x=(F,N)=>[F,N];break;case"topMiddle":b=(F,N)=>[F/2,0],x=(F,N)=>[F/2,N];break;case"topRight":w=!0,b=(F,N)=>[F,0],x=(F,N)=>[0,N];break;case"middleRight":E=!0,b=(F,N)=>[F,N/2],x=(F,N)=>[0,N/2];break;case"bottomRight":w=!0,b=(F,N)=>[F,N],x=(F,N)=>[0,0];break;case"bottomMiddle":b=(F,N)=>[F/2,N],x=(F,N)=>[F/2,0];break;case"bottomLeft":w=!0,b=(F,N)=>[0,N],x=(F,N)=>[F,0];break;case"middleLeft":E=!0,b=(F,N)=>[0,N/2],x=(F,N)=>[F,N/2];break}const A=b(o,c),_=x(o,c);let S=p(..._);const T=Y._round(n+S[0]),C=Y._round(r+S[1]);let P=1,k=1,D,M;if(e.fromKeyboard)({deltaX:D,deltaY:M}=e);else{const{screenX:F,screenY:N}=e,[ft,et]=a(this,Kn);[D,M]=this.screenToPageTranslation(F-ft,N-et),a(this,Kn)[0]=F,a(this,Kn)[1]=N}if([D,M]=y(D/i,M/s),w){const F=Math.hypot(o,c);P=k=Math.max(Math.min(Math.hypot(_[0]-A[0]-D,_[1]-A[1]-M)/F,1/o,1/c),h/o,d/c)}else E?P=de(Math.abs(_[0]-A[0]-D),h,1)/o:k=de(Math.abs(_[1]-A[1]-M),d,1)/c;const q=Y._round(o*P),G=Y._round(c*k);S=p(...x(q,G));const O=T-S[0],X=C-S[1];a(this,Fe)||g(this,Fe,[this.x,this.y,this.width,this.height]),this.width=q,this.height=G,this.x=O,this.y=X,this.setDims(i*q,s*G),this.fixAndSetPosition(),this._onResizing()},Du=new WeakSet,tb=function(){var t;g(this,as,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=a(this,vt))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},Iu=new WeakSet,eb=function(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;const r=v(this,$r,Sd).call(this,this.rotation),o=(T,C)=>[r[0]*T+r[2]*C,r[1]*T+r[3]*C],[c,h]=this.parentDimensions,d=this.x,u=this.y,p=this.width,m=this.height,y=Y.MIN_SIZE/c,b=Y.MIN_SIZE/h;n=Math.max(Math.min(n,1/p,1/m),y/p,b/m);const x=Y._round(p*n),w=Y._round(m*n);if(x===p&&w===m)return;a(this,Fe)||g(this,Fe,[d,u,p,m]);const E=o(p/2,m/2),A=Y._round(d+E[0]),_=Y._round(u+E[1]),S=o(x/2,w/2);this.x=A-S[0],this.y=_-S[1],this.width=x,this.height=w,this.setDims(c*x,h*w),this.fixAndSetPosition(),this._onResizing()},Mu=new WeakSet,ib=function(){var t;(t=a(this,vt))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),v(this,Ur,Cd).call(this)},yc=new WeakSet,Kf=function(t){const{isMac:e}=Yt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Fu=new WeakSet,sb=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),r={capture:!0,passive:!1,signal:n},o=h=>{s.abort(),g(this,Xs,null),g(this,Jn,!1),this._uiManager.endDragSession()||v(this,yc,Kf).call(this,h),i&&this._onStopDragging()};e&&(g(this,zr,t.clientX),g(this,Hr,t.clientY),g(this,Xs,t.pointerId),g(this,dc,t.pointerType),window.addEventListener("pointermove",h=>{i||(i=!0,this._onStartDragging());const{clientX:d,clientY:u,pointerId:p}=h;if(p!==a(this,Xs)){Dt(h);return}const[m,y]=this.screenToPageTranslation(d-a(this,zr),u-a(this,Hr));g(this,zr,d),g(this,Hr,u),this._uiManager.dragSelectedEditors(m,y)},r),window.addEventListener("touchmove",Dt,r),window.addEventListener("pointerdown",h=>{h.pointerType===a(this,dc)&&(a(this,Zn)||h.isPrimary)&&o(h),Dt(h)},r));const c=h=>{if(!a(this,Xs)||a(this,Xs)===h.pointerId){o(h);return}Dt(h)};window.addEventListener("pointerup",c,{signal:n}),window.addEventListener("blur",c,{signal:n})},xc=new WeakSet,Jf=function(){if(a(this,Ys)||!this.div)return;g(this,Ys,new AbortController);const t=this._uiManager.combinedSignal(a(this,Ys));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},Nu=new WeakSet,nb=function(t){Y._resizerKeyboardManager.exec(this,t)},Ou=new WeakSet,ab=function(t){var e;a(this,rs)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==a(this,Zt)&&v(this,ta,fl).call(this)},ju=new WeakSet,rb=function(t){g(this,uc,a(this,rs)?t:"")},wc=new WeakSet,Qf=function(t){if(a(this,hi))for(const e of a(this,hi))e.tabIndex=t},ta=new WeakSet,fl=function(){g(this,rs,!1),v(this,wc,Qf).call(this,-1),v(this,Ur,Cd).call(this)},f(Y,mc),I(Y,"_l10n",null),I(Y,"_l10nResizer",null),I(Y,"_borderLineWidth",-1),I(Y,"_colorManager",new Bf),I(Y,"_zIndex",1),I(Y,"_telemetryTimeout",1e3);let gt=Y;class Aw extends gt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Lm=3285377520,Ye=4294901760,Si=65535;class ob{constructor(t){this.h1=t?t&4294967295:Lm,this.h2=t?t&4294967295:Lm}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let b=0,x=t.length;b<x;b++){const w=t.charCodeAt(b);w<=255?e[i++]=w:(e[i++]=w>>>8,e[i++]=w&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,r=new Uint32Array(e.buffer,0,s);let o=0,c=0,h=this.h1,d=this.h2;const u=3432918353,p=461845907,m=u&Si,y=p&Si;for(let b=0;b<s;b++)b&1?(o=r[b],o=o*u&Ye|o*m&Si,o=o<<15|o>>>17,o=o*p&Ye|o*y&Si,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(c=r[b],c=c*u&Ye|c*m&Si,c=c<<15|c>>>17,c=c*p&Ye|c*y&Si,d^=c,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,n){case 3:o^=e[s*4+2]<<16;case 2:o^=e[s*4+1]<<8;case 1:o^=e[s*4],o=o*u&Ye|o*m&Si,o=o<<15|o>>>17,o=o*p&Ye|o*y&Si,s&1?h^=o:d^=o}this.h1=h,this.h2=d}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ye|t*36045&Si,e=e*4283543511&Ye|((e<<16|t>>>16)*2950163797&Ye)>>>16,t^=e>>>1,t=t*444984403&Ye|t*60499&Si,e=e*3301882366&Ye|((e<<16|t>>>16)*3120437893&Ye)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Zf=Object.freeze({map:null,hash:"",transfer:void 0});var ea,ia,te,Bu,lb;class im{constructor(){f(this,Bu);f(this,ea,!1);f(this,ia,null);f(this,te,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const i=a(this,te).get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return a(this,te).get(t)}remove(t){if(a(this,te).delete(t),a(this,te).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of a(this,te).values())if(e instanceof gt)return;this.onAnnotationEditor(null)}}setValue(t,e){const i=a(this,te).get(t);let s=!1;if(i!==void 0)for(const[n,r]of Object.entries(e))i[n]!==r&&(s=!0,i[n]=r);else s=!0,a(this,te).set(t,e);s&&v(this,Bu,lb).call(this),e instanceof gt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return a(this,te).has(t)}get size(){return a(this,te).size}resetModified(){a(this,ea)&&(g(this,ea,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new cb(this)}get serializable(){if(a(this,te).size===0)return Zf;const t=new Map,e=new ob,i=[],s=Object.create(null);let n=!1;for(const[r,o]of a(this,te)){const c=o instanceof gt?o.serialize(!1,s):o;c&&(t.set(r,c),e.update(`${r}:${JSON.stringify(c)}`),n||(n=!!c.bitmap))}if(n)for(const r of t.values())r.bitmap&&i.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:Zf}get editorStats(){let t=null;const e=new Map;for(const i of a(this,te).values()){if(!(i instanceof gt))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||(t=Object.create(null));const r=t[n]||(t[n]=new Map);for(const[o,c]of Object.entries(s)){if(o==="type")continue;let h=r.get(o);h||(h=new Map,r.set(o,h));const d=h.get(c)??0;h.set(c,d+1)}}for(const[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){g(this,ia,null)}get modifiedIds(){if(a(this,ia))return a(this,ia);const t=[];for(const e of a(this,te).values())!(e instanceof gt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return g(this,ia,{ids:new Set(t),hash:t.join(",")})}[Symbol.iterator](){return a(this,te).entries()}}ea=new WeakMap,ia=new WeakMap,te=new WeakMap,Bu=new WeakSet,lb=function(){a(this,ea)||(g(this,ea,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Ac;class cb extends im{constructor(e){super();f(this,Ac,void 0);const{map:i,hash:s,transfer:n}=e.serializable,r=structuredClone(i,n?{transfer:n}:null);g(this,Ac,{map:r,hash:s,transfer:n})}get print(){lt("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,Ac)}get modifiedIds(){return J(this,"modifiedIds",{ids:new Set,hash:""})}}Ac=new WeakMap;var Gr;class Ew{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){f(this,Gr,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),a(this,Gr).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:i}){if(!(!t||a(this,Gr).has(t.loadedName))){if(Ot(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:r}=t,o=new FontFace(s,n,r);this.addNativeFontFace(o);try{await o.load(),a(this,Gr).add(s),i==null||i(t)}catch{W(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}lt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw W(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return J(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return J(this,"isSyncFontLoadingSupported",xe||Yt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Ot(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return J(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(_,S){return _.charCodeAt(S)<<24|_.charCodeAt(S+1)<<16|_.charCodeAt(S+2)<<8|_.charCodeAt(S+3)&255}function s(_,S,T,C){const P=_.substring(0,S),k=_.substring(S+T);return P+C+k}let n,r;const o=this._document.createElement("canvas");o.width=1,o.height=1;const c=o.getContext("2d");let h=0;function d(_,S){if(++h>30){W("Load test font never loaded."),S();return}if(c.font="30px "+_,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){S();return}setTimeout(d.bind(null,_,S))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=s(p,976,u.length,u);const y=16,b=1482184792;let x=i(p,y);for(n=0,r=u.length-3;n<r;n+=4)x=x-b+i(u,n)|0;n<u.length&&(x=x-b+i(u+"XXX",n)|0),p=s(p,y,4,dw(x));const w=`url(data:font/opentype;base64,${btoa(p)});`,E=`@font-face {font-family:"${u}";src:${w}}`;this.insertRule(E);const A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(const _ of[t.loadedName,u]){const S=this._document.createElement("span");S.textContent="Hi",S.style.fontFamily=_,A.append(S)}this._document.body.append(A),d(u,()=>{A.remove(),e.complete()})}}Gr=new WeakMap;class _w{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const i in t)this[i]=t[i];this._inspectFont=e}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const i={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(i.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,i)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var i;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Tv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return(i=this._inspectFont)==null||i.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const i=this.loadedName+"_path_"+e;let s;try{s=t.get(i)}catch(r){W(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}}function Sw(l){if(l instanceof URL)return l.href;if(typeof l=="string"){if(xe)return l;const t=URL.parse(l,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Cw(l){if(xe&&typeof Buffer<"u"&&l instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength)return l;if(typeof l=="string")return sd(l);if(l instanceof ArrayBuffer||ArrayBuffer.isView(l)||typeof l=="object"&&!isNaN(l==null?void 0:l.length))return new Uint8Array(l);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function pd(l){if(typeof l!="string")return null;if(l.endsWith("/"))return l;throw new Error(`Invalid factory url: "${l}" must include trailing slash.`)}const tg=l=>typeof l=="object"&&Number.isInteger(l==null?void 0:l.num)&&l.num>=0&&Number.isInteger(l==null?void 0:l.gen)&&l.gen>=0,Tw=l=>typeof l=="object"&&typeof(l==null?void 0:l.name)=="string",hb=gw.bind(null,tg,Tw);var os,zu;class kw{constructor(){f(this,os,new Map);f(this,zu,Promise.resolve())}postMessage(t,e){const i={data:structuredClone(t,e?{transfer:e}:null)};a(this,zu).then(()=>{for(const[s]of a(this,os))s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if((i==null?void 0:i.signal)instanceof AbortSignal){const{signal:n}=i;if(n.aborted){W("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}a(this,os).set(e,s)}removeEventListener(t,e){const i=a(this,os).get(e);i==null||i(),a(this,os).delete(e)}terminate(){for(const[,t]of a(this,os))t==null||t();a(this,os).clear()}}os=new WeakMap,zu=new WeakMap;const fd={DATA:1,ERROR:2},Ft={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Dm(){}function _e(l){if(l instanceof Ls||l instanceof Qd||l instanceof km||l instanceof Dl||l instanceof Af)return l;switch(l instanceof Error||typeof l=="object"&&l!==null||lt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),l.name){case"AbortException":return new Ls(l.message);case"InvalidPDFException":return new Qd(l.message);case"PasswordException":return new km(l.message,l.code);case"ResponseException":return new Dl(l.message,l.status,l.missing);case"UnknownErrorException":return new Af(l.message,l.details)}return new Af(l.message,l.toString())}var Vr,Hu,db,$u,ub,Uu,pb,Wr,Td;class gl{constructor(t,e,i){f(this,Hu);f(this,$u);f(this,Uu);f(this,Wr);f(this,Vr,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",v(this,Hu,db).bind(this),{signal:a(this,Vr).signal})}on(t,e){const i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,i,s){const n=this.streamId++,r=this.sourceName,o=this.targetName,c=this.comObj;return new ReadableStream({start:h=>{const d=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:r,targetName:o,action:t,streamId:n,data:e,desiredSize:h.desiredSize},s),d.promise},pull:h=>{const d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,c.postMessage({sourceName:r,targetName:o,stream:Ft.PULL,streamId:n,desiredSize:h.desiredSize}),d.promise},cancel:h=>{Ot(h instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,c.postMessage({sourceName:r,targetName:o,stream:Ft.CANCEL,streamId:n,reason:_e(h)}),d.promise}},i)}destroy(){var t;(t=a(this,Vr))==null||t.abort(),g(this,Vr,null)}}Vr=new WeakMap,Hu=new WeakSet,db=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){v(this,Uu,pb).call(this,t);return}if(t.callback){const i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===fd.DATA)s.resolve(t.data);else if(t.callback===fd.ERROR)s.reject(_e(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:i,targetName:s,callback:fd.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:i,targetName:s,callback:fd.ERROR,callbackId:t.callbackId,reason:_e(r)})});return}if(t.streamId){v(this,$u,ub).call(this,t);return}e(t.data)},$u=new WeakSet,ub=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this,o=this.actionHandler[t.action],c={enqueue(h,d=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:Ft.ENQUEUE,streamId:e,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Ft.CLOSE,streamId:e}),delete r.streamSinks[e])},error(h){Ot(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:Ft.ERROR,streamId:e,reason:_e(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[e]=c,Promise.try(o,t.data,c).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Ft.START_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Ft.START_COMPLETE,streamId:e,reason:_e(h)})})},Uu=new WeakSet,pb=function(t){const e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,r=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case Ft.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(_e(t.reason));break;case Ft.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(_e(t.reason));break;case Ft.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:Ft.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||Dm).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Ft.PULL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Ft.PULL_COMPLETE,streamId:e,reason:_e(h)})});break;case Ft.ENQUEUE:if(Ot(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case Ft.CLOSE:if(Ot(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),v(this,Wr,Td).call(this,r,e);break;case Ft.ERROR:Ot(r,"error should have stream controller"),r.controller.error(_e(t.reason)),v(this,Wr,Td).call(this,r,e);break;case Ft.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(_e(t.reason)),v(this,Wr,Td).call(this,r,e);break;case Ft.CANCEL:if(!o)break;const c=_e(t.reason);Promise.try(o.onCancel||Dm,c).then(function(){n.postMessage({sourceName:i,targetName:s,stream:Ft.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:i,targetName:s,stream:Ft.CANCEL_COMPLETE,streamId:e,reason:_e(h)})}),o.sinkCapability.reject(c),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Wr=new WeakSet,Td=async function(t,e){var i,s,n;await Promise.allSettled([(i=t.startCall)==null?void 0:i.promise,(s=t.pullCall)==null?void 0:s.promise,(n=t.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[e]};var Ec;class fb{constructor({enableHWA:t=!1}){f(this,Ec,!1);g(this,Ec,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!a(this,Ec)})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){lt("Abstract method `_createCanvas` called.")}}Ec=new WeakMap;class Pw extends fb{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const i=this._document.createElement("canvas");return i.width=t,i.height=e,i}}class gb{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){lt("Abstract method `_fetch` called.")}}class Im extends gb{async _fetch(t){const e=await nl(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):sd(e)}}class mb{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}}var sa,qr,ls,cs,ce,na,aa,Ut,oe,ra,ml,Ks,hr,Xr,kd,Js,dr,Gu,vb,_c,eg,Qs,ur,oa,vl,la,bl,Sc,ig,ca,yl;class Rw extends mb{constructor({docId:e,ownerDocument:i=globalThis.document}){super();f(this,Ut);f(this,ra);f(this,Ks);f(this,Xr);f(this,Js);f(this,Gu);f(this,_c);f(this,Qs);f(this,oa);f(this,la);f(this,Sc);f(this,ca);f(this,sa,void 0);f(this,qr,void 0);f(this,ls,void 0);f(this,cs,void 0);f(this,ce,void 0);f(this,na,void 0);f(this,aa,0);g(this,cs,e),g(this,ce,i)}addFilter(e){if(!e)return"none";let i=a(this,Ut,oe).get(e);if(i)return i;const[s,n,r]=v(this,Xr,kd).call(this,e),o=e.length===1?s:`${s}${n}${r}`;if(i=a(this,Ut,oe).get(o),i)return a(this,Ut,oe).set(e,i),i;const c=`g_${a(this,cs)}_transfer_map_${fe(this,aa)._++}`,h=v(this,Js,dr).call(this,c);a(this,Ut,oe).set(e,h),a(this,Ut,oe).set(o,h);const d=v(this,Qs,ur).call(this,c);return v(this,la,bl).call(this,s,n,r,d),h}addHCMFilter(e,i){var y;const s=`${e}-${i}`,n="base";let r=a(this,ra,ml).get(n);if((r==null?void 0:r.key)===s||(r?((y=r.filter)==null||y.remove(),r.key=s,r.url="none",r.filter=null):(r={key:s,url:"none",filter:null},a(this,ra,ml).set(n,r)),!e||!i))return r.url;const o=v(this,ca,yl).call(this,e);e=$.makeHexColor(...o);const c=v(this,ca,yl).call(this,i);if(i=$.makeHexColor(...c),a(this,Ks,hr).style.color="",e==="#000000"&&i==="#ffffff"||e===i)return r.url;const h=new Array(256);for(let b=0;b<=255;b++){const x=b/255;h[b]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const d=h.join(","),u=`g_${a(this,cs)}_hcm_filter`,p=r.filter=v(this,Qs,ur).call(this,u);v(this,la,bl).call(this,d,d,d,p),v(this,_c,eg).call(this,p);const m=(b,x)=>{const w=o[b]/255,E=c[b]/255,A=new Array(x+1);for(let _=0;_<=x;_++)A[_]=w+_/x*(E-w);return A.join(",")};return v(this,la,bl).call(this,m(0,5),m(1,5),m(2,5),p),r.url=v(this,Js,dr).call(this,u),r.url}addAlphaFilter(e){let i=a(this,Ut,oe).get(e);if(i)return i;const[s]=v(this,Xr,kd).call(this,[e]),n=`alpha_${s}`;if(i=a(this,Ut,oe).get(n),i)return a(this,Ut,oe).set(e,i),i;const r=`g_${a(this,cs)}_alpha_map_${fe(this,aa)._++}`,o=v(this,Js,dr).call(this,r);a(this,Ut,oe).set(e,o),a(this,Ut,oe).set(n,o);const c=v(this,Qs,ur).call(this,r);return v(this,Sc,ig).call(this,s,c),o}addLuminosityFilter(e){let i=a(this,Ut,oe).get(e||"luminosity");if(i)return i;let s,n;if(e?([s]=v(this,Xr,kd).call(this,[e]),n=`luminosity_${s}`):n="luminosity",i=a(this,Ut,oe).get(n),i)return a(this,Ut,oe).set(e,i),i;const r=`g_${a(this,cs)}_luminosity_map_${fe(this,aa)._++}`,o=v(this,Js,dr).call(this,r);a(this,Ut,oe).set(e,o),a(this,Ut,oe).set(n,o);const c=v(this,Qs,ur).call(this,r);return v(this,Gu,vb).call(this,c),e&&v(this,Sc,ig).call(this,s,c),o}addHighlightHCMFilter(e,i,s,n,r){var E;const o=`${i}-${s}-${n}-${r}`;let c=a(this,ra,ml).get(e);if((c==null?void 0:c.key)===o||(c?((E=c.filter)==null||E.remove(),c.key=o,c.url="none",c.filter=null):(c={key:o,url:"none",filter:null},a(this,ra,ml).set(e,c)),!i||!s))return c.url;const[h,d]=[i,s].map(v(this,ca,yl).bind(this));let u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,y]=[n,r].map(v(this,ca,yl).bind(this));p<u&&([u,p,m,y]=[p,u,y,m]),a(this,Ks,hr).style.color="";const b=(A,_,S)=>{const T=new Array(256),C=(p-u)/S,P=A/255,k=(_-A)/(255*S);let D=0;for(let M=0;M<=S;M++){const q=Math.round(u+M*C),G=P+M*k;for(let O=D;O<=q;O++)T[O]=G;D=q+1}for(let M=D;M<256;M++)T[M]=T[D-1];return T.join(",")},x=`g_${a(this,cs)}_hcm_${e}_filter`,w=c.filter=v(this,Qs,ur).call(this,x);return v(this,_c,eg).call(this,w),v(this,la,bl).call(this,b(m[0],y[0],5),b(m[1],y[1],5),b(m[2],y[2],5),w),c.url=v(this,Js,dr).call(this,x),c.url}destroy(e=!1){var i,s,n,r;e&&((i=a(this,na))!=null&&i.size)||((s=a(this,ls))==null||s.parentNode.parentNode.remove(),g(this,ls,null),(n=a(this,qr))==null||n.clear(),g(this,qr,null),(r=a(this,na))==null||r.clear(),g(this,na,null),g(this,aa,0))}}sa=new WeakMap,qr=new WeakMap,ls=new WeakMap,cs=new WeakMap,ce=new WeakMap,na=new WeakMap,aa=new WeakMap,Ut=new WeakSet,oe=function(){return a(this,qr)||g(this,qr,new Map)},ra=new WeakSet,ml=function(){return a(this,na)||g(this,na,new Map)},Ks=new WeakSet,hr=function(){if(!a(this,ls)){const e=a(this,ce).createElement("div"),{style:i}=e;i.visibility="hidden",i.contain="strict",i.width=i.height=0,i.position="absolute",i.top=i.left=0,i.zIndex=-1;const s=a(this,ce).createElementNS(qi,"svg");s.setAttribute("width",0),s.setAttribute("height",0),g(this,ls,a(this,ce).createElementNS(qi,"defs")),e.append(s),s.append(a(this,ls)),a(this,ce).body.append(e)}return a(this,ls)},Xr=new WeakSet,kd=function(e){if(e.length===1){const h=e[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=h[p]/255;const u=d.join(",");return[u,u,u]}const[i,s,n]=e,r=new Array(256),o=new Array(256),c=new Array(256);for(let h=0;h<256;h++)r[h]=i[h]/255,o[h]=s[h]/255,c[h]=n[h]/255;return[r.join(","),o.join(","),c.join(",")]},Js=new WeakSet,dr=function(e){if(a(this,sa)===void 0){g(this,sa,"");const i=a(this,ce).URL;i!==a(this,ce).baseURI&&(ad(i)?W('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,sa,Qg(i,"")))}return`url(${a(this,sa)}#${e})`},Gu=new WeakSet,vb=function(e){const i=a(this,ce).createElementNS(qi,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(i)},_c=new WeakSet,eg=function(e){const i=a(this,ce).createElementNS(qi,"feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(i)},Qs=new WeakSet,ur=function(e){const i=a(this,ce).createElementNS(qi,"filter");return i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("id",e),a(this,Ks,hr).append(i),i},oa=new WeakSet,vl=function(e,i,s){const n=a(this,ce).createElementNS(qi,i);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),e.append(n)},la=new WeakSet,bl=function(e,i,s,n){const r=a(this,ce).createElementNS(qi,"feComponentTransfer");n.append(r),v(this,oa,vl).call(this,r,"feFuncR",e),v(this,oa,vl).call(this,r,"feFuncG",i),v(this,oa,vl).call(this,r,"feFuncB",s)},Sc=new WeakSet,ig=function(e,i){const s=a(this,ce).createElementNS(qi,"feComponentTransfer");i.append(s),v(this,oa,vl).call(this,s,"feFuncA",e)},ca=new WeakSet,yl=function(e){return a(this,Ks,hr).style.color=e,em(getComputedStyle(a(this,Ks,hr)).getPropertyValue("color"))};class bb{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){lt("Abstract method `_fetch` called.")}}class Mm extends bb{async _fetch(t){const e=await nl(t,"arraybuffer");return new Uint8Array(e)}}class yb{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(i=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){lt("Abstract method `_fetch` called.")}}class Fm extends yb{async _fetch(t){const e=await nl(t,"arraybuffer");return new Uint8Array(e)}}xe&&W("Please use the `legacy` build in Node.js environments.");async function sm(l){const e=await process.getBuiltinModule("fs").promises.readFile(l);return new Uint8Array(e)}class Lw extends mb{}class Dw extends fb{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Iw extends gb{async _fetch(t){return sm(t)}}class Mw extends bb{async _fetch(t){return sm(t)}}class Fw extends yb{async _fetch(t){return sm(t)}}const se={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function sg(l,t){if(!t)return;const e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),l.clip(s)}class nm{isModifyingCurrentTransform(){return!1}getPattern(){lt("Abstract method `getPattern` called.")}}class Nw extends nm{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===se.STROKE||s===se.FILL){const r=e.current.getClippedPathBoundingBox(s,At(t))||[0,0,0,0],o=Math.ceil(r[2]-r[0])||1,c=Math.ceil(r[3]-r[1])||1,h=e.cachedCanvases.getCanvas("pattern",o,c),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),i=$.transform(i,[1,0,0,1,r[0],r[1]]),d.transform(...e.baseTransform),this.matrix&&d.transform(...this.matrix),sg(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=t.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(i);n.setTransform(u)}else sg(t,this._bbox),n=this._createGradient(t);return n}}function Sf(l,t,e,i,s,n,r,o){const c=t.coords,h=t.colors,d=l.data,u=l.width*4;let p;c[e+1]>c[i+1]&&(p=e,e=i,i=p,p=n,n=r,r=p),c[i+1]>c[s+1]&&(p=i,i=s,s=p,p=r,r=o,o=p),c[e+1]>c[i+1]&&(p=e,e=i,i=p,p=n,n=r,r=p);const m=(c[e]+t.offsetX)*t.scaleX,y=(c[e+1]+t.offsetY)*t.scaleY,b=(c[i]+t.offsetX)*t.scaleX,x=(c[i+1]+t.offsetY)*t.scaleY,w=(c[s]+t.offsetX)*t.scaleX,E=(c[s+1]+t.offsetY)*t.scaleY;if(y>=E)return;const A=h[n],_=h[n+1],S=h[n+2],T=h[r],C=h[r+1],P=h[r+2],k=h[o],D=h[o+1],M=h[o+2],q=Math.round(y),G=Math.round(E);let O,X,F,N,ft,et,pe,ne;for(let nt=q;nt<=G;nt++){if(nt<x){const it=nt<y?0:(y-nt)/(y-x);O=m-(m-b)*it,X=A-(A-T)*it,F=_-(_-C)*it,N=S-(S-P)*it}else{let it;nt>E?it=1:x===E?it=0:it=(x-nt)/(x-E),O=b-(b-w)*it,X=T-(T-k)*it,F=C-(C-D)*it,N=P-(P-M)*it}let st;nt<y?st=0:nt>E?st=1:st=(y-nt)/(y-E),ft=m-(m-w)*st,et=A-(A-k)*st,pe=_-(_-D)*st,ne=S-(S-M)*st;const Tt=Math.round(Math.min(O,ft)),Kt=Math.round(Math.max(O,ft));let xt=u*nt+Tt*4;for(let it=Tt;it<=Kt;it++)st=(O-it)/(O-ft),st<0?st=0:st>1&&(st=1),d[xt++]=X-(X-et)*st|0,d[xt++]=F-(F-pe)*st|0,d[xt++]=N-(N-ne)*st|0,d[xt++]=255}}function Ow(l,t,e){const i=t.coords,s=t.colors;let n,r;switch(t.type){case"lattice":const o=t.verticesPerRow,c=Math.floor(i.length/o)-1,h=o-1;for(n=0;n<c;n++){let d=n*o;for(let u=0;u<h;u++,d++)Sf(l,e,i[d],i[d+1],i[d+o],s[d],s[d+1],s[d+o]),Sf(l,e,i[d+o+1],i[d+1],i[d+o],s[d+o+1],s[d+1],s[d+o])}break;case"triangles":for(n=0,r=i.length;n<r;n+=3)Sf(l,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class jw extends nm{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,i){const o=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-c,u=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*t[1]*1.1)),3e3),m=h/u,y=d/p,b={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-c,scaleX:1/m,scaleY:1/y},x=u+2*2,w=p+2*2,E=i.getCanvas("mesh",x,w),A=E.context,_=A.createImageData(u,p);if(e){const T=_.data;for(let C=0,P=T.length;C<P;C+=4)T[C]=e[0],T[C+1]=e[1],T[C+2]=e[2],T[C+3]=255}for(const T of this._figures)Ow(_,T,b);return A.putImageData(_,2,2),{canvas:E.canvas,offsetX:o-2*m,offsetY:c-2*y,scaleX:m,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(t,e,i,s){sg(t,this._bbox);const n=new Float32Array(2);if(s===se.SHADING)$.singularValueDecompose2dScale(At(t),n);else if(this.matrix){$.singularValueDecompose2dScale(this.matrix,n);const[o,c]=n;$.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=o,n[1]*=c}else $.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,s===se.SHADING?null:this._background,e.cachedCanvases);return s!==se.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class Bw extends nm{getPattern(){return"hotpink"}}function zw(l){switch(l[0]){case"RadialAxial":return new Nw(l);case"Mesh":return new jw(l);case"Dummy":return new Bw}throw new Error(`Unknown IR type: ${l[0]}`)}const Nm={COLORED:1,UNCOLORED:2},Vu=class Vu{constructor(t,e,i,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(t){const{bbox:e,operatorList:i,paintType:s,tilingType:n,color:r,canvasGraphicsFactory:o}=this;let{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),Qp("TilingType: "+n);const d=e[0],u=e[1],p=e[2],m=e[3],y=p-d,b=m-u,x=new Float32Array(2);$.singularValueDecompose2dScale(this.matrix,x);const[w,E]=x;$.singularValueDecompose2dScale(this.baseTransform,x);const A=w*x[0],_=E*x[1];let S=y,T=b,C=!1,P=!1;const k=Math.ceil(c*A),D=Math.ceil(h*_),M=Math.ceil(y*A),q=Math.ceil(b*_);k>=M?S=c:C=!0,D>=q?T=h:P=!0;const G=this.getSizeAndScale(S,this.ctx.canvas.width,A),O=this.getSizeAndScale(T,this.ctx.canvas.height,_),X=t.cachedCanvases.getCanvas("pattern",G.size,O.size),F=X.context,N=o.createCanvasGraphics(F);if(N.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(N,s,r),F.translate(-G.scale*d,-O.scale*u),N.transform(G.scale,0,0,O.scale,0,0),F.save(),this.clipBbox(N,d,u,p,m),N.baseTransform=At(N.ctx),N.executeOperatorList(i),N.endDrawing(),F.restore(),C||P){const ft=X.canvas;C&&(S=c),P&&(T=h);const et=this.getSizeAndScale(S,this.ctx.canvas.width,A),pe=this.getSizeAndScale(T,this.ctx.canvas.height,_),ne=et.size,nt=pe.size,st=t.cachedCanvases.getCanvas("pattern-workaround",ne,nt),Tt=st.context,Kt=C?Math.floor(y/c):0,xt=P?Math.floor(b/h):0;for(let it=0;it<=Kt;it++)for(let Re=0;Re<=xt;Re++)Tt.drawImage(ft,ne*it,nt*Re,ne,nt,0,0,ne,nt);return{canvas:st.canvas,scaleX:et.scale,scaleY:pe.scale,offsetX:d,offsetY:u}}return{canvas:X.canvas,scaleX:G.scale,scaleY:O.scale,offsetX:d,offsetY:u}}getSizeAndScale(t,e,i){const s=Math.max(Vu.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*i);return n>=s?n=s:i=n/t,{scale:i,size:n}}clipBbox(t,e,i,s,n){const r=s-e,o=n-i;t.ctx.rect(e,i,r,o),$.axialAlignedBoundingBox([e,i,s,n],At(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,i){const s=t.ctx,n=t.current;switch(e){case Nm.COLORED:const{fillStyle:r,strokeStyle:o}=this.ctx;s.fillStyle=n.fillColor=r,s.strokeStyle=n.strokeColor=o;break;case Nm.UNCOLORED:s.fillStyle=s.strokeStyle=i,n.fillColor=n.strokeColor=i;break;default:throw new hw(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,i,s){let n=i;s!==se.SHADING&&(n=$.transform(n,e.baseTransform),this.matrix&&(n=$.transform(n,this.matrix)));const r=this.createPatternCanvas(e);let o=new DOMMatrix(n);o=o.translate(r.offsetX,r.offsetY),o=o.scale(1/r.scaleX,1/r.scaleY);const c=t.createPattern(r.canvas,"repeat");return c.setTransform(o),c}};I(Vu,"MAX_PATTERN_SIZE",3e3);let ng=Vu;function Hw({src:l,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const o=Yt.isLittleEndian?4278190080:255,[c,h]=r?[n,o]:[o,n],d=i>>3,u=i&7,p=l.length;e=new Uint32Array(e.buffer);let m=0;for(let y=0;y<s;y++){for(const x=t+d;t<x;t++){const w=t<p?l[t]:255;e[m++]=w&128?h:c,e[m++]=w&64?h:c,e[m++]=w&32?h:c,e[m++]=w&16?h:c,e[m++]=w&8?h:c,e[m++]=w&4?h:c,e[m++]=w&2?h:c,e[m++]=w&1?h:c}if(u===0)continue;const b=t<p?l[t++]:255;for(let x=0;x<u;x++)e[m++]=b&1<<7-x?h:c}return{srcPos:t,destPos:m}}const Om=16,jm=100,$w=15,Bm=10,Pe=16,Cf=new DOMMatrix,Xe=new Float32Array(2),mr=new Float32Array([1/0,1/0,-1/0,-1/0]);function Uw(l,t){if(l._removeMirroring)throw new Error("Context is already forwarding operations.");l.__originalSave=l.save,l.__originalRestore=l.restore,l.__originalRotate=l.rotate,l.__originalScale=l.scale,l.__originalTranslate=l.translate,l.__originalTransform=l.transform,l.__originalSetTransform=l.setTransform,l.__originalResetTransform=l.resetTransform,l.__originalClip=l.clip,l.__originalMoveTo=l.moveTo,l.__originalLineTo=l.lineTo,l.__originalBezierCurveTo=l.bezierCurveTo,l.__originalRect=l.rect,l.__originalClosePath=l.closePath,l.__originalBeginPath=l.beginPath,l._removeMirroring=()=>{l.save=l.__originalSave,l.restore=l.__originalRestore,l.rotate=l.__originalRotate,l.scale=l.__originalScale,l.translate=l.__originalTranslate,l.transform=l.__originalTransform,l.setTransform=l.__originalSetTransform,l.resetTransform=l.__originalResetTransform,l.clip=l.__originalClip,l.moveTo=l.__originalMoveTo,l.lineTo=l.__originalLineTo,l.bezierCurveTo=l.__originalBezierCurveTo,l.rect=l.__originalRect,l.closePath=l.__originalClosePath,l.beginPath=l.__originalBeginPath,delete l._removeMirroring},l.save=function(){t.save(),this.__originalSave()},l.restore=function(){t.restore(),this.__originalRestore()},l.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},l.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},l.transform=function(e,i,s,n,r,o){t.transform(e,i,s,n,r,o),this.__originalTransform(e,i,s,n,r,o)},l.setTransform=function(e,i,s,n,r,o){t.setTransform(e,i,s,n,r,o),this.__originalSetTransform(e,i,s,n,r,o)},l.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},l.rotate=function(e){t.rotate(e),this.__originalRotate(e)},l.clip=function(e){t.clip(e),this.__originalClip(e)},l.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},l.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},l.bezierCurveTo=function(e,i,s,n,r,o){t.bezierCurveTo(e,i,s,n,r,o),this.__originalBezierCurveTo(e,i,s,n,r,o)},l.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},l.closePath=function(){t.closePath(),this.__originalClosePath()},l.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Gw{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function gd(l,t,e,i,s,n,r,o,c,h){const[d,u,p,m,y,b]=At(l);if(u===0&&p===0){const E=r*d+y,A=Math.round(E),_=o*m+b,S=Math.round(_),T=(r+c)*d+y,C=Math.abs(Math.round(T)-A)||1,P=(o+h)*m+b,k=Math.abs(Math.round(P)-S)||1;return l.setTransform(Math.sign(d),0,0,Math.sign(m),A,S),l.drawImage(t,e,i,s,n,0,0,C,k),l.setTransform(d,u,p,m,y,b),[C,k]}if(d===0&&m===0){const E=o*p+y,A=Math.round(E),_=r*u+b,S=Math.round(_),T=(o+h)*p+y,C=Math.abs(Math.round(T)-A)||1,P=(r+c)*u+b,k=Math.abs(Math.round(P)-S)||1;return l.setTransform(0,Math.sign(u),Math.sign(p),0,A,S),l.drawImage(t,e,i,s,n,0,0,k,C),l.setTransform(d,u,p,m,y,b),[k,C]}l.drawImage(t,e,i,s,n,r,o,c,h);const x=Math.hypot(d,u),w=Math.hypot(p,m);return[x*c,w*h]}class zm{constructor(t,e){I(this,"alphaIsShape",!1);I(this,"fontSize",0);I(this,"fontSizeScale",1);I(this,"textMatrix",null);I(this,"textMatrixScale",1);I(this,"fontMatrix",Ff);I(this,"leading",0);I(this,"x",0);I(this,"y",0);I(this,"lineX",0);I(this,"lineY",0);I(this,"charSpacing",0);I(this,"wordSpacing",0);I(this,"textHScale",1);I(this,"textRenderingMode",re.FILL);I(this,"textRise",0);I(this,"fillColor","#000000");I(this,"strokeColor","#000000");I(this,"patternFill",!1);I(this,"patternStroke",!1);I(this,"fillAlpha",1);I(this,"strokeAlpha",1);I(this,"lineWidth",1);I(this,"activeSMask",null);I(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,t,e]),this.minMax=mr.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=se.FILL,e=null){const i=this.minMax.slice();if(t===se.STROKE){e||lt("Stroke bounding box must include transform."),$.singularValueDecompose2dScale(e,Xe);const s=Xe[0]*this.lineWidth/2,n=Xe[1]*this.lineWidth/2;i[0]-=s,i[1]-=n,i[2]+=s,i[3]+=n}return i}updateClipFromPath(){const t=$.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(mr,0)}getClippedPathBoundingBox(t=se.FILL,e=null){return $.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Hm(l,t){if(t instanceof ImageData){l.putImageData(t,0,0);return}const e=t.height,i=t.width,s=e%Pe,n=(e-s)/Pe,r=s===0?n:n+1,o=l.createImageData(i,Pe);let c=0,h;const d=t.data,u=o.data;let p,m,y,b;if(t.kind===Pl.GRAYSCALE_1BPP){const x=d.byteLength,w=new Uint32Array(u.buffer,0,u.byteLength>>2),E=w.length,A=i+7>>3,_=4294967295,S=Yt.isLittleEndian?4278190080:255;for(p=0;p<r;p++){for(y=p<n?Pe:s,h=0,m=0;m<y;m++){const T=x-c;let C=0;const P=T>A?i:T*8-7,k=P&-8;let D=0,M=0;for(;C<k;C+=8)M=d[c++],w[h++]=M&128?_:S,w[h++]=M&64?_:S,w[h++]=M&32?_:S,w[h++]=M&16?_:S,w[h++]=M&8?_:S,w[h++]=M&4?_:S,w[h++]=M&2?_:S,w[h++]=M&1?_:S;for(;C<P;C++)D===0&&(M=d[c++],D=128),w[h++]=M&D?_:S,D>>=1}for(;h<E;)w[h++]=0;l.putImageData(o,0,p*Pe)}}else if(t.kind===Pl.RGBA_32BPP){for(m=0,b=i*Pe*4,p=0;p<n;p++)u.set(d.subarray(c,c+b)),c+=b,l.putImageData(o,0,m),m+=Pe;p<r&&(b=i*s*4,u.set(d.subarray(c,c+b)),l.putImageData(o,0,m))}else if(t.kind===Pl.RGB_24BPP)for(y=Pe,b=i*y,p=0;p<r;p++){for(p>=n&&(y=s,b=i*y),h=0,m=b;m--;)u[h++]=d[c++],u[h++]=d[c++],u[h++]=d[c++],u[h++]=255;l.putImageData(o,0,p*Pe)}else throw new Error(`bad image kind: ${t.kind}`)}function $m(l,t){if(t.bitmap){l.drawImage(t.bitmap,0,0);return}const e=t.height,i=t.width,s=e%Pe,n=(e-s)/Pe,r=s===0?n:n+1,o=l.createImageData(i,Pe);let c=0;const h=t.data,d=o.data;for(let u=0;u<r;u++){const p=u<n?Pe:s;({srcPos:c}=Hw({src:h,srcPos:c,dest:d,width:i,height:p,nonBlackColor:0})),l.putImageData(o,0,u*Pe)}}function rl(l,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of e)l[i]!==void 0&&(t[i]=l[i]);l.setLineDash!==void 0&&(t.setLineDash(l.getLineDash()),t.lineDashOffset=l.lineDashOffset)}function md(l){l.strokeStyle=l.fillStyle="#000000",l.fillRule="nonzero",l.globalAlpha=1,l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.miterLimit=10,l.globalCompositeOperation="source-over",l.font="10px sans-serif",l.setLineDash!==void 0&&(l.setLineDash([]),l.lineDashOffset=0);const{filter:t}=l;t!=="none"&&t!==""&&(l.filter="none")}function Um(l,t){if(t)return!0;$.singularValueDecompose2dScale(l,Xe);const e=Math.fround(wi.pixelRatio*Ds.PDF_TO_CSS_UNITS);return Xe[0]<=e&&Xe[1]<=e}const Vw=["butt","round","square"],Ww=["miter","round","bevel"],qw={},Gm={};var Cc,ag,Tc,rg,kc,og;const gm=class gm{constructor(t,e,i,s,n,{optionalContentConfig:r,markedContentStack:o=null},c,h){f(this,Cc);f(this,Tc);f(this,kc);this.ctx=t,this.current=new zm(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=r,this.cachedCanvases=new Gw(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=o,i){const c=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...At(this.compositeCtx))}this.ctx.save(),md(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=At(this.ctx)}executeOperatorList(t,e,i,s){const n=t.argsArray,r=t.fnArray;let o=e||0;const c=n.length;if(c===o)return o;const h=c-o>Bm&&typeof i=="function",d=h?Date.now()+$w:0;let u=0;const p=this.commonObjs,m=this.objs;let y;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(y=r[o],y!==Ll.dependency)this[y].apply(this,n[o]);else for(const b of n[o]){const x=b.startsWith("g_")?p:m;if(!x.has(b))return x.get(b,i),o}if(o++,o===c)return o;if(h&&++u>Bm){if(Date.now()>d)return i(),o;u=0}}}endDrawing(){v(this,Cc,ag).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),v(this,Tc,rg).call(this)}_scaleImage(t,e){const i=t.width??t.displayWidth,s=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),o=i,c=s,h="prescale1",d,u;for(;n>2&&o>1||r>2&&c>1;){let p=o,m=c;n>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/p),r>2&&c>1&&(m=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,r/=c/m),d=this.cachedCanvases.getCanvas(h,p,m),u=d.context,u.clearRect(0,0,p,m),u.drawImage(t,0,0,o,c,0,0,p,m),t=d.canvas,o=p,c=m,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:c}}_createMaskCanvas(t){const e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,r=this.current.patternFill,o=At(e);let c,h,d,u;if((t.bitmap||t.data)&&t.count>1){const k=t.bitmap||t.data.buffer;h=JSON.stringify(r?o:[o.slice(0,4),n]),c=this._cachedBitmapsMap.get(k),c||(c=new Map,this._cachedBitmapsMap.set(k,c));const D=c.get(h);if(D&&!r){const M=Math.round(Math.min(o[0],o[2])+o[4]),q=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:D,offsetX:M,offsetY:q}}d=D}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,s),$m(u.context,t));let p=$.transform(o,[1/i,0,0,-1/s,0,0]);p=$.transform(p,[1,0,0,1,0,-s]);const m=mr.slice();$.axialAlignedBoundingBox([0,0,i,s],p,m);const[y,b,x,w]=m,E=Math.round(x-y)||1,A=Math.round(w-b)||1,_=this.cachedCanvases.getCanvas("fillCanvas",E,A),S=_.context,T=y,C=b;S.translate(-T,-C),S.transform(...p),d||(d=this._scaleImage(u.canvas,_i(S)),d=d.img,c&&r&&c.set(h,d)),S.imageSmoothingEnabled=Um(At(S),t.interpolate),gd(S,d,0,0,d.width,d.height,0,0,i,s),S.globalCompositeOperation="source-in";const P=$.transform(_i(S),[1,0,0,1,-T,-C]);return S.fillStyle=r?n.getPattern(e,this,P,se.FILL):n,S.fillRect(0,0,i,s),c&&!r&&(this.cachedCanvases.delete("fillCanvas"),c.set(h,_.canvas)),{canvas:_.canvas,offsetX:Math.round(T),offsetY:Math.round(C)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Vw[t]}setLineJoin(t){this.ctx.lineJoin=Ww[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx;const n=this.ctx=s.context;n.setTransform(this.suspendedCtx.getTransform()),rl(this.suspendedCtx,n),Uw(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),rl(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){const n=s[0],r=s[1],o=s[2]-n,c=s[3]-r;o===0||c===0||(this.genericComposeSMask(e.context,i,o,c,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,r,o,c,h,d,u){let p=t.canvas,m=c-d,y=h-u;if(r)if(m<0||y<0||m+i>p.width||y+s>p.height){const x=this.cachedCanvases.getCanvas("maskExtension",i,s),w=x.context;w.drawImage(p,-m,-y),w.globalCompositeOperation="destination-atop",w.fillStyle=r,w.fillRect(0,0,i,s),w.globalCompositeOperation="source-over",p=x.canvas,m=y=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const x=new Path2D;x.rect(m,y,i,s),t.clip(x),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(m,y,i,s),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const b=new Path2D;b.rect(c,h,i,s),e.clip(b),e.globalCompositeOperation="destination-in",e.drawImage(p,m,y,i,s,c,h,i,s),e.restore()}save(){this.inSMaskMode&&rl(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&rl(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,i,s,n,r){this.ctx.transform(t,e,i,s,n,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){let[s]=e;if(!i){s||(s=e[0]=new Path2D),this[t](s);return}if(!(s instanceof Path2D)){const n=e[0]=new Path2D;for(let r=0,o=s.length;r<o;)switch(s[r++]){case ud.moveTo:n.moveTo(s[r++],s[r++]);break;case ud.lineTo:n.lineTo(s[r++],s[r++]);break;case ud.curveTo:n.bezierCurveTo(s[r++],s[r++],s[r++],s[r++],s[r++],s[r++]);break;case ud.closePath:n.closePath();break;default:W(`Unrecognized drawing path operator: ${s[r-1]}`);break}s=n}$.axialAlignedBoundingBox(i,At(this.ctx),this.current.minMax),this[t](s)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&(s!=null&&s.getPattern)){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,_i(i),se.STROKE),n){const r=new Path2D;r.addPath(t,i.getTransform().invertSelf().multiplySelf(n)),t=r}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(se.STROKE,At(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const i=this.ctx,s=this.current.fillColor,n=this.current.patternFill;let r=!1;if(n){const c=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=s.getPattern(i,this,_i(i),se.FILL),c){const h=new Path2D;h.addPath(t,i.getTransform().invertSelf().multiplySelf(c)),t=h}r=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),r&&i.restore(),e&&this.consumePath(t,o)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=qw}eoClip(){this.pendingClip=Gm}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0)return;const i=new Path2D,s=e.getTransform().invertSelf();for(const{transform:n,x:r,y:o,fontSize:c,path:h}of t)i.addPath(h,new DOMMatrix(n).preMultiplySelf(s).translate(r,o).scale(c,-c));e.clip(i),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var d;const i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||Ff,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&W("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;const n=i.loadedName||"sans-serif",r=((d=i.systemFontInfo)==null?void 0:d.css)||`"${n}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const c=i.italic?"italic":"normal";let h=e;e<Om?h=Om:e>jm&&(h=jm),this.current.fontSizeScale=e/h,this.ctx.font=`${c} ${o} ${h}px ${r}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t){const{current:e}=this;e.textMatrix=t,e.textMatrixScale=Math.hypot(t[0],t[1]),e.x=e.lineX=0,e.y=e.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,i,s,n){const r=this.ctx,o=this.current,c=o.font,h=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=h&re.FILL_STROKE_MASK,p=!!(h&re.ADD_TO_PATH_FLAG),m=o.patternFill&&!c.missingFile,y=o.patternStroke&&!c.missingFile;let b;if((c.disableFontFace||p||m||y)&&(b=c.getPathGenerator(this.commonObjs,t)),c.disableFontFace||m||y){r.save(),r.translate(e,i),r.scale(d,-d);let x;if((u===re.FILL||u===re.FILL_STROKE)&&(s?(x=r.getTransform(),r.setTransform(...s),r.fill(v(this,kc,og).call(this,b,x,s))):r.fill(b)),u===re.STROKE||u===re.FILL_STROKE)if(n){x||(x=r.getTransform()),r.setTransform(...n);const{a:w,b:E,c:A,d:_}=x,S=$.inverseTransform(n),T=$.transform([w,E,A,_,0,0],S);$.singularValueDecompose2dScale(T,Xe),r.lineWidth*=Math.max(Xe[0],Xe[1])/d,r.stroke(v(this,kc,og).call(this,b,x,n))}else r.lineWidth/=d,r.stroke(b);r.restore()}else(u===re.FILL||u===re.FILL_STROKE)&&r.fillText(t,e,i),(u===re.STROKE||u===re.FILL_STROKE)&&r.strokeText(t,e,i);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:At(r),x:e,y:i,fontSize:d,path:b})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return J(this,"isFontSubpixelAAEnabled",i)}showText(t){const e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);const s=e.fontSize;if(s===0)return;const n=this.ctx,r=e.fontSizeScale,o=e.charSpacing,c=e.wordSpacing,h=e.fontDirection,d=e.textHScale*h,u=t.length,p=i.vertical,m=p?1:-1,y=i.defaultVMetrics,b=s*e.fontMatrix[0],x=e.textRenderingMode===re.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),e.textMatrix&&n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),h>0?n.scale(d,-1):n.scale(d,1);let w,E;if(e.patternFill){n.save();const C=e.fillColor.getPattern(n,this,_i(n),se.FILL);w=At(n),n.restore(),n.fillStyle=C}if(e.patternStroke){n.save();const C=e.strokeColor.getPattern(n,this,_i(n),se.STROKE);E=At(n),n.restore(),n.strokeStyle=C}let A=e.lineWidth;const _=e.textMatrixScale;if(_===0||A===0){const C=e.textRenderingMode&re.FILL_STROKE_MASK;(C===re.STROKE||C===re.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=_;if(r!==1&&(n.scale(r,r),A/=r),n.lineWidth=A,i.isInvalidPDFjsFont){const C=[];let P=0;for(const k of t)C.push(k.unicode),P+=k.width;n.fillText(C.join(""),0,0),e.x+=P*b*d,n.restore(),this.compose();return}let S=0,T;for(T=0;T<u;++T){const C=t[T];if(typeof C=="number"){S+=m*C*s/1e3;continue}let P=!1;const k=(C.isSpace?c:0)+o,D=C.fontChar,M=C.accent;let q,G,O=C.width;if(p){const F=C.vmetric||y,N=-(C.vmetric?F[1]:O*.5)*b,ft=F[2]*b;O=F?-F[0]:O,q=N/r,G=(S+ft)/r}else q=S/r,G=0;if(i.remeasure&&O>0){const F=n.measureText(D).width*1e3/s*r;if(O<F&&this.isFontSubpixelAAEnabled){const N=O/F;P=!0,n.save(),n.scale(N,1),q/=N}else O!==F&&(q+=(O-F)/2e3*s/r)}if(this.contentVisible&&(C.isInFont||i.missingFile)){if(x&&!M)n.fillText(D,q,G);else if(this.paintChar(D,q,G,w,E),M){const F=q+s*M.offset.x/r,N=G-s*M.offset.y/r;this.paintChar(M.fontChar,F,N,w,E)}}const X=p?O*b-k*h:O*b+k*h;S+=X,P&&n.restore()}p?e.y-=S:e.x+=S*d,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,i=this.current,s=i.font,n=i.fontSize,r=i.fontDirection,o=s.vertical?1:-1,c=i.charSpacing,h=i.wordSpacing,d=i.textHScale*r,u=i.fontMatrix||Ff,p=t.length,m=i.textRenderingMode===re.INVISIBLE;let y,b,x,w;if(!(m||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),i.textMatrix&&e.transform(...i.textMatrix),e.translate(i.x,i.y+i.textRise),e.scale(d,r),y=0;y<p;++y){if(b=t[y],typeof b=="number"){w=o*b*n/1e3,this.ctx.translate(w,0),i.x+=w*d;continue}const E=(b.isSpace?h:0)+c,A=s.charProcOperatorList[b.operatorListId];A?this.contentVisible&&(this.save(),e.scale(n,n),e.transform(...u),this.executeOperatorList(A),this.restore()):W(`Type3 character "${b.operatorListId}" is not available.`);const _=[b.width,0];$.applyTransform(_,u),x=_[0]*n+E,e.translate(x,0),i.x+=x*d}e.restore()}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,r){const o=new Path2D;o.rect(i,s,n-i,r-s),this.ctx.clip(o),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const i=this.baseTransform||At(this.ctx),s={createCanvasGraphics:n=>new gm(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new ng(t,this.ctx,s,i)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t){this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t){this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=zw(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,_i(e),se.SHADING);const s=_i(e);if(s){const{width:n,height:r}=e.canvas,o=mr.slice();$.axialAlignedBoundingBox([0,0,n,r],s,o);const[c,h,d,u]=o;this.ctx.fillRect(c,h,d-c,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){lt("Should not call beginInlineImage")}beginImageData(){lt("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=At(this.ctx),e)){$.axialAlignedBoundingBox(e,this.baseTransform,this.current.minMax);const[i,s,n,r]=e,o=new Path2D;o.rect(i,s,n-i,r-s),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||Qp("TODO: Support non-isolated groups."),t.knockout&&W("Knockout groups not supported.");const i=At(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=mr.slice();$.axialAlignedBoundingBox(t.bbox,At(e),s);const n=[0,0,e.canvas.width,e.canvas.height];s=$.intersect(s,n)||[0,0,0,0];const r=Math.floor(s[0]),o=Math.floor(s[1]),c=Math.max(Math.ceil(s[2])-r,1),h=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,c,h]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,c,h),p=u.context;p.translate(-r,-o),p.transform(...i);let m=new Path2D;const[y,b,x,w]=t.bbox;if(m.rect(y,b,x-y,w-b),t.matrix){const E=new Path2D;E.addPath(m,new DOMMatrix(t.matrix)),m=E}p.clip(m),t.smask?this.smaskStack.push({canvas:u.canvas,context:p,offsetX:r,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,o),e.save()),rl(e,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=At(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=mr.slice();$.axialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s,n),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(v(this,Cc,ag).call(this),md(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const r=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=r,e[3]=o,$.singularValueDecompose2dScale(At(this.ctx),Xe);const{viewportScale:c}=this,h=Math.ceil(r*this.outputScaleX*c),d=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Xe[0],0,0,-Xe[1],0,o*Xe[1]),md(this.ctx)}else{md(this.ctx),this.endPath();const c=new Path2D;c.rect(e[0],e[1],r,o),this.ctx.clip(c)}}this.current=new zm(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),v(this,Tc,rg).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const i=this.ctx,s=this._createMaskCanvas(t),n=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(n,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,r){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const c=At(o);o.transform(e,i,s,n,0,0);const h=this._createMaskCanvas(t);o.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]);for(let d=0,u=r.length;d<u;d+=2){const p=$.transform(c,[e,i,s,n,r[d],r[d+1]]);o.drawImage(h.canvas,p[4],p[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of t){const{data:r,width:o,height:c,transform:h}=n,d=this.cachedCanvases.getCanvas("maskCanvas",o,c),u=d.context;u.save();const p=this.getObject(r,n);$m(u,p),u.globalCompositeOperation="source-in",u.fillStyle=s?i.getPattern(u,this,_i(e),se.FILL):i,u.fillRect(0,0,o,c),u.restore(),e.save(),e.transform(...h),e.scale(1,-1),gd(e,d.canvas,0,0,o,c,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){W("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){W("Dependent image isn't ready yet");return}const r=n.width,o=n.height,c=[];for(let h=0,d=s.length;h<d;h+=2)c.push({transform:[e,0,0,i,s[h],s[h+1]],x:0,y:0,w:r,h:o});this.paintInlineImageXObjectGroup(n,c)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,i=t.height,s=this.ctx;this.save();const{filter:n}=s;n!=="none"&&n!==""&&(s.filter="none"),s.scale(1/e,-1/i);let r;if(t.bitmap)r=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)r=t;else{const h=this.cachedCanvases.getCanvas("inlineImage",e,i).context;Hm(h,t),r=this.applyTransferMapsToCanvas(h)}const o=this._scaleImage(r,_i(s));s.imageSmoothingEnabled=Um(At(s),t.interpolate),gd(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const i=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const n=t.width,r=t.height,c=this.cachedCanvases.getCanvas("inlineImage",n,r).context;Hm(c,t),s=this.applyTransferMapsToCanvas(c)}for(const n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),gd(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(i||(this.pendingClip===Gm?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=At(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform();let r,o;if(i===0&&s===0){const c=Math.abs(e),h=Math.abs(n);if(c===h)if(t===0)r=o=1/c;else{const d=c*t;r=o=d<1?1/d:1}else if(t===0)r=1/c,o=1/h;else{const d=c*t,u=h*t;r=d<1?1/d:1,o=u<1?1/u:1}}else{const c=Math.abs(e*n-i*s),h=Math.hypot(e,i),d=Math.hypot(s,n);if(t===0)r=d/c,o=h/c;else{const u=t*c;r=d>u?d/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:i,current:{lineWidth:s}}=this,[n,r]=this.getScaleForStroking();if(n===r){i.lineWidth=(s||1)*n,i.stroke(t);return}const o=i.getLineDash();e&&i.save(),i.scale(n,r),Cf.a=1/n,Cf.d=1/r;const c=new Path2D;if(c.addPath(t,Cf),o.length>0){const h=Math.max(n,r);i.setLineDash(o.map(d=>d/h)),i.lineDashOffset/=h}i.lineWidth=s||1,i.stroke(c),e&&i.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};Cc=new WeakSet,ag=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Tc=new WeakSet,rg=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},kc=new WeakSet,og=function(t,e,i){const s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s};let yr=gm;for(const l in Ll)yr.prototype[l]!==void 0&&(yr.prototype[Ll[l]]=yr.prototype[l]);var Pc,Rc;class ni{static get workerPort(){return a(this,Pc)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");g(this,Pc,t)}static get workerSrc(){return a(this,Rc)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");g(this,Rc,t)}}Pc=new WeakMap,Rc=new WeakMap,f(ni,Pc,null),f(ni,Rc,"");var Yr,Lc;class Xw{constructor({parsedData:t,rawData:e}){f(this,Yr,void 0);f(this,Lc,void 0);g(this,Yr,t),g(this,Lc,e)}getRaw(){return a(this,Lc)}get(t){return a(this,Yr).get(t)??null}[Symbol.iterator](){return a(this,Yr).entries()}}Yr=new WeakMap,Lc=new WeakMap;const pr=Symbol("INTERNAL");var Dc,Ic,Mc,Kr;class Yw{constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){f(this,Dc,!1);f(this,Ic,!1);f(this,Mc,!1);f(this,Kr,!0);g(this,Dc,!!(t&qe.DISPLAY)),g(this,Ic,!!(t&qe.PRINT)),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(a(this,Mc))return a(this,Kr);if(!a(this,Kr))return!1;const{print:t,view:e}=this.usage;return a(this,Dc)?(e==null?void 0:e.viewState)!=="OFF":a(this,Ic)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,i=!1){t!==pr&&lt("Internal method `_setVisible` called."),g(this,Mc,i),g(this,Kr,e)}}Dc=new WeakMap,Ic=new WeakMap,Mc=new WeakMap,Kr=new WeakMap;var Zs,ot,Jr,Qr,Fc,lg;class Kw{constructor(t,e=qe.DISPLAY){f(this,Fc);f(this,Zs,null);f(this,ot,new Map);f(this,Jr,null);f(this,Qr,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,g(this,Qr,t.order);for(const i of t.groups)a(this,ot).set(i.id,new Yw(e,i));if(t.baseState==="OFF")for(const i of a(this,ot).values())i._setVisible(pr,!1);for(const i of t.on)a(this,ot).get(i)._setVisible(pr,!0);for(const i of t.off)a(this,ot).get(i)._setVisible(pr,!1);g(this,Jr,this.getHash())}}isVisible(t){if(a(this,ot).size===0)return!0;if(!t)return Qp("Optional content group not defined."),!0;if(t.type==="OCG")return a(this,ot).has(t.id)?a(this,ot).get(t.id).visible:(W(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return v(this,Fc,lg).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!a(this,ot).has(e))return W(`Optional content group not found: ${e}`),!0;if(a(this,ot).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!a(this,ot).has(e))return W(`Optional content group not found: ${e}`),!0;if(!a(this,ot).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!a(this,ot).has(e))return W(`Optional content group not found: ${e}`),!0;if(!a(this,ot).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!a(this,ot).has(e))return W(`Optional content group not found: ${e}`),!0;if(a(this,ot).get(e).visible)return!1}return!0}return W(`Unknown optional content policy ${t.policy}.`),!0}return W(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){var n;const s=a(this,ot).get(t);if(!s){W(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(const r of s.rbGroups)for(const o of r)o!==t&&((n=a(this,ot).get(o))==null||n._setVisible(pr,!1,!0));s._setVisible(pr,!!e,!0),g(this,Zs,null)}setOCGState({state:t,preserveRB:e}){let i;for(const s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=a(this,ot).get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}g(this,Zs,null)}get hasInitialVisibility(){return a(this,Jr)===null||this.getHash()===a(this,Jr)}getOrder(){return a(this,ot).size?a(this,Qr)?a(this,Qr).slice():[...a(this,ot).keys()]:null}getGroup(t){return a(this,ot).get(t)||null}getHash(){if(a(this,Zs)!==null)return a(this,Zs);const t=new ob;for(const[e,i]of a(this,ot))t.update(`${e}:${i.visible}`);return g(this,Zs,t.hexdigest())}[Symbol.iterator](){return a(this,ot).entries()}}Zs=new WeakMap,ot=new WeakMap,Jr=new WeakMap,Qr=new WeakMap,Fc=new WeakSet,lg=function(t){const e=t.length;if(e<2)return!0;const i=t[0];for(let s=1;s<e;s++){const n=t[s];let r;if(Array.isArray(n))r=v(this,Fc,lg).call(this,n);else if(a(this,ot).has(n))r=a(this,ot).get(n).visible;else return W(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return i==="And"};class Jw{constructor(t,{disableRange:e=!1,disableStream:i=!1}){Ot(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:r,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const c=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((c,h)=>{this._onReceiveData({begin:c,chunk:h})}),t.addProgressListener((c,h)=>{this._onProgress({loaded:c,total:h})}),t.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});Ot(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,i,s,n;t.total===void 0?(i=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||i.call(e,{loaded:t.loaded}):(n=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||n.call(s,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Ot(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new Qw(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new Zw(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeReaders.slice(0))i.cancel(t);this._pdfDataRangeTransport.abort()}}class Qw{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=tf(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Zw{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function tA(l){let t=!0,e=i("filename\\*","i").exec(l);if(e){e=e[1];let d=o(e);return d=unescape(d),d=c(d),d=h(d),n(d)}if(e=r(l),e){const d=h(e);return n(d)}if(e=i("filename","i").exec(l),e){e=e[1];let d=o(e);return d=h(d),n(d)}function i(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function s(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(d,{fatal:!0}),m=sd(u);u=p.decode(m),t=!1}catch{}}return u}function n(d){return t&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),t&&(d=s("iso-8859-1",d))),d}function r(d){const u=[];let p;const m=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=m.exec(d))!==null;){let[,b,x,w]=p;if(b=parseInt(b,10),b in u){if(b===0)break;continue}u[b]=[x,w]}const y=[];for(let b=0;b<u.length&&b in u;++b){let[x,w]=u[b];w=o(w),x&&(w=unescape(w),b===0&&(w=c(w))),y.push(w)}return y.join("")}function o(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let p=0;p<u.length;++p){const m=u[p].indexOf('"');m!==-1&&(u[p]=u[p].slice(0,m),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function c(d){const u=d.indexOf("'");if(u===-1)return d;const p=d.slice(0,u),y=d.slice(u+1).replace(/^[^']*'/,"");return s(p,y)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,m,y){if(m==="q"||m==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(b,x){return String.fromCharCode(parseInt(x,16))}),s(p,y);try{y=atob(y)}catch{}return s(p,y)})}return""}function xb(l,t){const e=new Headers;if(!l||!t||typeof t!="object")return e;for(const i in t){const s=t[i];s!==void 0&&e.append(i,s)}return e}function sf(l){var t;return((t=URL.parse(l))==null?void 0:t.origin)??null}function wb({responseHeaders:l,isHttp:t,rangeChunkSize:e,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(l.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||l.get("Accept-Ranges")!=="bytes"||(l.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Ab(l){const t=l.get("Content-Disposition");if(t){let e=tA(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(tf(e))return e}return null}function od(l,t){return new Dl(`Unexpected server response (${l}) while retrieving PDF "${t}".`,l,l===404||l===0&&t.startsWith("file:"))}function Eb(l){return l===200||l===206}function _b(l,t,e){return{method:"GET",headers:l,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Sb(l){return l instanceof Uint8Array?l.buffer:l instanceof ArrayBuffer?l:(W(`getArrayBuffer - unexpected data format: ${l}`),new Uint8Array(l).buffer)}class eA{constructor(t){I(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=xb(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ot(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new iA(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new sA(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class iA{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const i=new Headers(t.headers),s=e.url;fetch(s,_b(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=sf(n.url),!Eb(n.status))throw od(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:o,suggestedLength:c}=wb({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=c||this._contentLength,this._filename=Ab(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ls("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Sb(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class sA{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;const s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);const r=s.url;fetch(r,_b(n,this._withCredentials,this._abortController)).then(o=>{const c=sf(o.url);if(c!==t._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${t._responseOrigin}".`);if(!Eb(o.status))throw od(o.status,r);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:Sb(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Tf=200,kf=206;function nA(l){const t=l.response;return typeof t!="string"?t:sd(t).buffer}class aA{constructor({url:t,httpHeaders:e,withCredentials:i}){I(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=xb(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=kf):s.expectedStatus=Tf,e.responseType="arraybuffer",Ot(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){var s;const i=this.pendingRequests[t];i&&((s=i.onProgress)==null||s.call(i,e))}onStateChange(t,e){const i=this.pendingRequests[t];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||Tf;if(!(n===Tf&&i.expectedStatus===kf)&&n!==i.expectedStatus){i.onError(s.status);return}const o=nA(s);if(n===kf){const c=s.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);h?i.onDone({begin:parseInt(h[1],10),chunk:o}):(W('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class rA{constructor(t){this._source=t,this._manager=new aA(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Ot(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new oA(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const i=new lA(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class oA{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=sf(e.responseURL);const i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[c,...h]=o.split(": ");return[c,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=wb({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Ab(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=od(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class lA{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=sf((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=od(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const cA=/^[a-z][a-z0-9\-+.]+:/i;function hA(l){if(cA.test(l))return new URL(l);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(l))}class dA{constructor(t){this.source=t,this.url=hA(t.url),Ot(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return Ot(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new uA(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const i=new pA(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const i of this._rangeRequestReaders.slice(0))i.cancel(t)}}class uA{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=od(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ls("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class pA{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=t.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var i;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(i=this.onProgress)==null||i.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ol=Symbol("INITIAL_DATA");var Ne,Nc,cg;class Cb{constructor(){f(this,Nc);f(this,Ne,Object.create(null))}get(t,e=null){if(e){const s=v(this,Nc,cg).call(this,t);return s.promise.then(()=>e(s.data)),null}const i=a(this,Ne)[t];if(!i||i.data===ol)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){const e=a(this,Ne)[t];return!!e&&e.data!==ol}delete(t){const e=a(this,Ne)[t];return!e||e.data===ol?!1:(delete a(this,Ne)[t],!0)}resolve(t,e=null){const i=v(this,Nc,cg).call(this,t);i.data=e,i.resolve()}clear(){var t;for(const e in a(this,Ne)){const{data:i}=a(this,Ne)[e];(t=i==null?void 0:i.bitmap)==null||t.close()}g(this,Ne,Object.create(null))}*[Symbol.iterator](){for(const t in a(this,Ne)){const{data:e}=a(this,Ne)[t];e!==ol&&(yield[t,e])}}}Ne=new WeakMap,Nc=new WeakSet,cg=function(t){var e;return(e=a(this,Ne))[t]||(e[t]={...Promise.withResolvers(),data:ol})};const fA=1e5,Vm=30;var sv,tn,Te,Oc,jc,ha,hs,Bc,zc,da,Zr,to,en,eo,Hc,io,ua,$c,Uc,yt,so,pa,Gc,sn,no,Wu,Tb,qu,kb,Vc,hg,ao,Pd,Wc,dg,Xu,Pb,Yu,Rb;let Ml=(yt=class{constructor({textContentSource:t,container:e,viewport:i}){f(this,Wu);f(this,qu);f(this,Vc);f(this,tn,Promise.withResolvers());f(this,Te,null);f(this,Oc,!1);f(this,jc,!!((sv=globalThis.FontInspector)!=null&&sv.enabled));f(this,ha,null);f(this,hs,null);f(this,Bc,0);f(this,zc,0);f(this,da,null);f(this,Zr,null);f(this,to,0);f(this,en,0);f(this,eo,Object.create(null));f(this,Hc,[]);f(this,io,null);f(this,ua,[]);f(this,$c,new WeakMap);f(this,Uc,null);var c;if(t instanceof ReadableStream)g(this,io,t);else if(typeof t=="object")g(this,io,new ReadableStream({start(h){h.enqueue(t),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,Te,g(this,Zr,e)),g(this,en,i.scale*wi.pixelRatio),g(this,to,i.rotation),g(this,hs,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:n,pageX:r,pageY:o}=i.rawDims;g(this,Uc,[1,0,0,-1,-r,o+n]),g(this,zc,s),g(this,Bc,n),v(c=yt,Xu,Pb).call(c),_n(e,i),a(this,tn).promise.finally(()=>{a(yt,no).delete(this),g(this,hs,null),g(this,eo,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Yt.platform;return J(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{a(this,da).read().then(({value:e,done:i})=>{if(i){a(this,tn).resolve();return}a(this,ha)??g(this,ha,e.lang),Object.assign(a(this,eo),e.styles),v(this,Wu,Tb).call(this,e.items),t()},a(this,tn).reject)};return g(this,da,a(this,io).getReader()),a(yt,no).add(this),t(),a(this,tn).promise}update({viewport:t,onBefore:e=null}){var n;const i=t.scale*wi.pixelRatio,s=t.rotation;if(s!==a(this,to)&&(e==null||e(),g(this,to,s),_n(a(this,Zr),{rotation:s})),i!==a(this,en)){e==null||e(),g(this,en,i);const r={div:null,properties:null,ctx:v(n=yt,ao,Pd).call(n,a(this,ha))};for(const o of a(this,ua))r.properties=a(this,$c).get(o),r.div=o,v(this,Vc,hg).call(this,r)}}cancel(){var e;const t=new Ls("TextLayer task cancelled.");(e=a(this,da))==null||e.cancel(t).catch(()=>{}),g(this,da,null),a(this,tn).reject(t)}get textDivs(){return a(this,ua)}get textContentItemsStr(){return a(this,Hc)}static cleanup(){if(!(a(this,no).size>0)){a(this,so).clear();for(const{canvas:t}of a(this,pa).values())t.remove();a(this,pa).clear()}}},tn=new WeakMap,Te=new WeakMap,Oc=new WeakMap,jc=new WeakMap,ha=new WeakMap,hs=new WeakMap,Bc=new WeakMap,zc=new WeakMap,da=new WeakMap,Zr=new WeakMap,to=new WeakMap,en=new WeakMap,eo=new WeakMap,Hc=new WeakMap,io=new WeakMap,ua=new WeakMap,$c=new WeakMap,Uc=new WeakMap,so=new WeakMap,pa=new WeakMap,Gc=new WeakMap,sn=new WeakMap,no=new WeakMap,Wu=new WeakSet,Tb=function(t){var s,n;if(a(this,Oc))return;(n=a(this,hs)).ctx??(n.ctx=v(s=yt,ao,Pd).call(s,a(this,ha)));const e=a(this,ua),i=a(this,Hc);for(const r of t){if(e.length>fA){W("Ignoring additional textDivs for performance reasons."),g(this,Oc,!0);return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const o=a(this,Te);g(this,Te,document.createElement("span")),a(this,Te).classList.add("markedContent"),r.id!==null&&a(this,Te).setAttribute("id",`${r.id}`),o.append(a(this,Te))}else r.type==="endMarkedContent"&&g(this,Te,a(this,Te).parentNode);continue}i.push(r.str),v(this,qu,kb).call(this,r)}},qu=new WeakSet,kb=function(t){var b;const e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};a(this,ua).push(e);const s=$.transform(a(this,Uc),t.transform);let n=Math.atan2(s[1],s[0]);const r=a(this,eo)[t.fontName];r.vertical&&(n+=Math.PI/2);let o=a(this,jc)&&r.fontSubstitution||r.fontFamily;o=yt.fontFamilyMap.get(o)||o;const c=Math.hypot(s[2],s[3]),h=c*v(b=yt,Yu,Rb).call(b,o,r,a(this,ha));let d,u;n===0?(d=s[4],u=s[5]-h):(d=s[4]+h*Math.sin(n),u=s[5]-h*Math.cos(n));const p="calc(var(--total-scale-factor) *",m=e.style;a(this,Te)===a(this,Zr)?(m.left=`${(100*d/a(this,zc)).toFixed(2)}%`,m.top=`${(100*u/a(this,Bc)).toFixed(2)}%`):(m.left=`${p}${d.toFixed(2)}px)`,m.top=`${p}${u.toFixed(2)}px)`),m.fontSize=`${p}${(a(yt,sn)*c).toFixed(2)}px)`,m.fontFamily=o,i.fontSize=c,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,a(this,jc)&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let y=!1;if(t.str.length>1)y=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const x=Math.abs(t.transform[0]),w=Math.abs(t.transform[3]);x!==w&&Math.max(x,w)/Math.min(x,w)>1.5&&(y=!0)}if(y&&(i.canvasWidth=r.vertical?t.height:t.width),a(this,$c).set(e,i),a(this,hs).div=e,a(this,hs).properties=i,v(this,Vc,hg).call(this,a(this,hs)),i.hasText&&a(this,Te).append(e),i.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),a(this,Te).append(x)}},Vc=new WeakSet,hg=function(t){var o;const{div:e,properties:i,ctx:s}=t,{style:n}=e;let r="";if(a(yt,sn)>1&&(r=`scale(${1/a(yt,sn)})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:c}=n,{canvasWidth:h,fontSize:d}=i;v(o=yt,Wc,dg).call(o,s,d*a(this,en),c);const{width:u}=s.measureText(e.textContent);u>0&&(r=`scaleX(${h*a(this,en)/u}) ${r}`)}i.angle!==0&&(r=`rotate(${i.angle}deg) ${r}`),r.length>0&&(n.transform=r)},ao=new WeakSet,Pd=function(t=null){let e=a(this,pa).get(t||(t=""));if(!e){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,pa).set(t,e),a(this,Gc).set(e,{size:0,family:""})}return e},Wc=new WeakSet,dg=function(t,e,i){const s=a(this,Gc).get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)},Xu=new WeakSet,Pb=function(){if(a(this,sn)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),g(this,sn,t.getBoundingClientRect().height),t.remove()},Yu=new WeakSet,Rb=function(t,e,i){const s=a(this,so).get(t);if(s)return s;const n=v(this,ao,Pd).call(this,i);n.canvas.width=n.canvas.height=Vm,v(this,Wc,dg).call(this,n,Vm,t);const r=n.measureText(""),o=r.fontBoundingBoxAscent,c=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+c):(Yt.platform.isFirefox&&W("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),a(this,so).set(t,h),h},f(yt,ao),f(yt,Wc),f(yt,Xu),f(yt,Yu),f(yt,so,new Map),f(yt,pa,new Map),f(yt,Gc,new WeakMap),f(yt,sn,null),f(yt,no,new Set),yt);class Fl{static textContent(t){const e=[],i={items:e,styles:Object.create(null)};function s(n){var c;if(!n)return;let r=null;const o=n.name;if(o==="#text")r=n.value;else if(Fl.shouldBuildText(o))(c=n==null?void 0:n.attributes)!=null&&c.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const h of n.children)s(h)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const gA=100;function am(l={}){typeof l=="string"||l instanceof URL?l={url:l}:(l instanceof ArrayBuffer||ArrayBuffer.isView(l))&&(l={data:l});const t=new ug,{docId:e}=t,i=l.url?Sw(l.url):null,s=l.data?Cw(l.data):null,n=l.httpHeaders||null,r=l.withCredentials===!0,o=l.password??null,c=l.range instanceof rm?l.range:null,h=Number.isInteger(l.rangeChunkSize)&&l.rangeChunkSize>0?l.rangeChunkSize:2**16;let d=l.worker instanceof il?l.worker:null;const u=l.verbosity,p=typeof l.docBaseUrl=="string"&&!ad(l.docBaseUrl)?l.docBaseUrl:null,m=pd(l.cMapUrl),y=l.cMapPacked!==!1,b=l.CMapReaderFactory||(xe?Iw:Im),x=pd(l.iccUrl),w=pd(l.standardFontDataUrl),E=l.StandardFontDataFactory||(xe?Mw:Mm),A=pd(l.wasmUrl),_=l.WasmFactory||(xe?Fw:Fm),S=l.stopAtErrors!==!0,T=Number.isInteger(l.maxImageSize)&&l.maxImageSize>-1?l.maxImageSize:-1,C=l.isEvalSupported!==!1,P=typeof l.isOffscreenCanvasSupported=="boolean"?l.isOffscreenCanvasSupported:!xe,k=typeof l.isImageDecoderSupported=="boolean"?l.isImageDecoderSupported:!xe&&(Yt.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(l.canvasMaxAreaInBytes)?l.canvasMaxAreaInBytes:-1,M=typeof l.disableFontFace=="boolean"?l.disableFontFace:xe,q=l.fontExtraProperties===!0,G=l.enableXfa===!0,O=l.ownerDocument||globalThis.document,X=l.disableRange===!0,F=l.disableStream===!0,N=l.disableAutoFetch===!0,ft=l.pdfBug===!0,et=l.CanvasFactory||(xe?Dw:Pw),pe=l.FilterFactory||(xe?Lw:Rw),ne=l.enableHWA===!0,nt=l.useWasm!==!1,st=c?c.length:l.length??NaN,Tt=typeof l.useSystemFonts=="boolean"?l.useSystemFonts:!xe&&!M,Kt=typeof l.useWorkerFetch=="boolean"?l.useWorkerFetch:!!(b===Im&&E===Mm&&_===Fm&&m&&w&&A&&hl(m,document.baseURI)&&hl(w,document.baseURI)&&hl(A,document.baseURI)),xt=null;ow(u);const it={canvasFactory:new et({ownerDocument:O,enableHWA:ne}),filterFactory:new pe({docId:e,ownerDocument:O}),cMapReaderFactory:Kt?null:new b({baseUrl:m,isCompressed:y}),standardFontDataFactory:Kt?null:new E({baseUrl:w}),wasmFactory:Kt?null:new _({baseUrl:A})};d||(d=il.create({verbosity:u,port:ni.workerPort}),t._worker=d);const Re={docId:e,apiVersion:"5.3.93",data:s,password:o,disableAutoFetch:N,rangeChunkSize:h,length:st,docBaseUrl:p,enableXfa:G,evaluatorOptions:{maxImageSize:T,disableFontFace:M,ignoreErrors:S,isEvalSupported:C,isOffscreenCanvasSupported:P,isImageDecoderSupported:k,canvasMaxAreaInBytes:D,fontExtraProperties:q,useSystemFonts:Tt,useWasm:nt,useWorkerFetch:Kt,cMapUrl:m,iccUrl:x,standardFontDataUrl:w,wasmUrl:A}},we={ownerDocument:O,pdfBug:ft,styleElement:xt,loadingParams:{disableAutoFetch:N,enableXfa:G}};return d.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const rt=d.messageHandler.sendWithPromise("GetDocRequest",Re,s?[s.buffer]:null);let Ae;if(c)Ae=new Jw(c,{disableRange:X,disableStream:F});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const ae=hl(i)?eA:xe?dA:rA;Ae=new ae({url:i,length:st,httpHeaders:n,withCredentials:r,rangeChunkSize:h,disableRange:X,disableStream:F})}return rt.then(ae=>{if(t.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Z=new gl(e,ae,d.port),ct=new bA(Z,t,Ae,we,it);t._transport=ct,Z.send("Ready",null)})}).catch(t._capability.reject),t}var Ku;const Ju=class Ju{constructor(){I(this,"_capability",Promise.withResolvers());I(this,"_transport",null);I(this,"_worker",null);I(this,"docId",`d${fe(Ju,Ku)._++}`);I(this,"destroyed",!1);I(this,"onPassword",null);I(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,i,s;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(n){throw(i=this._worker)!=null&&i.port&&delete this._worker._pendingDestroy,n}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Ku=new WeakMap,f(Ju,Ku,0);let ug=Ju;var fa,qc,Xc,Yc,Kc,nv;let rm=(nv=class{constructor(t,e,i=!1,s=null){f(this,fa,Promise.withResolvers());f(this,qc,[]);f(this,Xc,[]);f(this,Yc,[]);f(this,Kc,[]);this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s}addRangeListener(t){a(this,Kc).push(t)}addProgressListener(t){a(this,Yc).push(t)}addProgressiveReadListener(t){a(this,Xc).push(t)}addProgressiveDoneListener(t){a(this,qc).push(t)}onDataRange(t,e){for(const i of a(this,Kc))i(t,e)}onDataProgress(t,e){a(this,fa).promise.then(()=>{for(const i of a(this,Yc))i(t,e)})}onDataProgressiveRead(t){a(this,fa).promise.then(()=>{for(const e of a(this,Xc))e(t)})}onDataProgressiveDone(){a(this,fa).promise.then(()=>{for(const t of a(this,qc))t()})}transportReady(){a(this,fa).resolve()}requestDataRange(t,e){lt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},fa=new WeakMap,qc=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,Kc=new WeakMap,nv);class mA{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var ds,ga,xl;class vA{constructor(t,e,i,s=!1){f(this,ga);f(this,ds,!1);this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new Rm:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new Cb,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new nd({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return J(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=Vi.ENABLE,transform:n=null,background:r=null,optionalContentConfigPromise:o=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1}){var _,S;(_=this._stats)==null||_.time("Overall");const p=this._transport.getRenderingIntent(i,s,d,u),{renderingIntent:m,cacheKey:y}=p;g(this,ds,!1),o||(o=this._transport.getOptionalContentConfig(m));let b=this._intentStates.get(y);b||(b=Object.create(null),this._intentStates.set(y,b)),b.streamReaderCancelTimeout&&(clearTimeout(b.streamReaderCancelTimeout),b.streamReaderCancelTimeout=null);const x=!!(m&qe.PRINT);b.displayReadyCapability||(b.displayReadyCapability=Promise.withResolvers(),b.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(S=this._stats)==null||S.time("Page Request"),this._pumpOperatorList(p));const w=T=>{var C;b.renderTasks.delete(E),x&&g(this,ds,!0),v(this,ga,xl).call(this),T?(E.capability.reject(T),this._abortOperatorList({intentState:b,reason:T instanceof Error?T:new Error(T)})):E.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(C=globalThis.Stats)!=null&&C.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},E=new pg({callback:w,params:{canvasContext:t,viewport:e,transform:n,background:r},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:b.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!x,pdfBug:this._pdfBug,pageColors:h});(b.renderTasks||(b.renderTasks=new Set)).add(E);const A=E.task;return Promise.all([b.displayReadyCapability.promise,o]).then(([T,C])=>{var P;if(this.destroyed){w();return}if((P=this._stats)==null||P.time("Rendering"),!(C.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");E.initializeGraphics({transparency:T,optionalContentConfig:C}),E.operatorListChanged()}).catch(w),A}getOperatorList({intent:t="display",annotationMode:e=Vi.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(c))}const r=this._transport.getRenderingIntent(t,e,i,s,!0);let o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let c;return o.opListReadCapability||(c=Object.create(null),c.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(c),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Fl.textContent(i));const e=this.streamTextContent(t);return new Promise(function(i,s){function n(){r.read().then(function({value:c,done:h}){if(h){i(o);return}o.lang??(o.lang=c.lang),Object.assign(o.styles,c.styles),o.items.push(...c.items),n()},s)}const r=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),g(this,ds,!1),Promise.all(t)}cleanup(t=!1){g(this,ds,!0);const e=v(this,ga,xl).call(this);return t&&e&&this._stats&&(this._stats=new Rm),e}_startRenderPage(t,e){var s,n;const i=this._intentStates.get(e);i&&((s=this._stats)==null||s.timeEnd("Page Request"),(n=i.displayReadyCapability)==null||n.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const i of e.renderTasks)i.operatorListChanged();t.lastChunk&&v(this,ga,xl).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:r}=i,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},r).getReader(),h=this._intentStates.get(e);h.streamReader=c;const d=()=>{c.read().then(({value:u,done:p})=>{if(p){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),d())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const p of h.renderTasks)p.operatorListChanged();v(this,ga,xl).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Zp){let s=gA;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Ls(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}ds=new WeakMap,ga=new WeakSet,xl=function(){if(!a(this,ds)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,ds,!1),!0};var nn,di,us,ma,Qu,va,ba,ro,Rd,Zu,Lb,tp,Db,ya,wl,oo,Ld;const mt=class mt{constructor({name:t=null,port:e=null,verbosity:i=lw()}={}){f(this,ro);f(this,Zu);f(this,tp);f(this,ya);f(this,nn,Promise.withResolvers());f(this,di,null);f(this,us,null);f(this,ma,null);if(this.name=t,this.destroyed=!1,this.verbosity=i,e){if(a(mt,ba).has(e))throw new Error("Cannot use more than one PDFWorker per port.");a(mt,ba).set(e,this),v(this,Zu,Lb).call(this,e)}else v(this,tp,Db).call(this)}get promise(){return a(this,nn).promise}get port(){return a(this,us)}get messageHandler(){return a(this,di)}destroy(){var t,e;this.destroyed=!0,(t=a(this,ma))==null||t.terminate(),g(this,ma,null),a(mt,ba).delete(a(this,us)),g(this,us,null),(e=a(this,di))==null||e.destroy(),g(this,di,null)}static create(t){const e=a(this,ba).get(t==null?void 0:t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new mt(t)}static get workerSrc(){if(ni.workerSrc)return ni.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return J(this,"_setupFakeWorkerGlobal",(async()=>a(this,oo,Ld)?a(this,oo,Ld):(await lx(()=>import(this.workerSrc),[])).WorkerMessageHandler)())}};nn=new WeakMap,di=new WeakMap,us=new WeakMap,ma=new WeakMap,Qu=new WeakMap,va=new WeakMap,ba=new WeakMap,ro=new WeakSet,Rd=function(){a(this,nn).resolve(),a(this,di).send("configure",{verbosity:this.verbosity})},Zu=new WeakSet,Lb=function(t){g(this,us,t),g(this,di,new gl("main","worker",t)),a(this,di).on("ready",()=>{}),v(this,ro,Rd).call(this)},tp=new WeakSet,Db=function(){if(a(mt,va)||a(mt,oo,Ld)){v(this,ya,wl).call(this);return}let{workerSrc:t}=mt;try{mt._isSameOrigin(window.location,t)||(t=mt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),i=new gl("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?a(this,nn).reject(new Error("Worker was destroyed")):v(this,ya,wl).call(this)},n=new AbortController;e.addEventListener("error",()=>{a(this,ma)||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}g(this,di,i),g(this,us,e),g(this,ma,e),v(this,ro,Rd).call(this)}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{r()}catch{v(this,ya,wl).call(this)}});const r=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};r();return}catch{Qp("The worker has been disabled.")}v(this,ya,wl).call(this)},ya=new WeakSet,wl=function(){a(mt,va)||(W("Setting up fake worker."),g(mt,va,!0)),mt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){a(this,nn).reject(new Error("Worker was destroyed"));return}const e=new kw;g(this,us,e);const i=`fake${fe(mt,Qu)._++}`,s=new gl(i+"_worker",i,e);t.setup(s,e),g(this,di,new gl(i,i+"_worker",e)),v(this,ro,Rd).call(this)}).catch(t=>{a(this,nn).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},oo=new WeakSet,Ld=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},f(mt,oo),f(mt,Qu,0),f(mt,va,!1),f(mt,ba,new WeakMap),xe&&(g(mt,va,!0),ni.workerSrc||(ni.workerSrc="./pdf.worker.mjs")),mt._isSameOrigin=(t,e)=>{const i=URL.parse(t);if(!(i!=null&&i.origin)||i.origin==="null")return!1;const s=new URL(e,i);return i.origin===s.origin},mt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},mt.fromPort=t=>{if(vw("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return mt.create(t)};let il=mt;var ps,Ni,lo,co,fs,xa,Al;class bA{constructor(t,e,i,s,n){f(this,xa);f(this,ps,new Map);f(this,Ni,new Map);f(this,lo,new Map);f(this,co,new Map);f(this,fs,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Cb,this.fontLoader=new Ew({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return J(this,"annotationStorage",new im)}getRenderingIntent(t,e=Vi.ENABLE,i=null,s=!1,n=!1){let r=qe.DISPLAY,o=Zf;switch(t){case"any":r=qe.ANY;break;case"display":break;case"print":r=qe.PRINT;break;default:W(`getRenderingIntent - invalid intent: ${t}`)}const c=r&qe.PRINT&&i instanceof cb?i:this.annotationStorage;switch(e){case Vi.DISABLE:r+=qe.ANNOTATIONS_DISABLE;break;case Vi.ENABLE:break;case Vi.ENABLE_FORMS:r+=qe.ANNOTATIONS_FORMS;break;case Vi.ENABLE_STORAGE:r+=qe.ANNOTATIONS_STORAGE,o=c.serializable;break;default:W(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(r+=qe.IS_EDITING),n&&(r+=qe.OPLIST);const{ids:h,hash:d}=c.modifiedIds,u=[r,o.hash,d];return{renderingIntent:r,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var i;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(i=a(this,fs))==null||i.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of a(this,Ni).values())t.push(s._destroy());a(this,Ni).clear(),a(this,lo).clear(),a(this,co).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var s,n;this.commonObjs.clear(),this.fontLoader.clear(),a(this,ps).clear(),this.filterFactory.destroy(),Ml.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new Ls("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{Ot(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){s.close();return}Ot(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async i=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:r}=this._fullReader;return(!s||!n)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),this._fullReader.onProgress=c=>{var h;(h=e.onProgress)==null||h.call(e,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(i,s)=>{Ot(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:r,done:o}){if(o){s.close();return}Ot(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{n.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new mA(i,this))}),t.on("DocException",i=>{e._capability.reject(_e(i))}),t.on("PasswordRequest",i=>{g(this,fs,Promise.withResolvers());try{if(!e.onPassword)throw _e(i);const s=n=>{n instanceof Error?a(this,fs).reject(n):a(this,fs).resolve({password:n})};e.onPassword(s,i.code)}catch(s){a(this,fs).reject(s)}return a(this,fs).promise}),t.on("DataLoaded",i=>{var s;(s=e.onProgress)==null||s.call(e,{loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;a(this,Ni).get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{var r;if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in n){const d=n.error;W(`Error during font loading: ${d}`),this.commonObjs.resolve(i,d);break}const o=this._params.pdfBug&&((r=globalThis.FontInspector)!=null&&r.enabled)?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,c=new _w(n,o);this.fontLoader.bind(c).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!c.fontExtraProperties&&c.data&&(c.data=null),this.commonObjs.resolve(i,c)});break;case"CopyLocalImage":const{imageRef:h}=n;Ot(h,"The imageRef must be defined.");for(const d of a(this,Ni).values())for(const[,u]of d.objs)if((u==null?void 0:u.ref)===h)return u.dataLen?(this.commonObjs.resolve(i,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,r])=>{var c;if(this.destroyed)return;const o=a(this,Ni).get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){(c=r==null?void 0:r.bitmap)==null||c.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(i,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{var s;this.destroyed||(s=e.onProgress)==null||s.call(e,{loaded:i.loaded,total:i.total})}),t.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var i;this.annotationStorage.size<=0&&W("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((i=this._fullReader)==null?void 0:i.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,i=a(this,lo).get(e);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&a(this,co).set(n.refStr,t);const r=new vA(e,n,this,this._params.pdfBug);return a(this,Ni).set(e,r),r});return a(this,lo).set(e,s),s}getPageIndex(t){return tg(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return v(this,xa,Al).call(this,"GetFieldObjects")}hasJSActions(){return v(this,xa,Al).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return v(this,xa,Al).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return v(this,xa,Al).call(this,"GetOptionalContentConfig").then(e=>new Kw(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=a(this,ps).get(t);if(e)return e;const i=this.messageHandler.sendWithPromise(t,null).then(s=>{var n,r;return{info:s[0],metadata:s[1]?new Xw(s[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((r=this._fullReader)==null?void 0:r.contentLength)??null}});return a(this,ps).set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of a(this,Ni).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),a(this,ps).clear(),this.filterFactory.destroy(!0),Ml.cleanup()}}cachedPageNumber(t){if(!tg(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return a(this,co).get(e)??null}}ps=new WeakMap,Ni=new WeakMap,lo=new WeakMap,co=new WeakMap,fs=new WeakMap,xa=new WeakSet,Al=function(t,e=null){const i=a(this,ps).get(t);if(i)return i;const s=this.messageHandler.sendWithPromise(t,e);return a(this,ps).set(t,s),s};var an;class yA{constructor(t){f(this,an,null);I(this,"onContinue",null);I(this,"onError",null);g(this,an,t)}get promise(){return a(this,an).capability.promise}cancel(t=0){a(this,an).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=a(this,an).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=a(this,an);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}an=new WeakMap;var rn,wa;const Dn=class Dn{constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:r,pageIndex:o,canvasFactory:c,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:p=null}){f(this,rn,null);this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=o,this.canvasFactory=c,this.filterFactory=h,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new yA(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var o,c;if(this.cancelled)return;if(this._canvas){if(a(Dn,wa).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(Dn,wa).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:n,background:r}=this.params;this.gfx=new yr(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(c=this.graphicsReadyCallback)==null||c.call(this)}cancel(t=null,e=0){var i,s,n;this.running=!1,this.cancelled=!0,(i=this.gfx)==null||i.endDrawing(),a(this,rn)&&(window.cancelAnimationFrame(a(this,rn)),g(this,rn,null)),a(Dn,wa).delete(this._canvas),t||(t=new Zp(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(n=(s=this.task).onError)==null||n.call(s,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,rn,window.requestAnimationFrame(()=>{g(this,rn,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(Dn,wa).delete(this._canvas),this.callback())))}};rn=new WeakMap,wa=new WeakMap,f(Dn,wa,new WeakSet);let pg=Dn;const om="5.3.93",Ib="cbeef3233";function Wm(l){return Math.floor(Math.max(0,Math.min(1,l))*255).toString(16).padStart(2,"0")}function ll(l){return Math.max(0,Math.min(255,255*l))}class qm{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ll(t),[t,t,t]}static G_HTML([t]){const e=Wm(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(ll)}static RGB_HTML(t){return`#${t.map(Wm).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[ll(1-Math.min(1,t+s)),ll(1-Math.min(1,i+s)),ll(1-Math.min(1,e+s))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){const s=1-t,n=1-e,r=1-i,o=Math.min(s,n,r);return["CMYK",s,n,r,o]}}class xA{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){lt("Abstract method `_createSVG` called.")}}class Nl extends xA{_createSVG(t){return document.createElementNS(qi,t)}}class lm{static setupStorage(t,e,i,s,n){const r=s.getValue(e,{value:null});switch(i.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(r.value===i.attributes.xfaOn?t.setAttribute("checked",!0):r.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{s.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const o of i.children)o.attributes.value===r.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const c=o.target.options,h=c.selectedIndex===-1?"":c[c.selectedIndex].value;s.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){const{attributes:r}=e,o=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${s}`);for(const[c,h]of Object.entries(r))if(h!=null)switch(c){case"class":h.length&&t.setAttribute(c,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!o||c!=="href"&&c!=="newWindow")&&t.setAttribute(c,h)}o&&n.addLinkAttributes(t,r.href,r.newWindow),i&&r.dataId&&this.setupStorage(t,r.dataId,e,i)}static render(t){var u,p;const e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",r=document.createElement(s.name);s.attributes&&this.setAttributes({html:r,element:s,intent:n,linkService:i});const o=n!=="richText",c=t.div;if(c.append(r),t.viewport){const m=`matrix(${t.viewport.transform.join(",")})`;c.style.transform=m}o&&c.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const m=document.createTextNode(s.value);r.append(m),o&&Fl.shouldBuildText(s.name)&&h.push(m)}return{textDivs:h}}const d=[[s,-1,r]];for(;d.length>0;){const[m,y,b]=d.at(-1);if(y+1===m.children.length){d.pop();continue}const x=m.children[++d.at(-1)[1]];if(x===null)continue;const{name:w}=x;if(w==="#text"){const A=document.createTextNode(x.value);h.push(A),b.append(A);continue}const E=(u=x==null?void 0:x.attributes)!=null&&u.xmlns?document.createElementNS(x.attributes.xmlns,w):document.createElement(w);if(b.append(E),x.attributes&&this.setAttributes({html:E,element:x,storage:e,intent:n,linkService:i}),((p=x.children)==null?void 0:p.length)>0)d.push([x,-1,E]);else if(x.value){const A=document.createTextNode(x.value);o&&Fl.shouldBuildText(w)&&h.push(A),E.append(A)}}for(const m of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const wA=9,ir=new WeakSet;class Xm{static create(t){switch(t.data.annotationType){case Pt.LINK:return new Mb(t);case Pt.TEXT:return new AA(t);case Pt.WIDGET:switch(t.data.fieldType){case"Tx":return new EA(t);case"Btn":return t.data.radioButton?new Ob(t):t.data.checkBox?new SA(t):new CA(t);case"Ch":return new TA(t);case"Sig":return new _A(t)}return new rr(t);case Pt.POPUP:return new gg(t);case Pt.FREETEXT:return new $b(t);case Pt.LINE:return new PA(t);case Pt.SQUARE:return new RA(t);case Pt.CIRCLE:return new LA(t);case Pt.POLYLINE:return new Ub(t);case Pt.CARET:return new IA(t);case Pt.INK:return new cm(t);case Pt.POLYGON:return new DA(t);case Pt.HIGHLIGHT:return new Gb(t);case Pt.UNDERLINE:return new MA(t);case Pt.SQUIGGLY:return new FA(t);case Pt.STRIKEOUT:return new NA(t);case Pt.STAMP:return new Vb(t);case Pt.FILEATTACHMENT:return new OA(t);default:return new It(t)}}}var Aa,ho,uo,Jc,fg;const mm=class mm{constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){f(this,Jc);f(this,Aa,null);f(this,ho,!1);f(this,uo,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t!=null&&t.str||e!=null&&e.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return mm._hasPopupData(this.data)}updateEdited(t){var i;if(!this.container)return;a(this,Aa)||g(this,Aa,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&v(this,Jc,fg).call(this,e),(i=a(this,uo))==null||i.popup.updateEdited(t)}resetEdited(){var t;a(this,Aa)&&(v(this,Jc,fg).call(this,a(this,Aa).rect),(t=a(this,uo))==null||t.popup.resetEdited(),g(this,Aa,null))}_createContainer(t){const{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof rr||(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof gg){const{rotation:b}=e;return!e.hasOwnCanvas&&b!==0&&this.setRotation(b,n),n}const{width:o,height:c}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const b=e.borderStyle.horizontalCornerRadius,x=e.borderStyle.verticalCornerRadius;if(b>0||x>0){const E=`calc(${b}px * var(--total-scale-factor)) / calc(${x}px * var(--total-scale-factor))`;r.borderRadius=E}else if(this instanceof Ob){const E=`calc(${o}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;r.borderRadius=E}switch(e.borderStyle.style){case cr.SOLID:r.borderStyle="solid";break;case cr.DASHED:r.borderStyle="dashed";break;case cr.BEVELED:W("Unimplemented border style: beveled");break;case cr.INSET:W("Unimplemented border style: inset");break;case cr.UNDERLINE:r.borderBottomStyle="solid";break}const w=e.borderColor||null;w?(g(this,ho,!0),r.borderColor=$.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):r.borderWidth=0}const h=$.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:u,pageX:p,pageY:m}=s.rawDims;r.left=`${100*(h[0]-p)/d}%`,r.top=`${100*(h[1]-m)/u}%`;const{rotation:y}=e;return e.hasOwnCanvas||y===0?(r.width=`${100*o/d}%`,r.height=`${100*c/u}%`):this.setRotation(y,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/i}%`,e.style.height=`${100*r/s}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,i,s)=>{const n=s.detail[e],r=n[0],o=n.slice(1);s.target.style[i]=qm[`${r}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:qm[`${r}_rgb`](o)})};return J(this,"_commonActions",{display:e=>{const{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){const i=this._commonActions;for(const s of Object.keys(e.detail)){const n=t[s]||i[s];n==null||n(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const i=this._commonActions;for(const[s,n]of Object.entries(e)){const r=i[s];if(r){const o={detail:{[s]:n},target:t};r(o),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,i,s,n]=this.data.rect.map(b=>Math.fround(b));if(t.length===8){const[b,x,w,E]=t.subarray(2,6);if(s===b&&n===x&&e===w&&i===E)return}const{style:r}=this.container;let o;if(a(this,ho)){const{borderColor:b,borderWidth:x}=r;r.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const c=s-e,h=n-i,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=d.createElement("defs");u.append(p);const m=d.createElement("clipPath"),y=`clippath_${this.data.id}`;m.setAttribute("id",y),m.setAttribute("clipPathUnits","objectBoundingBox"),p.append(m);for(let b=2,x=t.length;b<x;b+=8){const w=t[b],E=t[b+1],A=t[b+2],_=t[b+3],S=d.createElement("rect"),T=(A-e)/c,C=(n-E)/h,P=(w-A)/c,k=(E-_)/h;S.setAttribute("x",T),S.setAttribute("y",C),S.setAttribute("width",P),S.setAttribute("height",k),m.append(S),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${C}" width="${P}" height="${k}"/>`)}a(this,ho)&&(o.push("</g></svg>')"),r.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${y})`}_createPopup(){const{data:t}=this,e=g(this,uo,new gg({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){lt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[t];if(s)for(const{page:n,id:r,exportValues:o}of s){if(n===-1||r===e)continue;const c=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${r}"]`);if(h&&!ir.has(h)){W(`_getElementsByName - element not allowed: ${r}`);continue}i.push({id:r,exportValue:c,domElement:h})}return i}for(const s of document.getElementsByName(t)){const{exportValue:n}=s,r=s.getAttribute("data-element-id");r!==e&&ir.has(s)&&i.push({id:r,exportValue:n,domElement:s})}return i}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var i;(i=this.linkService.eventBus)==null||i.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Aa=new WeakMap,ho=new WeakMap,uo=new WeakMap,Jc=new WeakSet,fg=function(t){const{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:c}}}}=this;i==null||i.splice(0,4,...t),e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(r-t[3]+c)/r}%`,s===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(s)};let It=mm;var gs,Tn,ep,Fb,ip,Nb;class Mb extends It{constructor(e,i=null){super(e,{isRenderable:!0,ignoreBorder:!!(i!=null&&i.ignoreBorder),createQuadrilaterals:!0});f(this,gs);f(this,ep);f(this,ip);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:i}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let n=!1;return e.url?(i.addLinkAttributes(s,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(s,e.action),n=!0):e.attachment?(v(this,ep,Fb).call(this,s,e.attachment,e.attachmentDest),n=!0):e.setOCGState?(v(this,ip,Nb).call(this,s,e.setOCGState),n=!0):e.dest?(this._bindLink(s,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),n=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(s),this.container}_bindLink(e,i){e.href=this.linkService.getDestinationHash(i),e.onclick=()=>(i&&this.linkService.goToDestination(i),!1),(i||i==="")&&v(this,gs,Tn).call(this)}_bindNamedAction(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(i),!1),v(this,gs,Tn).call(this)}_bindJSAction(e,i){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(i.actions)){const r=s.get(n);r&&(e[r]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i.id,name:n}}),!1})}e.onclick||(e.onclick=()=>!1),v(this,gs,Tn).call(this)}_bindResetFormAction(e,i){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),v(this,gs,Tn).call(this),!this._fieldObjects){W('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{var u;s==null||s();const{fields:n,refs:r,include:o}=i,c=[];if(n.length!==0||r.length!==0){const p=new Set(r);for(const m of n){const y=this._fieldObjects[m]||[];for(const{id:b}of y)p.add(b)}for(const m of Object.values(this._fieldObjects))for(const y of m)p.has(y.id)===o&&c.push(y)}else for(const p of Object.values(this._fieldObjects))c.push(...p);const h=this.annotationStorage,d=[];for(const p of c){const{id:m}=p;switch(d.push(m),p.type){case"text":{const b=p.defaultValue||"";h.setValue(m,{value:b});break}case"checkbox":case"radiobutton":{const b=p.defaultValue===p.exportValues;h.setValue(m,{value:b});break}case"combobox":case"listbox":{const b=p.defaultValue||"";h.setValue(m,{value:b});break}default:continue}const y=document.querySelector(`[data-element-id="${m}"]`);if(y){if(!ir.has(y)){W(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}gs=new WeakSet,Tn=function(){this.container.setAttribute("data-internal-link","")},ep=new WeakSet,Fb=function(e,i,s=null){e.href=this.linkService.getAnchorUrl(""),i.description&&(e.title=i.description),e.onclick=()=>{var n;return(n=this.downloadManager)==null||n.openOrDownloadData(i.content,i.filename,s),!1},v(this,gs,Tn).call(this)},ip=new WeakSet,Nb=function(e,i){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(i),!1),v(this,gs,Tn).call(this)};class AA extends It{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class rr extends It{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Yt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,r=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(i,r=>{var o;if(i==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(r)}}))})}_setEventListeners(t,e,i,s){var n,r,o;for(const[c,h]of i)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,c,h,s),h==="Focus"&&!((r=this.data.actions)!=null&&r.Blur)?this._setEventListener(t,e,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":$.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||wA,n=t.style;let r;const o=2,c=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(h/(wf*s))||1,u=h/d;r=Math.min(s,c(u/wf))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);r=Math.min(s,c(h/wf))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=$.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class EA extends rr{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=i),n.setValue(r.id,{[s]:i})}render(){var s,n;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const r=t.getValue(e,{value:this.data.fieldValue});let o=r.value||"";const c=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let h=r.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=h??o,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",h??o),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),ir.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const u=this.data.dateFormat||this.data.timeFormat;u&&(i.title=u),this._setRequired(i,this.data.required),c&&(i.maxLength=c),i.addEventListener("input",m=>{t.setValue(e,{value:m.target.value}),this.setPropertyOnSiblings(i,"value",m.target.value,"value"),d.formattedValue=null}),i.addEventListener("resetform",m=>{const y=this.data.defaultFieldValue??"";i.value=d.userValue=y,d.formattedValue=null});let p=m=>{const{formattedValue:y}=d;y!=null&&(m.target.value=y),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",y=>{var x;if(d.focused)return;const{target:b}=y;d.userValue&&(b.value=d.userValue),d.lastCommittedValue=b.value,d.commitKey=1,(x=this.data.actions)!=null&&x.Focus||(d.focused=!0)}),i.addEventListener("updatefromsandbox",y=>{this.showElementAndHideCanvas(y.target);const b={value(x){d.userValue=x.detail.value??"",t.setValue(e,{value:d.userValue.toString()}),x.target.value=d.userValue},formattedValue(x){const{formattedValue:w}=x.detail;d.formattedValue=w,w!=null&&x.target!==document.activeElement&&(x.target.value=w),t.setValue(e,{formattedValue:w})},selRange(x){x.target.setSelectionRange(...x.detail.selRange)},charLimit:x=>{var _;const{charLimit:w}=x.detail,{target:E}=x;if(w===0){E.removeAttribute("maxLength");return}E.setAttribute("maxLength",w);let A=d.userValue;!A||A.length<=w||(A=A.slice(0,w),E.value=d.userValue=A,t.setValue(e,{value:A}),(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:E.selectionStart,selEnd:E.selectionEnd}}))}};this._dispatchEventFromSandbox(b,y)}),i.addEventListener("keydown",y=>{var w;d.commitKey=1;let b=-1;if(y.key==="Escape"?b=0:y.key==="Enter"&&!this.data.multiLine?b=2:y.key==="Tab"&&(d.commitKey=3),b===-1)return;const{value:x}=y.target;d.lastCommittedValue!==x&&(d.lastCommittedValue=x,d.userValue=x,(w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:x,willCommit:!0,commitKey:b,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}}))});const m=p;p=null,i.addEventListener("blur",y=>{var x,w;if(!d.focused||!y.relatedTarget)return;(x=this.data.actions)!=null&&x.Blur||(d.focused=!1);const{value:b}=y.target;d.userValue=b,d.lastCommittedValue!==b&&((w=this.linkService.eventBus)==null||w.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:d.commitKey,selStart:y.target.selectionStart,selEnd:y.target.selectionEnd}})),m(y)}),(n=this.data.actions)!=null&&n.Keystroke&&i.addEventListener("beforeinput",y=>{var T;d.lastCommittedValue=null;const{data:b,target:x}=y,{value:w,selectionStart:E,selectionEnd:A}=x;let _=E,S=A;switch(y.inputType){case"deleteWordBackward":{const C=w.substring(0,E).match(/\w*[^\w]*$/);C&&(_-=C[0].length);break}case"deleteWordForward":{const C=w.substring(E).match(/^[^\w]*\w*/);C&&(S+=C[0].length);break}case"deleteContentBackward":E===A&&(_-=1);break;case"deleteContentForward":E===A&&(S+=1);break}y.preventDefault(),(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:w,change:b||"",willCommit:!1,selStart:_,selEnd:S}})}),this._setEventListeners(i,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],y=>y.target.value)}if(p&&i.addEventListener("blur",p),this.data.comb){const y=(this.data.rect[2]-this.data.rect[0])/c;i.classList.add("comb"),i.style.letterSpacing=`calc(${y}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class _A extends rr{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class SA extends rr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return ir.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:o,checked:c}=r.target;for(const h of this._getElementsByName(o,i)){const d=c&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=d),t.setValue(h.id,{value:d})}t.setValue(i,{value:c})}),n.addEventListener("resetform",r=>{const o=e.defaultFieldValue||"Off";r.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const o={value(c){c.target.checked=c.detail.value!=="Off",t.setValue(i,{value:c.target.checked})}};this._dispatchEventFromSandbox(o,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Ob extends rr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,i=e.id;let s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(const r of this._getElementsByName(e.fieldName,i))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(ir.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:o,checked:c}=r.target;for(const h of this._getElementsByName(o,i))t.setValue(h.id,{value:!1});t.setValue(i,{value:c})}),n.addEventListener("resetform",r=>{const o=e.defaultFieldValue;r.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{const c={value:h=>{const d=r===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const p=d&&u.id===i;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class CA extends Mb{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}}class TA extends rr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");ir.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const p of s.options)p.selected=p.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,i.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),n=!1),s.append(u)}let r=null;if(n){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),r=()=>{d.remove(),s.removeEventListener("input",r),r=null},s.addEventListener("input",r)}const o=d=>{const u=d?"value":"textContent",{options:p,multiple:m}=s;return m?Array.prototype.filter.call(p,y=>y.selected).map(y=>y[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let c=o(!1);const h=d=>{const u=d.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{const u={value(p){r==null||r();const m=p.detail.value,y=new Set(Array.isArray(m)?m:[m]);for(const b of s.options)b.selected=y.has(b.value);t.setValue(e,{value:o(!0)}),c=o(!1)},multipleSelection(p){s.multiple=!0},remove(p){const m=s.options,y=p.detail.remove;m[y].selected=!1,s.remove(y),m.length>0&&Array.prototype.findIndex.call(m,x=>x.selected)===-1&&(m[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),c=o(!1)},clear(p){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),c=o(!1)},insert(p){const{index:m,displayValue:y,exportValue:b}=p.detail.insert,x=s.children[m],w=document.createElement("option");w.textContent=y,w.value=b,x?x.before(w):s.append(w),t.setValue(e,{value:o(!0),items:h(p)}),c=o(!1)},items(p){const{items:m}=p.detail;for(;s.length!==0;)s.remove(0);for(const y of m){const{displayValue:b,exportValue:x}=y,w=document.createElement("option");w.textContent=b,w.value=x,s.append(w)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),c=o(!1)},indices(p){const m=new Set(p.detail.indices);for(const y of p.target.options)y.selected=m.has(y.index);t.setValue(e,{value:o(!0)}),c=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,d)}),s.addEventListener("input",d=>{var m;const u=o(!0),p=o(!1);t.setValue(e,{value:u}),d.preventDefault(),(m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:c,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class gg extends It{constructor(t){const{data:e,elements:i}=t;super(t,{isRenderable:It._hasPopupData(e)}),this.elements=i,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new kA({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),i=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",i.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(s=>`${tm}${s}`).join(",")),this.container}}var po,sp,np,fo,go,Ct,ms,Ea,Qc,Zc,mo,vs,ui,bs,th,ys,eh,_a,Sa,vo,Dd,ih,mg,ap,jb,rp,Bb,op,zb,lp,Hb,bo,Id,yo,Md,sh,vg;class kA{constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:r,richText:o,parent:c,rect:h,parentRect:d,open:u}){f(this,vo);f(this,ih);f(this,ap);f(this,rp);f(this,op);f(this,lp);f(this,bo);f(this,yo);f(this,sh);f(this,po,v(this,op,zb).bind(this));f(this,sp,v(this,sh,vg).bind(this));f(this,np,v(this,yo,Md).bind(this));f(this,fo,v(this,bo,Id).bind(this));f(this,go,null);f(this,Ct,null);f(this,ms,null);f(this,Ea,null);f(this,Qc,null);f(this,Zc,null);f(this,mo,null);f(this,vs,!1);f(this,ui,null);f(this,bs,null);f(this,th,null);f(this,ys,null);f(this,eh,null);f(this,_a,null);f(this,Sa,!1);var p;g(this,Ct,t),g(this,eh,s),g(this,ms,r),g(this,ys,o),g(this,Zc,c),g(this,go,e),g(this,th,h),g(this,mo,d),g(this,Qc,i),g(this,Ea,ef.toDateObject(n)),this.trigger=i.flatMap(m=>m.getElementsToTriggerPopup());for(const m of this.trigger)m.addEventListener("click",a(this,fo)),m.addEventListener("mouseenter",a(this,np)),m.addEventListener("mouseleave",a(this,sp)),m.classList.add("popupTriggerArea");for(const m of i)(p=m.container)==null||p.addEventListener("keydown",a(this,po));a(this,Ct).hidden=!0,u&&v(this,bo,Id).call(this)}render(){if(a(this,ui))return;const t=g(this,ui,document.createElement("div"));if(t.className="popup",a(this,go)){const n=t.style.outlineColor=$.makeHexColor(...a(this,go));t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");e.className="header";const i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=a(this,eh),t.append(e),a(this,Ea)){const n=document.createElement("time");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Ea).valueOf()})),n.dateTime=a(this,Ea).toISOString(),e.append(n)}const s=a(this,vo,Dd);if(s)lm.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(a(this,ms));t.append(n)}a(this,Ct).append(t)}_formatContents({str:t,dir:e}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;const s=t.split(/(?:\r\n?|\n)/);for(let n=0,r=s.length;n<r;++n){const o=s[n];i.append(document.createTextNode(o)),n<r-1&&i.append(document.createElement("br"))}return i}updateEdited({rect:t,popupContent:e}){var i;a(this,_a)||g(this,_a,{contentsObj:a(this,ms),richText:a(this,ys)}),t&&g(this,bs,null),e&&(g(this,ys,v(this,rp,Bb).call(this,e)),g(this,ms,null)),(i=a(this,ui))==null||i.remove(),g(this,ui,null)}resetEdited(){var t;a(this,_a)&&({contentsObj:fe(this,ms)._,richText:fe(this,ys)._}=a(this,_a),g(this,_a,null),(t=a(this,ui))==null||t.remove(),g(this,ui,null),g(this,bs,null))}forceHide(){g(this,Sa,this.isVisible),a(this,Sa)&&(a(this,Ct).hidden=!0)}maybeShow(){a(this,Sa)&&(a(this,ui)||v(this,yo,Md).call(this),g(this,Sa,!1),a(this,Ct).hidden=!1)}get isVisible(){return a(this,Ct).hidden===!1}}po=new WeakMap,sp=new WeakMap,np=new WeakMap,fo=new WeakMap,go=new WeakMap,Ct=new WeakMap,ms=new WeakMap,Ea=new WeakMap,Qc=new WeakMap,Zc=new WeakMap,mo=new WeakMap,vs=new WeakMap,ui=new WeakMap,bs=new WeakMap,th=new WeakMap,ys=new WeakMap,eh=new WeakMap,_a=new WeakMap,Sa=new WeakMap,vo=new WeakSet,Dd=function(){const t=a(this,ys),e=a(this,ms);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&a(this,ys).html||null},ih=new WeakSet,mg=function(){var t,e,i;return((i=(e=(t=a(this,vo,Dd))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.fontSize)||0},ap=new WeakSet,jb=function(){var t,e,i;return((i=(e=(t=a(this,vo,Dd))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:i.color)||null},rp=new WeakSet,Bb=function(t){const e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:a(this,ap,jb),fontSize:a(this,ih,mg)?`calc(${a(this,ih,mg)}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i},op=new WeakSet,zb=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&a(this,vs))&&v(this,bo,Id).call(this)},lp=new WeakSet,Hb=function(){if(a(this,bs)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=a(this,Zc);let r=!!a(this,mo),o=r?a(this,mo):a(this,th);for(const y of a(this,Qc))if(!o||$.intersect(y.data.rect,o)!==null){o=y.data.rect,r=!0;break}const c=$.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),h=5,d=r?o[2]-o[0]+h:0,u=c[0]+d,p=c[1];g(this,bs,[100*(u-s)/e,100*(p-n)/i]);const{style:m}=a(this,Ct);m.left=`${a(this,bs)[0]}%`,m.top=`${a(this,bs)[1]}%`},bo=new WeakSet,Id=function(){g(this,vs,!a(this,vs)),a(this,vs)?(v(this,yo,Md).call(this),a(this,Ct).addEventListener("click",a(this,fo)),a(this,Ct).addEventListener("keydown",a(this,po))):(v(this,sh,vg).call(this),a(this,Ct).removeEventListener("click",a(this,fo)),a(this,Ct).removeEventListener("keydown",a(this,po)))},yo=new WeakSet,Md=function(){a(this,ui)||this.render(),this.isVisible?a(this,vs)&&a(this,Ct).classList.add("focused"):(v(this,lp,Hb).call(this),a(this,Ct).hidden=!1,a(this,Ct).style.zIndex=parseInt(a(this,Ct).style.zIndex)+1e3)},sh=new WeakSet,vg=function(){a(this,Ct).classList.remove("focused"),!(a(this,vs)||!this.isVisible)&&(a(this,Ct).hidden=!0,a(this,Ct).style.zIndex=parseInt(a(this,Ct).style.zIndex)-1e3)};class $b extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=V.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var nh;class PA extends It{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});f(this,nh,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=g(this,nh,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,nh)}addHighlightArea(){this.container.classList.add("highlightArea")}}nh=new WeakMap;var ah;class RA extends It{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});f(this,ah,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=e.borderStyle.width,o=g(this,ah,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",i-r),o.setAttribute("height",s-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,ah)}addHighlightArea(){this.container.classList.add("highlightArea")}}ah=new WeakMap;var rh;class LA extends It{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});f(this,rh,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:i,height:s}=this,n=this.svgFactory.create(i,s,!0),r=e.borderStyle.width,o=g(this,rh,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",i/2),o.setAttribute("cy",s/2),o.setAttribute("rx",i/2-r/2),o.setAttribute("ry",s/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,rh)}addHighlightArea(){this.container.classList.add("highlightArea")}}rh=new WeakMap;var oh;class Ub extends It{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});f(this,oh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:i,borderStyle:s,popupRef:n},width:r,height:o}=this;if(!i)return this.container;const c=this.svgFactory.create(r,o,!0);let h=[];for(let u=0,p=i.length;u<p;u+=2){const m=i[u]-e[0],y=e[3]-i[u+1];h.push(`${m},${y}`)}h=h.join(" ");const d=g(this,oh,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",h),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),c.append(d),this.container.append(c),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return a(this,oh)}addHighlightArea(){this.container.classList.add("highlightArea")}}oh=new WeakMap;class DA extends Ub{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class IA extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var lh,Ca,ch,bg;class cm extends It{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});f(this,ch);f(this,lh,null);f(this,Ca,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?V.HIGHLIGHT:V.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:i,inkLists:s,borderStyle:n,popupRef:r}}=this,{transform:o,width:c,height:h}=v(this,ch,bg).call(this,i,e),d=this.svgFactory.create(c,h,!0),u=g(this,lh,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let p=0,m=s.length;p<m;p++){const y=this.svgFactory.createElement(this.svgElementName);a(this,Ca).push(y),y.setAttribute("points",s[p].join(",")),u.append(y)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:i,points:s,rect:n}=e,r=a(this,lh);if(i>=0&&r.setAttribute("stroke-width",i||1),s)for(let o=0,c=a(this,Ca).length;o<c;o++)a(this,Ca)[o].setAttribute("points",s[o].join(","));if(n){const{transform:o,width:c,height:h}=v(this,ch,bg).call(this,this.data.rotation,n);r.parentElement.setAttribute("viewBox",`0 0 ${c} ${h}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return a(this,Ca)}addHighlightArea(){this.container.classList.add("highlightArea")}}lh=new WeakMap,Ca=new WeakMap,ch=new WeakSet,bg=function(e,i){switch(e){case 90:return{transform:`rotate(90) translate(${-i[0]},${i[1]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};case 180:return{transform:`rotate(180) translate(${-i[2]},${i[1]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]};case 270:return{transform:`rotate(270) translate(${-i[2]},${i[3]}) scale(1,-1)`,width:i[3]-i[1],height:i[2]-i[0]};default:return{transform:`translate(${-i[0]},${i[3]}) scale(1,-1)`,width:i[2]-i[0],height:i[3]-i[1]}}};class Gb extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=V.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class MA extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class FA extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class NA extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=t,this.container.append(i)}return this.container}}class Vb extends It{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=V.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var hh,dh,yg;class OA extends It{constructor(e){var s;super(e,{isRenderable:!0});f(this,dh);f(this,hh,null);const{file:i}=this.data;this.filename=i.filename,this.content=i.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...i})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:i}=this;let s;i.hasAppearance||i.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(i.name)?"paperclip":"pushpin"}.svg`,i.fillAlpha&&i.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(i.fillAlpha*100)}%);`)),s.addEventListener("dblclick",v(this,dh,yg).bind(this)),g(this,hh,s);const{isMac:n}=Yt.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(n?r.metaKey:r.ctrlKey)&&v(this,dh,yg).call(this)}),!i.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return a(this,hh)}addHighlightArea(){this.container.classList.add("highlightArea")}}hh=new WeakMap,dh=new WeakSet,yg=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var uh,Ta,on,ph,fh,xg,gh,wg,mh;let hm=(mh=class{constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:r,structTreeLayer:o}){f(this,fh);f(this,gh);f(this,uh,null);f(this,Ta,null);f(this,on,new Map);f(this,ph,null);this.div=t,g(this,uh,e),g(this,Ta,i),g(this,ph,o||null),this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return a(this,on).size>0}async render(t){var r;const{annotations:e}=t,i=this.div;_n(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Nl,annotationStorage:t.annotationStorage||new im,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const c=o.annotationType===Pt.POPUP;if(c){const u=s.get(o.id);if(!u)continue;n.elements=u}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const h=Xm.create(n);if(!h.isRenderable)continue;if(!c&&o.popupRef){const u=s.get(o.popupRef);u?u.push(h):s.set(o.popupRef,[h])}const d=h.render();o.hidden&&(d.style.visibility="hidden"),await v(this,fh,xg).call(this,d,o.id,n.elements),h._isEditable&&(a(this,on).set(h.data.id,h),(r=this._annotationEditorUIManager)==null||r.renderAnnotationElement(h))}v(this,gh,wg).call(this)}async addLinkAnnotations(t,e){const i={data:null,layer:this.div,linkService:e,svgFactory:new Nl,parent:this};for(const s of t){s.borderStyle||(s.borderStyle=mh._defaultBorderStyle),i.data=s;const n=Xm.create(i);if(!n.isRenderable)continue;const r=n.render();await v(this,fh,xg).call(this,r,s.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,_n(e,{rotation:t.rotation}),v(this,gh,wg).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(a(this,on).values())}getEditableAnnotation(t){return a(this,on).get(t)}static get _defaultBorderStyle(){return J(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:cr.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},uh=new WeakMap,Ta=new WeakMap,on=new WeakMap,ph=new WeakMap,fh=new WeakSet,xg=async function(t,e,i){var o,c;const s=t.firstChild||t,n=s.id=`${tm}${e}`,r=await((o=a(this,ph))==null?void 0:o.getAriaAttributes(n));if(r)for(const[h,d]of r)s.setAttribute(h,d);i?i.at(-1).container.after(t):(this.div.append(t),(c=a(this,uh))==null||c.moveElementInDOM(this.div,t,s,!1))},gh=new WeakSet,wg=function(){var e;if(!a(this,Ta))return;const t=this.div;for(const[i,s]of a(this,Ta)){const n=t.querySelector(`[data-annotation-id="${i}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:r}=n;r?r.nodeName==="CANVAS"?r.replaceWith(s):r.classList.contains("annotationContent")?r.after(s):r.before(s):n.append(s);const o=a(this,on).get(i);o&&(o._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(i,n.id,s),o._hasNoCanvas=!1):o.canvas=s)}a(this,Ta).clear()},mh);const vd=/\r\n?|\n/g;var pi,Oe,vh,ka,je,cp,Wb,hp,qb,dp,Xb,xo,Fd,wo,Nd,Ao,Od,up,Yb,bh,Eg,pp,Kb;const ut=class ut extends gt{constructor(e){super({...e,name:"freeTextEditor"});f(this,cp);f(this,hp);f(this,dp);f(this,xo);f(this,Ao);f(this,up);f(this,pp);f(this,pi,void 0);f(this,Oe,"");f(this,vh,`${this.id}-editor`);f(this,ka,null);f(this,je,void 0);g(this,pi,e.color||ut._defaultColor||gt._defaultLineColor),g(this,je,e.fontSize||ut._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const e=ut.prototype,i=r=>r.isEmpty(),s=Sn.TRANSLATE_SMALL,n=Sn.TRANSLATE_BIG;return J(this,"_keyboardManager",new rd([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:i}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:i}]]))}static initialize(e,i){gt.initialize(e,i);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,i){switch(e){case Q.FREETEXT_SIZE:ut._defaultFontSize=i;break;case Q.FREETEXT_COLOR:ut._defaultColor=i;break}}updateParams(e,i){switch(e){case Q.FREETEXT_SIZE:v(this,cp,Wb).call(this,i);break;case Q.FREETEXT_COLOR:v(this,hp,qb).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Q.FREETEXT_SIZE,ut._defaultFontSize],[Q.FREETEXT_COLOR,ut._defaultColor||gt._defaultLineColor]]}get propertiesToUpdate(){return[[Q.FREETEXT_SIZE,a(this,je)],[Q.FREETEXT_COLOR,a(this,pi)]]}_translateEmpty(e,i){this._uiManager.translateSelectedEditors(e,i,!0)}getInitialTranslation(){const e=this.parentScale;return[-ut._internalPadding*e,-(ut._internalPadding+a(this,je))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,ka,new AbortController);const e=this._uiManager.combinedSignal(a(this,ka));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){var e;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,vh)),this._isDraggable=!0,(e=a(this,ka))==null||e.abort(),g(this,ka,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var i;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(i=this._initialOptions)!=null&&i.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=a(this,Oe),i=g(this,Oe,v(this,dp,Xb).call(this).trimEnd());if(e===i)return;const s=n=>{if(g(this,Oe,n),!n){this.remove();return}v(this,Ao,Od).call(this),this._uiManager.rebuild(this),v(this,xo,Fd).call(this)};this.addCommands({cmd:()=>{s(i)},undo:()=>{s(e)},mustExec:!1}),v(this,xo,Fd).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ut._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,i;(this._isCopy||this.annotationElementId)&&(e=this.x,i=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,vh)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${a(this,je)}px * var(--total-scale-factor))`,s.color=a(this,pi),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[c,h]=this.getInitialTranslation();[c,h]=this.pageTranslationToScreen(c,h);const[d,u]=this.pageDimensions,[p,m]=this.pageTranslation;let y,b;switch(this.rotation){case 0:y=e+(o[0]-p)/d,b=i+this.height-(o[1]-m)/u;break;case 90:y=e+(o[0]-p)/d,b=i-(o[1]-m)/u,[c,h]=[h,-c];break;case 180:y=e-this.width+(o[0]-p)/d,b=i-(o[1]-m)/u,[c,h]=[-c,-h];break;case 270:y=e+(o[0]-p-this.height*u)/d,b=i+(o[1]-m-this.width*d)/u,[c,h]=[-h,c];break}this.setAt(y*n,b*r,c,h)}else this._moveAfterPaste(e,i);v(this,Ao,Od).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var y,b,x;const i=e.clipboardData||window.clipboardData,{types:s}=i;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const n=v(y=ut,bh,Eg).call(y,i.getData("text")||"").replaceAll(vd,`
`);if(!n)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:c,startOffset:h}=o,d=[],u=[];if(c.nodeType===Node.TEXT_NODE){const w=c.parentElement;if(u.push(c.nodeValue.slice(h).replaceAll(vd,"")),w!==this.editorDiv){let E=d;for(const A of this.editorDiv.childNodes){if(A===w){E=u;continue}E.push(v(b=ut,wo,Nd).call(b,A))}}d.push(c.nodeValue.slice(0,h).replaceAll(vd,""))}else if(c===this.editorDiv){let w=d,E=0;for(const A of this.editorDiv.childNodes)E++===h&&(w=u),w.push(v(x=ut,wo,Nd).call(x,A))}g(this,Oe,`${d.join(`
`)}${n}${u.join(`
`)}`),v(this,Ao,Od).call(this);const p=new Range;let m=Math.sumPrecise(d.map(w=>w.length));for(const{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){const E=w.nodeValue.length;if(m<=E){p.setStart(w,m),p.setEnd(w,m);break}m-=E}r.removeAllRanges(),r.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(e,i,s){var o;let n=null;if(e instanceof $b){const{data:{defaultAppearanceData:{fontSize:c,fontColor:h},rect:d,rotation:u,id:p,popupRef:m},textContent:y,textPosition:b,parent:{page:{pageNumber:x}}}=e;if(!y||y.length===0)return null;n=e={annotationType:V.FREETEXT,color:Array.from(h),fontSize:c,value:y.join(`
`),position:b,pageIndex:x-1,rect:d.slice(0),rotation:u,annotationElementId:p,id:p,deleted:!1,popupRef:m}}const r=await super.deserialize(e,i,s);return g(r,je,e.fontSize),g(r,pi,$.makeHexColor(...e.color)),g(r,Oe,v(o=ut,bh,Eg).call(o,e.value)),r._initialData=n,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=ut._internalPadding*this.parentScale,s=this.getRect(i,i),n=gt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:a(this,pi)),r={annotationType:V.FREETEXT,color:n,fontSize:a(this,je),value:v(this,up,Yb).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(r.isCopy=!0,r):this.annotationElementId&&!v(this,pp,Kb).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(e){const i=super.renderAnnotationElement(e);if(this.deleted)return i;const{style:s}=i;s.fontSize=`calc(${a(this,je)}px * var(--total-scale-factor))`,s.color=a(this,pi),i.replaceChildren();for(const r of a(this,Oe).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),i.append(o)}const n=ut._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(n,n),popupContent:a(this,Oe)}),i}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};pi=new WeakMap,Oe=new WeakMap,vh=new WeakMap,ka=new WeakMap,je=new WeakMap,cp=new WeakSet,Wb=function(e){const i=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-a(this,je))*this.parentScale),g(this,je,n),v(this,xo,Fd).call(this)},s=a(this,je);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},hp=new WeakSet,qb=function(e){const i=n=>{g(this,pi,this.editorDiv.style.color=n)},s=a(this,pi);this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},dp=new WeakSet,Xb=function(){var s;const e=[];this.editorDiv.normalize();let i=null;for(const n of this.editorDiv.childNodes)(i==null?void 0:i.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(v(s=ut,wo,Nd).call(s,n)),i=n);return e.join(`
`)},xo=new WeakSet,Fd=function(){const[e,i]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:r}=this,o=r.style.display,c=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",n.div.append(this.div),s=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/i):(this.width=s.height/e,this.height=s.width/i),this.fixAndSetPosition()},wo=new WeakSet,Nd=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(vd,"")},Ao=new WeakSet,Od=function(){if(this.editorDiv.replaceChildren(),!!a(this,Oe))for(const e of a(this,Oe).split(`
`)){const i=document.createElement("div");i.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(i)}},up=new WeakSet,Yb=function(){return a(this,Oe).replaceAll(""," ")},bh=new WeakSet,Eg=function(e){return e.replaceAll(" ","")},pp=new WeakSet,Kb=function(e){const{value:i,fontSize:s,color:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==i||e.fontSize!==s||e.color.some((o,c)=>o!==n[c])||e.pageIndex!==r},f(ut,wo),f(ut,bh),I(ut,"_freeTextDefaultContent",""),I(ut,"_internalPadding",0),I(ut,"_defaultColor",null),I(ut,"_defaultFontSize",10),I(ut,"_type","freetext"),I(ut,"_editorType",V.FREETEXT);let Ag=ut;class B{toSVGPath(){lt("Abstract method `toSVGPath` must be implemented.")}get box(){lt("Abstract getter `box` must be implemented.")}serialize(t,e){lt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,i,s,n,r){r||(r=new Float32Array(t.length));for(let o=0,c=t.length;o<c;o+=2)r[o]=e+t[o]*s,r[o+1]=i+t[o+1]*n;return r}static _rescaleAndSwap(t,e,i,s,n,r){r||(r=new Float32Array(t.length));for(let o=0,c=t.length;o<c;o+=2)r[o]=e+t[o+1]*s,r[o+1]=i+t[o]*n;return r}static _translate(t,e,i,s){s||(s=new Float32Array(t.length));for(let n=0,r=t.length;n<r;n+=2)s[n]=e+t[n],s[n+1]=i+t[n+1];return s}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,i,s,n){switch(n){case 90:return[1-e/i,t/s];case 180:return[1-t/i,1-e/s];case 270:return[e/i,1-t/s];default:return[t/i,e/s]}}static _normalizePagePoint(t,e,i){switch(i){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,i,s,n,r){return[(t+5*i)/6,(e+5*s)/6,(5*i+n)/6,(5*s+r)/6,(i+n)/2,(s+r)/2]}}I(B,"PRECISION",1e-4);var Be,fi,Eo,_o,Oi,K,Pa,Ra,yh,xh,So,Co,ln,wh,fp,gp,La,El,mp,Jb,vp,Qb,bp,Zb,yp,ty,xp,ey,wp,iy;const Ji=class Ji{constructor({x:t,y:e},i,s,n,r,o=0){f(this,La);f(this,mp);f(this,vp);f(this,bp);f(this,yp);f(this,xp);f(this,wp);f(this,Be,void 0);f(this,fi,[]);f(this,Eo,void 0);f(this,_o,void 0);f(this,Oi,[]);f(this,K,new Float32Array(18));f(this,Pa,void 0);f(this,Ra,void 0);f(this,yh,void 0);f(this,xh,void 0);f(this,So,void 0);f(this,Co,void 0);f(this,ln,[]);g(this,Be,i),g(this,Co,n*s),g(this,_o,r),a(this,K).set([NaN,NaN,NaN,NaN,t,e],6),g(this,Eo,o),g(this,xh,a(Ji,wh)*s),g(this,yh,a(Ji,gp)*s),g(this,So,s),a(this,ln).push(t,e)}isEmpty(){return isNaN(a(this,K)[8])}add({x:t,y:e}){var k;g(this,Pa,t),g(this,Ra,e);const[i,s,n,r]=a(this,Be);let[o,c,h,d]=a(this,K).subarray(8,12);const u=t-h,p=e-d,m=Math.hypot(u,p);if(m<a(this,yh))return!1;const y=m-a(this,xh),b=y/m,x=b*u,w=b*p;let E=o,A=c;o=h,c=d,h+=x,d+=w,(k=a(this,ln))==null||k.push(t,e);const _=-w/y,S=x/y,T=_*a(this,Co),C=S*a(this,Co);return a(this,K).set(a(this,K).subarray(2,8),0),a(this,K).set([h+T,d+C],4),a(this,K).set(a(this,K).subarray(14,18),12),a(this,K).set([h-T,d-C],16),isNaN(a(this,K)[6])?(a(this,Oi).length===0&&(a(this,K).set([o+T,c+C],2),a(this,Oi).push(NaN,NaN,NaN,NaN,(o+T-i)/n,(c+C-s)/r),a(this,K).set([o-T,c-C],14),a(this,fi).push(NaN,NaN,NaN,NaN,(o-T-i)/n,(c-C-s)/r)),a(this,K).set([E,A,o,c,h,d],6),!this.isEmpty()):(a(this,K).set([E,A,o,c,h,d],6),Math.abs(Math.atan2(A-c,E-o)-Math.atan2(w,x))<Math.PI/2?([o,c,h,d]=a(this,K).subarray(2,6),a(this,Oi).push(NaN,NaN,NaN,NaN,((o+h)/2-i)/n,((c+d)/2-s)/r),[o,c,E,A]=a(this,K).subarray(14,18),a(this,fi).push(NaN,NaN,NaN,NaN,((E+o)/2-i)/n,((A+c)/2-s)/r),!0):([E,A,o,c,h,d]=a(this,K).subarray(0,6),a(this,Oi).push(((E+5*o)/6-i)/n,((A+5*c)/6-s)/r,((5*o+h)/6-i)/n,((5*c+d)/6-s)/r,((o+h)/2-i)/n,((c+d)/2-s)/r),[h,d,o,c,E,A]=a(this,K).subarray(12,18),a(this,fi).push(((E+5*o)/6-i)/n,((A+5*c)/6-s)/r,((5*o+h)/6-i)/n,((5*c+d)/6-s)/r,((o+h)/2-i)/n,((c+d)/2-s)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=a(this,Oi),e=a(this,fi);if(isNaN(a(this,K)[6])&&!this.isEmpty())return v(this,mp,Jb).call(this);const i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);v(this,bp,Zb).call(this,i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return v(this,vp,Qb).call(this,i),i.join(" ")}newFreeDrawOutline(t,e,i,s,n,r){return new sy(t,e,i,s,n,r)}getOutlines(){var u;const t=a(this,Oi),e=a(this,fi),i=a(this,K),[s,n,r,o]=a(this,Be),c=new Float32Array((((u=a(this,ln))==null?void 0:u.length)??0)+2);for(let p=0,m=c.length-2;p<m;p+=2)c[p]=(a(this,ln)[p]-s)/r,c[p+1]=(a(this,ln)[p+1]-n)/o;if(c[c.length-2]=(a(this,Pa)-s)/r,c[c.length-1]=(a(this,Ra)-n)/o,isNaN(i[6])&&!this.isEmpty())return v(this,yp,ty).call(this,c);const h=new Float32Array(a(this,Oi).length+24+a(this,fi).length);let d=t.length;for(let p=0;p<d;p+=2){if(isNaN(t[p])){h[p]=h[p+1]=NaN;continue}h[p]=t[p],h[p+1]=t[p+1]}d=v(this,wp,iy).call(this,h,d);for(let p=e.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(e[p+m])){h[d]=h[d+1]=NaN,d+=2;continue}h[d]=e[p+m],h[d+1]=e[p+m+1],d+=2}return v(this,xp,ey).call(this,h,d),this.newFreeDrawOutline(h,c,a(this,Be),a(this,So),a(this,Eo),a(this,_o))}};Be=new WeakMap,fi=new WeakMap,Eo=new WeakMap,_o=new WeakMap,Oi=new WeakMap,K=new WeakMap,Pa=new WeakMap,Ra=new WeakMap,yh=new WeakMap,xh=new WeakMap,So=new WeakMap,Co=new WeakMap,ln=new WeakMap,wh=new WeakMap,fp=new WeakMap,gp=new WeakMap,La=new WeakSet,El=function(){const t=a(this,K).subarray(4,6),e=a(this,K).subarray(16,18),[i,s,n,r]=a(this,Be);return[(a(this,Pa)+(t[0]-e[0])/2-i)/n,(a(this,Ra)+(t[1]-e[1])/2-s)/r,(a(this,Pa)+(e[0]-t[0])/2-i)/n,(a(this,Ra)+(e[1]-t[1])/2-s)/r]},mp=new WeakSet,Jb=function(){const[t,e,i,s]=a(this,Be),[n,r,o,c]=v(this,La,El).call(this);return`M${(a(this,K)[2]-t)/i} ${(a(this,K)[3]-e)/s} L${(a(this,K)[4]-t)/i} ${(a(this,K)[5]-e)/s} L${n} ${r} L${o} ${c} L${(a(this,K)[16]-t)/i} ${(a(this,K)[17]-e)/s} L${(a(this,K)[14]-t)/i} ${(a(this,K)[15]-e)/s} Z`},vp=new WeakSet,Qb=function(t){const e=a(this,fi);t.push(`L${e[4]} ${e[5]} Z`)},bp=new WeakSet,Zb=function(t){const[e,i,s,n]=a(this,Be),r=a(this,K).subarray(4,6),o=a(this,K).subarray(16,18),[c,h,d,u]=v(this,La,El).call(this);t.push(`L${(r[0]-e)/s} ${(r[1]-i)/n} L${c} ${h} L${d} ${u} L${(o[0]-e)/s} ${(o[1]-i)/n}`)},yp=new WeakSet,ty=function(t){const e=a(this,K),[i,s,n,r]=a(this,Be),[o,c,h,d]=v(this,La,El).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/r,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/r,NaN,NaN,NaN,NaN,o,c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/r,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/r],0),this.newFreeDrawOutline(u,t,a(this,Be),a(this,So),a(this,Eo),a(this,_o))},xp=new WeakSet,ey=function(t,e){const i=a(this,fi);return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6},wp=new WeakSet,iy=function(t,e){const i=a(this,K).subarray(4,6),s=a(this,K).subarray(16,18),[n,r,o,c]=a(this,Be),[h,d,u,p]=v(this,La,El).call(this);return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-r)/c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-r)/c],e),e+=24},f(Ji,wh,8),f(Ji,fp,2),f(Ji,gp,a(Ji,wh)+a(Ji,fp));let eu=Ji;var To,Da,xs,Ah,ze,Eh,Lt,Ap,ny;class sy extends B{constructor(e,i,s,n,r,o){super();f(this,Ap);f(this,To,void 0);f(this,Da,new Float32Array(4));f(this,xs,void 0);f(this,Ah,void 0);f(this,ze,void 0);f(this,Eh,void 0);f(this,Lt,void 0);g(this,Lt,e),g(this,ze,i),g(this,To,s),g(this,Eh,n),g(this,xs,r),g(this,Ah,o),this.lastPoint=[NaN,NaN],v(this,Ap,ny).call(this,o);const[c,h,d,u]=a(this,Da);for(let p=0,m=e.length;p<m;p+=2)e[p]=(e[p]-c)/d,e[p+1]=(e[p+1]-h)/u;for(let p=0,m=i.length;p<m;p+=2)i[p]=(i[p]-c)/d,i[p+1]=(i[p+1]-h)/u}toSVGPath(){const e=[`M${a(this,Lt)[4]} ${a(this,Lt)[5]}`];for(let i=6,s=a(this,Lt).length;i<s;i+=6){if(isNaN(a(this,Lt)[i])){e.push(`L${a(this,Lt)[i+4]} ${a(this,Lt)[i+5]}`);continue}e.push(`C${a(this,Lt)[i]} ${a(this,Lt)[i+1]} ${a(this,Lt)[i+2]} ${a(this,Lt)[i+3]} ${a(this,Lt)[i+4]} ${a(this,Lt)[i+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,i,s,n],r){const o=s-e,c=n-i;let h,d;switch(r){case 0:h=B._rescale(a(this,Lt),e,n,o,-c),d=B._rescale(a(this,ze),e,n,o,-c);break;case 90:h=B._rescaleAndSwap(a(this,Lt),e,i,o,c),d=B._rescaleAndSwap(a(this,ze),e,i,o,c);break;case 180:h=B._rescale(a(this,Lt),s,i,-o,c),d=B._rescale(a(this,ze),s,i,-o,c);break;case 270:h=B._rescaleAndSwap(a(this,Lt),s,n,-o,-c),d=B._rescaleAndSwap(a(this,ze),s,n,-o,-c);break}return{outline:Array.from(h),points:[Array.from(d)]}}get box(){return a(this,Da)}newOutliner(e,i,s,n,r,o=0){return new eu(e,i,s,n,r,o)}getNewOutline(e,i){const[s,n,r,o]=a(this,Da),[c,h,d,u]=a(this,To),p=r*d,m=o*u,y=s*d+c,b=n*u+h,x=this.newOutliner({x:a(this,ze)[0]*p+y,y:a(this,ze)[1]*m+b},a(this,To),a(this,Eh),e,a(this,Ah),i??a(this,xs));for(let w=2;w<a(this,ze).length;w+=2)x.add({x:a(this,ze)[w]*p+y,y:a(this,ze)[w+1]*m+b});return x.getOutlines()}}To=new WeakMap,Da=new WeakMap,xs=new WeakMap,Ah=new WeakMap,ze=new WeakMap,Eh=new WeakMap,Lt=new WeakMap,Ap=new WeakSet,ny=function(e){const i=a(this,Lt);let s=i[4],n=i[5];const r=[s,n,s,n];let o=s,c=n;const h=e?Math.max:Math.min;for(let u=6,p=i.length;u<p;u+=6){const m=i[u+4],y=i[u+5];if(isNaN(i[u]))$.pointBoundingBox(m,y,r),c<y?(o=m,c=y):c===y&&(o=h(o,m));else{const b=[1/0,1/0,-1/0,-1/0];$.bezierBoundingBox(s,n,...i.slice(u,u+6),b),$.rectBoundingBox(...b,r),c<b[3]?(o=b[2],c=b[3]):c===b[3]&&(o=h(o,b[2]))}s=m,n=y}const d=a(this,Da);d[0]=r[0]-a(this,xs),d[1]=r[1]-a(this,xs),d[2]=r[2]-r[0]+2*a(this,xs),d[3]=r[3]-r[1]+2*a(this,xs),this.lastPoint=[o,c]};var _h,Sh,cn,gi,Ep,ay,ko,jd,_p,ry,Sp,oy,Ch,Sg;class _g{constructor(t,e=0,i=0,s=!0){f(this,Ep);f(this,ko);f(this,_p);f(this,Sp);f(this,Ch);f(this,_h,void 0);f(this,Sh,void 0);f(this,cn,[]);f(this,gi,[]);const n=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:y,y:b,width:x,height:w}of t){const E=Math.floor((y-e)/o)*o,A=Math.ceil((y+x+e)/o)*o,_=Math.floor((b-e)/o)*o,S=Math.ceil((b+w+e)/o)*o,T=[E,_,S,!0],C=[A,_,S,!1];a(this,cn).push(T,C),$.rectBoundingBox(E,_,A,S,n)}const c=n[2]-n[0]+2*i,h=n[3]-n[1]+2*i,d=n[0]-i,u=n[1]-i,p=a(this,cn).at(s?-1:-2),m=[p[0],p[2]];for(const y of a(this,cn)){const[b,x,w]=y;y[0]=(b-d)/c,y[1]=(x-u)/h,y[2]=(w-u)/h}g(this,_h,new Float32Array([d,u,c,h])),g(this,Sh,m)}getOutlines(){a(this,cn).sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);const t=[];for(const e of a(this,cn))e[3]?(t.push(...v(this,Ch,Sg).call(this,e)),v(this,_p,ry).call(this,e)):(v(this,Sp,oy).call(this,e),t.push(...v(this,Ch,Sg).call(this,e)));return v(this,Ep,ay).call(this,t)}}_h=new WeakMap,Sh=new WeakMap,cn=new WeakMap,gi=new WeakMap,Ep=new WeakSet,ay=function(t){const e=[],i=new Set;for(const r of t){const[o,c,h]=r;e.push([o,c,r],[o,h,r])}e.sort((r,o)=>r[1]-o[1]||r[0]-o[0]);for(let r=0,o=e.length;r<o;r+=2){const c=e[r][2],h=e[r+1][2];c.push(h),h.push(c),i.add(c),i.add(h)}const s=[];let n;for(;i.size>0;){const r=i.values().next().value;let[o,c,h,d,u]=r;i.delete(r);let p=o,m=c;for(n=[o,h],s.push(n);;){let y;if(i.has(d))y=d;else if(i.has(u))y=u;else break;i.delete(y),[o,c,h,d,u]=y,p!==o&&(n.push(p,m,o,m===c?c:h),p=o),m=m===c?h:c}n.push(p,m)}return new jA(s,a(this,_h),a(this,Sh))},ko=new WeakSet,jd=function(t){const e=a(this,gi);let i=0,s=e.length-1;for(;i<=s;){const n=i+s>>1,r=e[n][0];if(r===t)return n;r<t?i=n+1:s=n-1}return s+1},_p=new WeakSet,ry=function([,t,e]){const i=v(this,ko,jd).call(this,t);a(this,gi).splice(i,0,[t,e])},Sp=new WeakSet,oy=function([,t,e]){const i=v(this,ko,jd).call(this,t);for(let s=i;s<a(this,gi).length;s++){const[n,r]=a(this,gi)[s];if(n!==t)break;if(n===t&&r===e){a(this,gi).splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,r]=a(this,gi)[s];if(n!==t)break;if(n===t&&r===e){a(this,gi).splice(s,1);return}}},Ch=new WeakSet,Sg=function(t){const[e,i,s]=t,n=[[e,i,s]],r=v(this,ko,jd).call(this,s);for(let o=0;o<r;o++){const[c,h]=a(this,gi)[o];for(let d=0,u=n.length;d<u;d++){const[,p,m]=n[d];if(!(h<=p||m<=c)){if(p>=c){if(m>h)n[d][1]=h;else{if(u===1)return[];n.splice(d,1),d--,u--}continue}n[d][2]=c,m>h&&n.push([e,h,m])}}}return n};var Th,Po;class jA extends B{constructor(e,i,s){super();f(this,Th,void 0);f(this,Po,void 0);g(this,Po,e),g(this,Th,i),this.lastPoint=s}toSVGPath(){const e=[];for(const i of a(this,Po)){let[s,n]=i;e.push(`M${s} ${n}`);for(let r=2;r<i.length;r+=2){const o=i[r],c=i[r+1];o===s?(e.push(`V${c}`),n=c):c===n&&(e.push(`H${o}`),s=o)}e.push("Z")}return e.join(" ")}serialize([e,i,s,n],r){const o=[],c=s-e,h=n-i;for(const d of a(this,Po)){const u=new Array(d.length);for(let p=0;p<d.length;p+=2)u[p]=e+d[p]*c,u[p+1]=n-d[p+1]*h;o.push(u)}return o}get box(){return a(this,Th)}get classNamesForOutlining(){return["highlightOutline"]}}Th=new WeakMap,Po=new WeakMap;class Cg extends eu{newFreeDrawOutline(t,e,i,s,n,r){return new BA(t,e,i,s,n,r)}}class BA extends sy{newOutliner(t,e,i,s,n,r=0){return new Cg(t,e,i,s,n,r)}}var He,Ia,Ro,zt,kh,Lo,ws,Ph,hn,mi,Do,Rh,Lh,Tg,Dh,kg,Ih,Pg,As,kn,Cp,ly,ji,Ms;const Se=class Se{constructor({editor:t=null,uiManager:e=null}){f(this,Lh);f(this,Dh);f(this,Ih);f(this,As);f(this,Cp);f(this,ji);f(this,He,null);f(this,Ia,null);f(this,Ro,void 0);f(this,zt,null);f(this,kh,!1);f(this,Lo,!1);f(this,ws,null);f(this,Ph,void 0);f(this,hn,null);f(this,mi,null);f(this,Do,void 0);var i,s;t?(g(this,Lo,!1),g(this,Do,Q.HIGHLIGHT_COLOR),g(this,ws,t)):(g(this,Lo,!0),g(this,Do,Q.HIGHLIGHT_DEFAULT_COLOR)),g(this,mi,(t==null?void 0:t._uiManager)||e),g(this,Ph,a(this,mi)._eventBus),g(this,Ro,((i=t==null?void 0:t.color)==null?void 0:i.toUpperCase())||((s=a(this,mi))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),a(Se,Rh)||g(Se,Rh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return J(this,"_keyboardManager",new rd([[["Escape","mac+Escape"],Se.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Se.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Se.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Se.prototype._moveToPrevious],[["Home","mac+Home"],Se.prototype._moveToBeginning],[["End","mac+End"],Se.prototype._moveToEnd]]))}renderButton(){const t=g(this,He,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",a(this,ws)&&(t.ariaControls=`${a(this,ws).id}_colorpicker_dropdown`);const e=a(this,mi)._signal;t.addEventListener("click",v(this,As,kn).bind(this),{signal:e}),t.addEventListener("keydown",v(this,Ih,Pg).bind(this),{signal:e});const i=g(this,Ia,document.createElement("span"));return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=a(this,Ro),t.append(i),t}renderMainDropdown(){const t=g(this,zt,v(this,Lh,Tg).call(this));return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}_colorSelectFromKeyboard(t){if(t.target===a(this,He)){v(this,As,kn).call(this,t);return}const e=t.target.getAttribute("data-color");e&&v(this,Dh,kg).call(this,e,t)}_moveToNext(t){var e,i;if(!a(this,ji,Ms)){v(this,As,kn).call(this,t);return}if(t.target===a(this,He)){(e=a(this,zt).firstChild)==null||e.focus();return}(i=t.target.nextSibling)==null||i.focus()}_moveToPrevious(t){var e,i;if(t.target===((e=a(this,zt))==null?void 0:e.firstChild)||t.target===a(this,He)){a(this,ji,Ms)&&this._hideDropdownFromKeyboard();return}a(this,ji,Ms)||v(this,As,kn).call(this,t),(i=t.target.previousSibling)==null||i.focus()}_moveToBeginning(t){var e;if(!a(this,ji,Ms)){v(this,As,kn).call(this,t);return}(e=a(this,zt).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!a(this,ji,Ms)){v(this,As,kn).call(this,t);return}(e=a(this,zt).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=a(this,zt))==null||t.classList.add("hidden"),a(this,He).ariaExpanded="false",(e=a(this,hn))==null||e.abort(),g(this,hn,null)}_hideDropdownFromKeyboard(){var t;if(!a(this,Lo)){if(!a(this,ji,Ms)){(t=a(this,ws))==null||t.unselect();return}this.hideDropdown(),a(this,He).focus({preventScroll:!0,focusVisible:a(this,kh)})}}updateColor(t){if(a(this,Ia)&&(a(this,Ia).style.backgroundColor=t),!a(this,zt))return;const e=a(this,mi).highlightColors.values();for(const i of a(this,zt).children)i.ariaSelected=e.next().value===t.toUpperCase()}destroy(){var t,e;(t=a(this,He))==null||t.remove(),g(this,He,null),g(this,Ia,null),(e=a(this,zt))==null||e.remove(),g(this,zt,null)}};He=new WeakMap,Ia=new WeakMap,Ro=new WeakMap,zt=new WeakMap,kh=new WeakMap,Lo=new WeakMap,ws=new WeakMap,Ph=new WeakMap,hn=new WeakMap,mi=new WeakMap,Do=new WeakMap,Rh=new WeakMap,Lh=new WeakSet,Tg=function(){const t=document.createElement("div"),e=a(this,mi)._signal;t.addEventListener("contextmenu",ai,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),a(this,ws)&&(t.id=`${a(this,ws).id}_colorpicker_dropdown`);for(const[i,s]of a(this,mi).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",a(Se,Rh)[i]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=s,n.ariaSelected=s===a(this,Ro),n.addEventListener("click",v(this,Dh,kg).bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",v(this,Ih,Pg).bind(this),{signal:e}),t},Dh=new WeakSet,kg=function(t,e){e.stopPropagation(),a(this,Ph).dispatch("switchannotationeditorparams",{source:this,type:a(this,Do),value:t})},Ih=new WeakSet,Pg=function(t){Se._keyboardManager.exec(this,t)},As=new WeakSet,kn=function(t){if(a(this,ji,Ms)){this.hideDropdown();return}if(g(this,kh,t.detail===0),a(this,hn)||(g(this,hn,new AbortController),window.addEventListener("pointerdown",v(this,Cp,ly).bind(this),{signal:a(this,mi).combinedSignal(a(this,hn))})),a(this,He).ariaExpanded="true",a(this,zt)){a(this,zt).classList.remove("hidden");return}const e=g(this,zt,v(this,Lh,Tg).call(this));a(this,He).append(e)},Cp=new WeakSet,ly=function(t){var e;(e=a(this,zt))!=null&&e.contains(t.target)||this.hideDropdown()},ji=new WeakSet,Ms=function(){return a(this,zt)&&!a(this,zt).classList.contains("hidden")},f(Se,Rh,null);let Ol=Se;var Io,Mh,Es,Ma,Fh,ke,Nh,Oh,Fa,ti,$e,ee,Mo,_s,he,Fo,ei,jh,Bh,Rg,No,Bd,Tp,cy,kp,hy,Pp,dy,zh,Lg,Ss,Pn,dn,fr,Rp,uy,Oo,zd,Na,_l,Lp,py,Dp,fy,Ip,gy,Mp,my,Fp,vy;const tt=class tt extends gt{constructor(e){super({...e,name:"highlightEditor"});f(this,Bh);f(this,No);f(this,Tp);f(this,kp);f(this,Pp);f(this,zh);f(this,Ss);f(this,Rp);f(this,Oo);f(this,Na);f(this,Lp);f(this,Dp);f(this,Fp);f(this,Io,null);f(this,Mh,0);f(this,Es,void 0);f(this,Ma,null);f(this,Fh,null);f(this,ke,null);f(this,Nh,null);f(this,Oh,0);f(this,Fa,null);f(this,ti,null);f(this,$e,null);f(this,ee,!1);f(this,Mo,null);f(this,_s,void 0);f(this,he,null);f(this,Fo,"");f(this,ei,void 0);f(this,jh,"");this.color=e.color||tt._defaultColor,g(this,ei,e.thickness||tt._defaultThickness),g(this,_s,e.opacity||tt._defaultOpacity),g(this,Es,e.boxes||null),g(this,jh,e.methodOfCreation||""),g(this,Fo,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(g(this,ee,!0),v(this,No,Bd).call(this,e),v(this,Ss,Pn).call(this)):a(this,Es)&&(g(this,Io,e.anchorNode),g(this,Mh,e.anchorOffset),g(this,Nh,e.focusNode),g(this,Oh,e.focusOffset),v(this,Bh,Rg).call(this),v(this,Ss,Pn).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const e=tt.prototype;return J(this,"_keyboardManager",new rd([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,ee)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:a(this,ei),methodOfCreation:a(this,jh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,i){var s;gt.initialize(e,i),tt._defaultColor||(tt._defaultColor=((s=i.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(e,i){switch(e){case Q.HIGHLIGHT_DEFAULT_COLOR:tt._defaultColor=i;break;case Q.HIGHLIGHT_THICKNESS:tt._defaultThickness=i;break}}translateInPage(e,i){}get toolbarPosition(){return a(this,Mo)}updateParams(e,i){switch(e){case Q.HIGHLIGHT_COLOR:v(this,Tp,cy).call(this,i);break;case Q.HIGHLIGHT_THICKNESS:v(this,kp,hy).call(this,i);break}}static get defaultPropertiesToUpdate(){return[[Q.HIGHLIGHT_DEFAULT_COLOR,tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,tt._defaultThickness]]}get propertiesToUpdate(){return[[Q.HIGHLIGHT_COLOR,this.color||tt._defaultColor],[Q.HIGHLIGHT_THICKNESS,a(this,ei)||tt._defaultThickness],[Q.HIGHLIGHT_FREE,a(this,ee)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",g(this,Fh,new Ol({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(v(this,Na,_l).call(this))}getBaseTranslation(){return[0,0]}getRect(e,i){return super.getRect(e,i,v(this,Na,_l).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){v(this,zh,Lg).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,Ss,Pn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?v(this,zh,Lg).call(this):e&&(v(this,Ss,Pn).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),i&&this.select()}rotate(e){var n,r,o;const{drawLayer:i}=this.parent;let s;a(this,ee)?(e=(e-this.rotation+360)%360,s=v(n=tt,dn,fr).call(n,a(this,ti).box,e)):s=v(r=tt,dn,fr).call(r,[this.x,this.y,this.width,this.height],e),i.updateProperties(a(this,$e),{bbox:s,root:{"data-main-rotation":e}}),i.updateProperties(a(this,he),{bbox:v(o=tt,dn,fr).call(o,a(this,ke).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();a(this,Fo)&&(e.setAttribute("aria-label",a(this,Fo)),e.setAttribute("role","mark")),a(this,ee)?e.classList.add("free"):this.div.addEventListener("keydown",v(this,Rp,uy).bind(this),{signal:this._uiManager._signal});const i=g(this,Fa,document.createElement("div"));e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",i.style.clipPath=a(this,Ma);const[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),Ov(this,a(this,Fa),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(a(this,he),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(a(this,he),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:v(this,Oo,zd).call(this,!0);break;case 1:case 3:v(this,Oo,zd).call(this,!1);break}}select(){var e;super.select(),a(this,he)&&((e=this.parent)==null||e.drawLayer.updateProperties(a(this,he),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),a(this,he)&&((e=this.parent)==null||e.drawLayer.updateProperties(a(this,he),{rootClass:{selected:!1}}),a(this,ee)||v(this,Oo,zd).call(this,!1))}get _mustFixPosition(){return!a(this,ee)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(a(this,$e),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(a(this,he),{rootClass:{hidden:!e}}))}static startHighlighting(e,i,{target:s,x:n,y:r}){const{x:o,y:c,width:h,height:d}=s.getBoundingClientRect(),u=new AbortController,p=e.combinedSignal(u),m=y=>{u.abort(),v(this,Mp,my).call(this,e,y)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",Dt,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",ai,{signal:p}),s.addEventListener("pointermove",v(this,Ip,gy).bind(this,e),{signal:p}),this._freeHighlight=new Cg({x:n,y:r},[o,c,h,d],e.scale,this._defaultThickness/2,i,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,i,s){var b,x,w,E;let n=null;if(e instanceof Gb){const{data:{quadPoints:A,rect:_,rotation:S,id:T,color:C,opacity:P,popupRef:k},parent:{page:{pageNumber:D}}}=e;n=e={annotationType:V.HIGHLIGHT,color:Array.from(C),opacity:P,quadPoints:A,boxes:null,pageIndex:D-1,rect:_.slice(0),rotation:S,annotationElementId:T,id:T,deleted:!1,popupRef:k}}else if(e instanceof cm){const{data:{inkLists:A,rect:_,rotation:S,id:T,color:C,borderStyle:{rawWidth:P},popupRef:k},parent:{page:{pageNumber:D}}}=e;n=e={annotationType:V.HIGHLIGHT,color:Array.from(C),thickness:P,inkLists:A,boxes:null,pageIndex:D-1,rect:_.slice(0),rotation:S,annotationElementId:T,id:T,deleted:!1,popupRef:k}}const{color:r,quadPoints:o,inkLists:c,opacity:h}=e,d=await super.deserialize(e,i,s);d.color=$.makeHexColor(...r),g(d,_s,h||1),c&&g(d,ei,e.thickness),d._initialData=n;const[u,p]=d.pageDimensions,[m,y]=d.pageTranslation;if(o){const A=g(d,Es,[]);for(let _=0;_<o.length;_+=8)A.push({x:(o[_]-m)/u,y:1-(o[_+1]-y)/p,width:(o[_+2]-o[_])/u,height:(o[_+1]-o[_+5])/p});v(b=d,Bh,Rg).call(b),v(x=d,Ss,Pn).call(x),d.rotate(d.rotation)}else if(c){g(d,ee,!0);const A=c[0],_={x:A[0]-m,y:p-(A[1]-y)},S=new Cg(_,[0,0,u,p],1,a(d,ei)/2,!0,.001);for(let P=0,k=A.length;P<k;P+=2)_.x=A[P]-m,_.y=p-(A[P+1]-y),S.add(_);const{id:T,clipPathId:C}=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:S.toSVGPath()}},!0,!0);v(w=d,No,Bd).call(w,{highlightOutlines:S.getOutlines(),highlightId:T,clipPathId:C}),v(E=d,Ss,Pn).call(E),d.rotate(d.parentRotation)}return d}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const i=this.getRect(0,0),s=gt._colorManager.convert(this.color),n={annotationType:V.HIGHLIGHT,color:s,opacity:a(this,_s),thickness:a(this,ei),quadPoints:v(this,Lp,py).call(this),outlines:v(this,Dp,fy).call(this,i),pageIndex:this.pageIndex,rect:i,rotation:v(this,Na,_l).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!v(this,Fp,vy).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Io=new WeakMap,Mh=new WeakMap,Es=new WeakMap,Ma=new WeakMap,Fh=new WeakMap,ke=new WeakMap,Nh=new WeakMap,Oh=new WeakMap,Fa=new WeakMap,ti=new WeakMap,$e=new WeakMap,ee=new WeakMap,Mo=new WeakMap,_s=new WeakMap,he=new WeakMap,Fo=new WeakMap,ei=new WeakMap,jh=new WeakMap,Bh=new WeakSet,Rg=function(){const e=new _g(a(this,Es),.001);g(this,ti,e.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,ti).box;const i=new _g(a(this,Es),.0025,.001,this._uiManager.direction==="ltr");g(this,ke,i.getOutlines());const{lastPoint:s}=a(this,ke);g(this,Mo,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},No=new WeakSet,Bd=function({highlightOutlines:e,highlightId:i,clipPathId:s}){var u,p;g(this,ti,e);const n=1.5;if(g(this,ke,e.getNewOutline(a(this,ei)/2+n,.0025)),i>=0)g(this,$e,i),g(this,Ma,s),this.parent.drawLayer.finalizeDraw(i,{bbox:e.box,path:{d:e.toSVGPath()}}),g(this,he,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,ke).box,path:{d:a(this,ke).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,$e),{bbox:v(u=tt,dn,fr).call(u,a(this,ti).box,(m-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,he),{bbox:v(p=tt,dn,fr).call(p,a(this,ke).box,m),path:{d:a(this,ke).toSVGPath()}})}const[r,o,c,h]=e.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=c,this.height=h;break;case 90:{const[m,y]=this.parentDimensions;this.x=o,this.y=1-r,this.width=c*y/m,this.height=h*m/y;break}case 180:this.x=1-r,this.y=1-o,this.width=c,this.height=h;break;case 270:{const[m,y]=this.parentDimensions;this.x=1-o,this.y=r,this.width=c*y/m,this.height=h*m/y;break}}const{lastPoint:d}=a(this,ke);g(this,Mo,[(d[0]-r)/c,(d[1]-o)/h])},Tp=new WeakSet,cy=function(e){const i=(r,o)=>{var c,h;this.color=r,g(this,_s,o),(c=this.parent)==null||c.drawLayer.updateProperties(a(this,$e),{root:{fill:r,"fill-opacity":o}}),(h=a(this,Fh))==null||h.updateColor(r)},s=this.color,n=a(this,_s);this.addCommands({cmd:i.bind(this,e,tt._defaultOpacity),undo:i.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},kp=new WeakSet,hy=function(e){const i=a(this,ei),s=n=>{g(this,ei,n),v(this,Pp,dy).call(this,n)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},Pp=new WeakSet,dy=function(e){if(!a(this,ee))return;v(this,No,Bd).call(this,{highlightOutlines:a(this,ti).getNewOutline(e/2)}),this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)},zh=new WeakSet,Lg=function(){a(this,$e)===null||!this.parent||(this.parent.drawLayer.remove(a(this,$e)),g(this,$e,null),this.parent.drawLayer.remove(a(this,he)),g(this,he,null))},Ss=new WeakSet,Pn=function(e=this.parent){a(this,$e)===null&&({id:fe(this,$e)._,clipPathId:fe(this,Ma)._}=e.drawLayer.draw({bbox:a(this,ti).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":a(this,_s)},rootClass:{highlight:!0,free:a(this,ee)},path:{d:a(this,ti).toSVGPath()}},!1,!0),g(this,he,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,ee)},bbox:a(this,ke).box,path:{d:a(this,ke).toSVGPath()}},a(this,ee))),a(this,Fa)&&(a(this,Fa).style.clipPath=a(this,Ma)))},dn=new WeakSet,fr=function([e,i,s,n],r){switch(r){case 90:return[1-i-n,e,n,s];case 180:return[1-e-s,1-i-n,s,n];case 270:return[i,1-e-s,n,s]}return[e,i,s,n]},Rp=new WeakSet,uy=function(e){tt._keyboardManager.exec(this,e)},Oo=new WeakSet,zd=function(e){if(!a(this,Io))return;const i=window.getSelection();e?i.setPosition(a(this,Io),a(this,Mh)):i.setPosition(a(this,Nh),a(this,Oh))},Na=new WeakSet,_l=function(){return a(this,ee)?this.rotation:0},Lp=new WeakSet,py=function(){if(a(this,ee))return null;const[e,i]=this.pageDimensions,[s,n]=this.pageTranslation,r=a(this,Es),o=new Float32Array(r.length*8);let c=0;for(const{x:h,y:d,width:u,height:p}of r){const m=h*e+s,y=(1-d)*i+n;o[c]=o[c+4]=m,o[c+1]=o[c+3]=y,o[c+2]=o[c+6]=m+u*e,o[c+5]=o[c+7]=y-p*i,c+=8}return o},Dp=new WeakSet,fy=function(e){return a(this,ti).serialize(e,v(this,Na,_l).call(this))},Ip=new WeakSet,gy=function(e,i){this._freeHighlight.add(i)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Mp=new WeakSet,my=function(e,i){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(i,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Fp=new WeakSet,vy=function(e){const{color:i}=this._initialData;return e.color.some((s,n)=>s!==i[n])},f(tt,dn),f(tt,Ip),f(tt,Mp),I(tt,"_defaultColor",null),I(tt,"_defaultOpacity",1),I(tt,"_defaultThickness",12),I(tt,"_type","highlight"),I(tt,"_editorType",V.HIGHLIGHT),I(tt,"_freeHighlightId",-1),I(tt,"_freeHighlight",null),I(tt,"_freeHighlightClipId","");let iu=tt;var Oa;class by{constructor(){f(this,Oa,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,i]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,i)}updateSVGProperty(t,e){a(this,Oa)[t]=e}toSVGProperties(){const t=a(this,Oa);return g(this,Oa,Object.create(null)),{root:t}}reset(){g(this,Oa,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){lt("Not implemented")}}Oa=new WeakMap;var Ue,jo,Gt,ja,Ba,un,pn,fn,za,Hh,Dg,$h,Ig,Uh,Mg,Ha,Sl,Np,yy,Bo,Hd,$a,Cl,gn,gr;const z=class z extends gt{constructor(e){super(e);f(this,Hh);f(this,$h);f(this,Uh);f(this,Ha);f(this,Np);f(this,Bo);f(this,$a);f(this,gn);f(this,Ue,null);f(this,jo,void 0);I(this,"_drawId",null);g(this,jo,e.mustBeCommitted||!1),this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(v(this,Hh,Dg).call(this,e),v(this,Ha,Sl).call(this))}static _mergeSVGProperties(e,i){const s=new Set(Object.keys(e));for(const[n,r]of Object.entries(i))s.has(n)?Object.assign(e[n],r):e[n]=r;return e}static getDefaultDrawingOptions(e){lt("Not implemented")}static get typesMap(){lt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(a(z,Gt).updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,i)}static get defaultPropertiesToUpdate(){const e=[],i=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)e.push([s,i[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:i}=this;for(const[s,n]of this.constructor.typesMap)e.push([s,i[n]]);return e}_updateProperty(e,i,s){const n=this._drawingOptions,r=n[i],o=c=>{var d;n.updateProperty(i,c);const h=a(this,Ue).updateProperty(i,c);h&&v(this,$a,Cl).call(this,h),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,z._mergeSVGProperties(a(this,Ue).getPathResizingSVGProperties(v(this,Bo,Hd).call(this)),{bbox:v(this,gn,gr).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,z._mergeSVGProperties(a(this,Ue).getPathResizedSVGProperties(v(this,Bo,Hd).call(this)),{bbox:v(this,gn,gr).call(this)}))}_onTranslating(e,i){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:v(this,gn,gr).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,z._mergeSVGProperties(a(this,Ue).getPathTranslatedSVGProperties(v(this,Bo,Hd).call(this),this.parentDimensions),{bbox:v(this,gn,gr).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,jo)&&(g(this,jo,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){v(this,Uh,Mg).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(v(this,Ha,Sl).call(this),v(this,$a,Cl).call(this,a(this,Ue).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var s;let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),v(this,Uh,Mg).call(this)):e&&(this._uiManager.addShouldRescale(this),v(this,Ha,Sl).call(this,e),i=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(e),i&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,z._mergeSVGProperties({bbox:v(this,gn,gr).call(this)},a(this,Ue).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&v(this,$a,Cl).call(this,a(this,Ue).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,i;this._isCopy&&(e=this.x,i=this.y);const s=super.render();s.classList.add("draw");const n=document.createElement("div");s.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[r,o]=this.parentDimensions;return this.setDims(this.width*r,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,i),s}static createDrawerInstance(e,i,s,n,r){lt("Not implemented")}static startDrawing(e,i,s,n){var x;const{target:r,offsetX:o,offsetY:c,pointerId:h,pointerType:d}=n;if(a(z,pn)&&a(z,pn)!==d)return;const{viewport:{rotation:u}}=e,{width:p,height:m}=r.getBoundingClientRect(),y=g(z,ja,new AbortController),b=e.combinedSignal(y);if(a(z,un)||g(z,un,h),a(z,pn)??g(z,pn,d),window.addEventListener("pointerup",w=>{var E;a(z,un)===w.pointerId?this._endDraw(w):(E=a(z,fn))==null||E.delete(w.pointerId)},{signal:b}),window.addEventListener("pointercancel",w=>{var E;a(z,un)===w.pointerId?this._currentParent.endDrawingSession():(E=a(z,fn))==null||E.delete(w.pointerId)},{signal:b}),window.addEventListener("pointerdown",w=>{a(z,pn)===w.pointerType&&((a(z,fn)||g(z,fn,new Set)).add(w.pointerId),a(z,Gt).isCancellable()&&(a(z,Gt).removeLastElement(),a(z,Gt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",ai,{signal:b}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:b}),r.addEventListener("touchmove",w=>{w.timeStamp===a(z,za)&&Dt(w)},{signal:b}),e.toggleDrawing(),(x=i._editorUndoBar)==null||x.hide(),a(z,Gt)){e.drawLayer.updateProperties(this._currentDrawId,a(z,Gt).startNew(o,c,p,m,u));return}i.updateUIForDefaultProperties(this),g(z,Gt,this.createDrawerInstance(o,c,p,m,u)),g(z,Ba,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(a(z,Ba).toSVGProperties(),a(z,Gt).defaultSVGProperties),!0,!1)}static _drawMove(e){var r;if(g(z,za,-1),!a(z,Gt))return;const{offsetX:i,offsetY:s,pointerId:n}=e;if(a(z,un)===n){if(((r=a(z,fn))==null?void 0:r.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(z,Gt).add(i,s)),g(z,za,e.timeStamp),Dt(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,g(z,Gt,null),g(z,Ba,null),g(z,pn,null),g(z,za,NaN)),a(z,ja)&&(a(z,ja).abort(),g(z,ja,null),g(z,un,NaN),g(z,fn,null))}static _endDraw(e){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===i.div&&i.drawLayer.updateProperties(this._currentDrawId,a(z,Gt).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=a(z,Gt),n=this._currentDrawId,r=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(r))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:Q.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(Q.DRAW_STEP),!a(z,Gt).isEmpty()){const{pageDimensions:[s,n],scale:r}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(z,Gt).getOutlines(s*r,n*r,r,this._INNER_MARGIN),drawingOptions:a(z,Ba),mustBeCommitted:!e});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,s,n,r,o){lt("Not implemented")}static async deserialize(e,i,s){var u,p;const{rawDims:{pageWidth:n,pageHeight:r,pageX:o,pageY:c}}=i.viewport,h=this.deserializeDraw(o,c,n,r,this._INNER_MARGIN,e),d=await super.deserialize(e,i,s);return d.createDrawingOptions(e),v(u=d,Hh,Dg).call(u,{drawOutlines:h}),v(p=d,Ha,Sl).call(p),d.onScaleChanging(),d.rotate(),d}serializeDraw(e){const[i,s]=this.pageTranslation,[n,r]=this.pageDimensions;return a(this,Ue).serialize([i,s,n,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ue=new WeakMap,jo=new WeakMap,Gt=new WeakMap,ja=new WeakMap,Ba=new WeakMap,un=new WeakMap,pn=new WeakMap,fn=new WeakMap,za=new WeakMap,Hh=new WeakSet,Dg=function({drawOutlines:e,drawId:i,drawingOptions:s}){g(this,Ue,e),this._drawingOptions||(this._drawingOptions=s),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=v(this,$h,Ig).call(this,e,this.parent),v(this,$a,Cl).call(this,e.box)},$h=new WeakSet,Ig=function(e,i){const{id:s}=i.drawLayer.draw(z._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s},Uh=new WeakSet,Mg=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ha=new WeakSet,Sl=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=v(this,$h,Ig).call(this,a(this,Ue),e)}},Np=new WeakSet,yy=function([e,i,s,n]){const{parentDimensions:[r,o],rotation:c}=this;switch(c){case 90:return[i,1-e,s*(o/r),n*(r/o)];case 180:return[1-e,1-i,s,n];case 270:return[1-i,e,s*(o/r),n*(r/o)];default:return[e,i,s,n]}},Bo=new WeakSet,Hd=function(){const{x:e,y:i,width:s,height:n,parentDimensions:[r,o],rotation:c}=this;switch(c){case 90:return[1-i,e,s*(r/o),n*(o/r)];case 180:return[1-e,1-i,s,n];case 270:return[i,1-e,s*(r/o),n*(o/r)];default:return[e,i,s,n]}},$a=new WeakSet,Cl=function(e){if([this.x,this.y,this.width,this.height]=v(this,Np,yy).call(this,e),this.div){this.fixAndSetPosition();const[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()},gn=new WeakSet,gr=function(){const{x:e,y:i,width:s,height:n,rotation:r,parentRotation:o,parentDimensions:[c,h]}=this;switch((r*4+o)/90){case 1:return[1-i-n,e,n,s];case 2:return[1-e-s,1-i-n,s,n];case 3:return[i,1-e-s,n,s];case 4:return[e,i-s*(c/h),n*(h/c),s*(c/h)];case 5:return[1-i,e,s*(c/h),n*(h/c)];case 6:return[1-e-n*(h/c),1-i,n*(h/c),s*(c/h)];case 7:return[i-s*(c/h),1-e-n*(h/c),s*(c/h),n*(h/c)];case 8:return[e-s,i-n,s,n];case 9:return[1-i,e-s,n,s];case 10:return[1-e,1-i,s,n];case 11:return[i-n,1-e,n,s];case 12:return[e-n*(h/c),i,n*(h/c),s*(c/h)];case 13:return[1-i-s*(c/h),e-n*(h/c),s*(c/h),n*(h/c)];case 14:return[1-e,1-i-s*(c/h),n*(h/c),s*(c/h)];case 15:return[i,1-e,s*(c/h),n*(h/c)];default:return[e,i,s,n]}},I(z,"_currentDrawId",-1),I(z,"_currentParent",null),f(z,Gt,null),f(z,ja,null),f(z,Ba,null),f(z,un,NaN),f(z,pn,null),f(z,fn,null),f(z,za,NaN),I(z,"_INNER_MARGIN",3);let su=z;var Bi,Vt,Wt,Ua,zo,ve,ie,ii,Ga,Va,Wa,Ho,$d;class zA{constructor(t,e,i,s,n,r){f(this,Ho);f(this,Bi,new Float64Array(6));f(this,Vt,void 0);f(this,Wt,void 0);f(this,Ua,void 0);f(this,zo,void 0);f(this,ve,void 0);f(this,ie,"");f(this,ii,0);f(this,Ga,new ld);f(this,Va,void 0);f(this,Wa,void 0);g(this,Va,i),g(this,Wa,s),g(this,Ua,n),g(this,zo,r),[t,e]=v(this,Ho,$d).call(this,t,e);const o=g(this,Vt,[NaN,NaN,NaN,NaN,t,e]);g(this,ve,[t,e]),g(this,Wt,[{line:o,points:a(this,ve)}]),a(this,Bi).set(o,0)}updateProperty(t,e){t==="stroke-width"&&g(this,zo,e)}isEmpty(){return!a(this,Wt)||a(this,Wt).length===0}isCancellable(){return a(this,ve).length<=10}add(t,e){[t,e]=v(this,Ho,$d).call(this,t,e);const[i,s,n,r]=a(this,Bi).subarray(2,6),o=t-n,c=e-r;return Math.hypot(a(this,Va)*o,a(this,Wa)*c)<=2?null:(a(this,ve).push(t,e),isNaN(i)?(a(this,Bi).set([n,r,t,e],2),a(this,Vt).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(a(this,Bi)[0])&&a(this,Vt).splice(6,6),a(this,Bi).set([i,s,n,r,t,e],0),a(this,Vt).push(...B.createBezierPoints(i,s,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const i=this.add(t,e);return i||(a(this,ve).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){g(this,Va,i),g(this,Wa,s),g(this,Ua,n),[t,e]=v(this,Ho,$d).call(this,t,e);const r=g(this,Vt,[NaN,NaN,NaN,NaN,t,e]);g(this,ve,[t,e]);const o=a(this,Wt).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),a(this,Wt).push({line:r,points:a(this,ve)}),a(this,Bi).set(r,0),g(this,ii,0),this.toSVGPath(),null}getLastElement(){return a(this,Wt).at(-1)}setLastElement(t){return a(this,Wt)?(a(this,Wt).push(t),g(this,Vt,t.line),g(this,ve,t.points),g(this,ii,0),{path:{d:this.toSVGPath()}}):a(this,Ga).setLastElement(t)}removeLastElement(){if(!a(this,Wt))return a(this,Ga).removeLastElement();a(this,Wt).pop(),g(this,ie,"");for(let t=0,e=a(this,Wt).length;t<e;t++){const{line:i,points:s}=a(this,Wt)[t];g(this,Vt,i),g(this,ve,s),g(this,ii,0),this.toSVGPath()}return{path:{d:a(this,ie)}}}toSVGPath(){const t=B.svgRound(a(this,Vt)[4]),e=B.svgRound(a(this,Vt)[5]);if(a(this,ve).length===2)return g(this,ie,`${a(this,ie)} M ${t} ${e} Z`),a(this,ie);if(a(this,ve).length<=6){const s=a(this,ie).lastIndexOf("M");g(this,ie,`${a(this,ie).slice(0,s)} M ${t} ${e}`),g(this,ii,6)}if(a(this,ve).length===4){const s=B.svgRound(a(this,Vt)[10]),n=B.svgRound(a(this,Vt)[11]);return g(this,ie,`${a(this,ie)} L ${s} ${n}`),g(this,ii,12),a(this,ie)}const i=[];a(this,ii)===0&&(i.push(`M ${t} ${e}`),g(this,ii,6));for(let s=a(this,ii),n=a(this,Vt).length;s<n;s+=6){const[r,o,c,h,d,u]=a(this,Vt).slice(s,s+6).map(B.svgRound);i.push(`C${r} ${o} ${c} ${h} ${d} ${u}`)}return g(this,ie,a(this,ie)+i.join(" ")),g(this,ii,a(this,Vt).length),a(this,ie)}getOutlines(t,e,i,s){const n=a(this,Wt).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),a(this,Ga).build(a(this,Wt),t,e,i,a(this,Ua),a(this,zo),s),g(this,Bi,null),g(this,Vt,null),g(this,Wt,null),g(this,ie,null),a(this,Ga)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Bi=new WeakMap,Vt=new WeakMap,Wt=new WeakMap,Ua=new WeakMap,zo=new WeakMap,ve=new WeakMap,ie=new WeakMap,ii=new WeakMap,Ga=new WeakMap,Va=new WeakMap,Wa=new WeakMap,Ho=new WeakSet,$d=function(t,e){return B._normalizePoint(t,e,a(this,Va),a(this,Wa),a(this,Ua))};var be,Gh,Vh,Ge,zi,Hi,$o,Uo,qa,vi,Yi,Op,xy,jp,wy,Bp,Ay;class ld extends B{constructor(){super(...arguments);f(this,vi);f(this,Op);f(this,jp);f(this,Bp);f(this,be,void 0);f(this,Gh,0);f(this,Vh,void 0);f(this,Ge,void 0);f(this,zi,void 0);f(this,Hi,void 0);f(this,$o,void 0);f(this,Uo,void 0);f(this,qa,void 0)}build(e,i,s,n,r,o,c){g(this,zi,i),g(this,Hi,s),g(this,$o,n),g(this,Uo,r),g(this,qa,o),g(this,Vh,c??0),g(this,Ge,e),v(this,jp,wy).call(this)}get thickness(){return a(this,qa)}setLastElement(e){return a(this,Ge).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,Ge).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:i}of a(this,Ge)){if(e.push(`M${B.svgRound(i[4])} ${B.svgRound(i[5])}`),i.length===6){e.push("Z");continue}if(i.length===12&&isNaN(i[6])){e.push(`L${B.svgRound(i[10])} ${B.svgRound(i[11])}`);continue}for(let s=6,n=i.length;s<n;s+=6){const[r,o,c,h,d,u]=i.subarray(s,s+6).map(B.svgRound);e.push(`C${r} ${o} ${c} ${h} ${d} ${u}`)}}return e.join("")}serialize([e,i,s,n],r){const o=[],c=[],[h,d,u,p]=v(this,Op,xy).call(this);let m,y,b,x,w,E,A,_,S;switch(a(this,Uo)){case 0:S=B._rescale,m=e,y=i+n,b=s,x=-n,w=e+h*s,E=i+(1-d-p)*n,A=e+(h+u)*s,_=i+(1-d)*n;break;case 90:S=B._rescaleAndSwap,m=e,y=i,b=s,x=n,w=e+d*s,E=i+h*n,A=e+(d+p)*s,_=i+(h+u)*n;break;case 180:S=B._rescale,m=e+s,y=i,b=-s,x=n,w=e+(1-h-u)*s,E=i+d*n,A=e+(1-h)*s,_=i+(d+p)*n;break;case 270:S=B._rescaleAndSwap,m=e+s,y=i+n,b=-s,x=-n,w=e+(1-d-p)*s,E=i+(1-h-u)*n,A=e+(1-d)*s,_=i+(1-h)*n;break}for(const{line:T,points:C}of a(this,Ge))o.push(S(T,m,y,b,x,r?new Array(T.length):null)),c.push(S(C,m,y,b,x,r?new Array(C.length):null));return{lines:o,points:c,rect:[w,E,A,_]}}static deserialize(e,i,s,n,r,{paths:{lines:o,points:c},rotation:h,thickness:d}){const u=[];let p,m,y,b,x;switch(h){case 0:x=B._rescale,p=-e/s,m=i/n+1,y=1/s,b=-1/n;break;case 90:x=B._rescaleAndSwap,p=-i/n,m=-e/s,y=1/n,b=1/s;break;case 180:x=B._rescale,p=e/s+1,m=-i/n,y=-1/s,b=1/n;break;case 270:x=B._rescaleAndSwap,p=i/n+1,m=e/s+1,y=-1/n,b=-1/s;break}if(!o){o=[];for(const E of c){const A=E.length;if(A===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(A===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}const _=new Float32Array(3*(A-2));o.push(_);let[S,T,C,P]=E.subarray(0,4);_.set([NaN,NaN,NaN,NaN,S,T],0);for(let k=4;k<A;k+=2){const D=E[k],M=E[k+1];_.set(B.createBezierPoints(S,T,C,P,D,M),(k-2)*3),[S,T,C,P]=[C,P,D,M]}}}for(let E=0,A=o.length;E<A;E++)u.push({line:x(o[E].map(_=>_??NaN),p,m,y,b),points:x(c[E].map(_=>_??NaN),p,m,y,b)});const w=new this.prototype.constructor;return w.build(u,s,n,1,h,d,r),w}get box(){return a(this,be)}updateProperty(e,i){return e==="stroke-width"?v(this,Bp,Ay).call(this,i):null}updateParentDimensions([e,i],s){const[n,r]=v(this,vi,Yi).call(this);g(this,zi,e),g(this,Hi,i),g(this,$o,s);const[o,c]=v(this,vi,Yi).call(this),h=o-n,d=c-r,u=a(this,be);return u[0]-=h,u[1]-=d,u[2]+=2*h,u[3]+=2*d,u}updateRotation(e){return g(this,Gh,e),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,be).map(B.svgRound).join(" ")}get defaultProperties(){const[e,i]=a(this,be);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(e)} ${B.svgRound(i)}`}}}get rotationTransform(){const[,,e,i]=a(this,be);let s=0,n=0,r=0,o=0,c=0,h=0;switch(a(this,Gh)){case 90:n=i/e,r=-e/i,c=e;break;case 180:s=-1,o=-1,c=e,h=i;break;case 270:n=-i/e,r=e/i,h=i;break;default:return""}return`matrix(${s} ${n} ${r} ${o} ${B.svgRound(c)} ${B.svgRound(h)})`}getPathResizingSVGProperties([e,i,s,n]){const[r,o]=v(this,vi,Yi).call(this),[c,h,d,u]=a(this,be);if(Math.abs(d-r)<=B.PRECISION||Math.abs(u-o)<=B.PRECISION){const x=e+s/2-(c+d/2),w=i+n/2-(h+u/2);return{path:{"transform-origin":`${B.svgRound(e)} ${B.svgRound(i)}`,transform:`${this.rotationTransform} translate(${x} ${w})`}}}const p=(s-2*r)/(d-2*r),m=(n-2*o)/(u-2*o),y=d/s,b=u/n;return{path:{"transform-origin":`${B.svgRound(c)} ${B.svgRound(h)}`,transform:`${this.rotationTransform} scale(${y} ${b}) translate(${B.svgRound(r)} ${B.svgRound(o)}) scale(${p} ${m}) translate(${B.svgRound(-r)} ${B.svgRound(-o)})`}}}getPathResizedSVGProperties([e,i,s,n]){const[r,o]=v(this,vi,Yi).call(this),c=a(this,be),[h,d,u,p]=c;if(c[0]=e,c[1]=i,c[2]=s,c[3]=n,Math.abs(u-r)<=B.PRECISION||Math.abs(p-o)<=B.PRECISION){const w=e+s/2-(h+u/2),E=i+n/2-(d+p/2);for(const{line:A,points:_}of a(this,Ge))B._translate(A,w,E,A),B._translate(_,w,E,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(e)} ${B.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(s-2*r)/(u-2*r),y=(n-2*o)/(p-2*o),b=-m*(h+r)+e+r,x=-y*(d+o)+i+o;if(m!==1||y!==1||b!==0||x!==0)for(const{line:w,points:E}of a(this,Ge))B._rescale(w,b,x,m,y,w),B._rescale(E,b,x,m,y,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${B.svgRound(e)} ${B.svgRound(i)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,i],s){const[n,r]=s,o=a(this,be),c=e-o[0],h=i-o[1];if(a(this,zi)===n&&a(this,Hi)===r)for(const{line:d,points:u}of a(this,Ge))B._translate(d,c,h,d),B._translate(u,c,h,u);else{const d=a(this,zi)/n,u=a(this,Hi)/r;g(this,zi,n),g(this,Hi,r);for(const{line:p,points:m}of a(this,Ge))B._rescale(p,c,h,d,u,p),B._rescale(m,c,h,d,u,m);o[2]*=d,o[3]*=u}return o[0]=e,o[1]=i,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${B.svgRound(e)} ${B.svgRound(i)}`}}}get defaultSVGProperties(){const e=a(this,be);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${B.svgRound(e[0])} ${B.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}be=new WeakMap,Gh=new WeakMap,Vh=new WeakMap,Ge=new WeakMap,zi=new WeakMap,Hi=new WeakMap,$o=new WeakMap,Uo=new WeakMap,qa=new WeakMap,vi=new WeakSet,Yi=function(e=a(this,qa)){const i=a(this,Vh)+e/2*a(this,$o);return a(this,Uo)%180===0?[i/a(this,zi),i/a(this,Hi)]:[i/a(this,Hi),i/a(this,zi)]},Op=new WeakSet,xy=function(){const[e,i,s,n]=a(this,be),[r,o]=v(this,vi,Yi).call(this,0);return[e+r,i+o,s-2*r,n-2*o]},jp=new WeakSet,wy=function(){const e=g(this,be,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of a(this,Ge)){if(n.length<=12){for(let c=4,h=n.length;c<h;c+=6)$.pointBoundingBox(n[c],n[c+1],e);continue}let r=n[4],o=n[5];for(let c=6,h=n.length;c<h;c+=6){const[d,u,p,m,y,b]=n.subarray(c,c+6);$.bezierBoundingBox(r,o,d,u,p,m,y,b,e),r=y,o=b}}const[i,s]=v(this,vi,Yi).call(this);e[0]=de(e[0]-i,0,1),e[1]=de(e[1]-s,0,1),e[2]=de(e[2]+i,0,1),e[3]=de(e[3]+s,0,1),e[2]-=e[0],e[3]-=e[1]},Bp=new WeakSet,Ay=function(e){const[i,s]=v(this,vi,Yi).call(this);g(this,qa,e);const[n,r]=v(this,vi,Yi).call(this),[o,c]=[n-i,r-s],h=a(this,be);return h[0]-=o,h[1]-=c,h[2]+=2*o,h[3]+=2*c,h};class nf extends by{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:gt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new nf(this._viewParameters);return t.updateAll(this),t}}var zp,Ey;const br=class br extends su{constructor(e){super({...e,name:"inkEditor"});f(this,zp);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,i){gt.initialize(e,i),this._defaultDrawingOptions=new nf(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!0}static get typesMap(){return J(this,"typesMap",new Map([[Q.INK_THICKNESS,"stroke-width"],[Q.INK_COLOR,"stroke"],[Q.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,i,s,n,r){return new zA(e,i,s,n,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,i,s,n,r,o){return ld.deserialize(e,i,s,n,r,o)}static async deserialize(e,i,s){let n=null;if(e instanceof cm){const{data:{inkLists:o,rect:c,rotation:h,id:d,color:u,opacity:p,borderStyle:{rawWidth:m},popupRef:y},parent:{page:{pageNumber:b}}}=e;n=e={annotationType:V.INK,color:Array.from(u),thickness:m,opacity:p,paths:{points:o},boxes:null,pageIndex:b-1,rect:c.slice(0),rotation:h,annotationElementId:d,id:d,deleted:!1,popupRef:y}}const r=await super.deserialize(e,i,s);return r._initialData=n,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:i,parent:s}=this;i.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,i.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:i,opacity:s}){this._drawingOptions=br.getDefaultDrawingOptions({stroke:$.makeHexColor(...e),"stroke-width":i,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":c}}=this,h={annotationType:V.INK,color:gt._colorManager.convert(r),opacity:o,thickness:c,paths:{lines:i,points:s},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(h.isCopy=!0,h):this.annotationElementId&&!v(this,zp,Ey).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(e){const{points:i,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:i}),null}};zp=new WeakSet,Ey=function(e){const{color:i,thickness:s,opacity:n,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,c)=>o!==i[c])||e.thickness!==s||e.opacity!==n||e.pageIndex!==r},I(br,"_type","ink"),I(br,"_editorType",V.INK),I(br,"_defaultDrawingOptions",null);let Fg=br;class Ng extends ld{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const bd=8,cl=3;var Xa,Wh,Og,bi,Hp,_y,$p,Sy,qh,jg,Go,Ud,Up,Cy,Gp,Ty,Vp,ky,Xh,Bg,Yh,zg,Wp,Py;class Nt{static extractContoursFromText(t,{fontFamily:e,fontStyle:i,fontWeight:s},n,r,o,c){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1});const u=200,p=d.font=`${i} ${s} ${u}px ${e}`,{actualBoundingBoxLeft:m,actualBoundingBoxRight:y,actualBoundingBoxAscent:b,actualBoundingBoxDescent:x,fontBoundingBoxAscent:w,fontBoundingBoxDescent:E,width:A}=d.measureText(t),_=1.5,S=Math.ceil(Math.max(Math.abs(m)+Math.abs(y)||0,A)*_),T=Math.ceil(Math.max(Math.abs(b)+Math.abs(x)||u,Math.abs(w)+Math.abs(E)||u)*_);h=new OffscreenCanvas(S,T),d=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=p,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,S,T),d.fillStyle="black",d.fillText(t,S*(_-1)/2,T*(3-_)/2);const C=v(this,Xh,Bg).call(this,d.getImageData(0,0,S,T).data),P=v(this,Vp,ky).call(this,C),k=v(this,Yh,zg).call(this,P),D=v(this,qh,jg).call(this,C,S,T,k);return this.processDrawnLines({lines:{curves:D,width:S,height:T},pageWidth:n,pageHeight:r,rotation:o,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(t,e,i,s,n){const[r,o,c]=v(this,Wp,Py).call(this,t),[h,d]=v(this,Gp,Ty).call(this,r,o,c,Math.hypot(o,c)*a(this,Xa).sigmaSFactor,a(this,Xa).sigmaR,a(this,Xa).kernelSize),u=v(this,Yh,zg).call(this,d),p=v(this,qh,jg).call(this,h,o,c,u);return this.processDrawnLines({lines:{curves:p,width:o,height:c},pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:r,areContours:o}){s%180!==0&&([e,i]=[i,e]);const{curves:c,width:h,height:d}=t,u=t.thickness??0,p=[],m=Math.min(e/h,i/d),y=m/e,b=m/i,x=[];for(const{points:E}of c){const A=r?v(this,Up,Cy).call(this,E):E;if(!A)continue;x.push(A);const _=A.length,S=new Float32Array(_),T=new Float32Array(3*(_===2?2:_-2));if(p.push({line:T,points:S}),_===2){S[0]=A[0]*y,S[1]=A[1]*b,T.set([NaN,NaN,NaN,NaN,S[0],S[1]],0);continue}let[C,P,k,D]=A;C*=y,P*=b,k*=y,D*=b,S.set([C,P,k,D],0),T.set([NaN,NaN,NaN,NaN,C,P],0);for(let M=4;M<_;M+=2){const q=S[M]=A[M]*y,G=S[M+1]=A[M+1]*b;T.set(B.createBezierPoints(C,P,k,D,q,G),(M-2)*3),[C,P,k,D]=[k,D,q,G]}}if(p.length===0)return null;const w=o?new Ng:new ld;return w.build(p,e,i,1,s,o?0:u,n),{outline:w,newCurves:x,areContours:o,thickness:u,width:h,height:d}}static async compressSignature({outlines:t,areContours:e,thickness:i,width:s,height:n}){let r=1/0,o=-1/0,c=0;for(const A of t){c+=A.length;for(let _=2,S=A.length;_<S;_++){const T=A[_]-A[_-2];r=Math.min(r,T),o=Math.max(o,T)}}let h;r>=-128&&o<=127?h=Int8Array:r>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const d=t.length,u=bd+cl*d,p=new Uint32Array(u);let m=0;p[m++]=u*Uint32Array.BYTES_PER_ELEMENT+(c-2*d)*h.BYTES_PER_ELEMENT,p[m++]=0,p[m++]=s,p[m++]=n,p[m++]=e?0:1,p[m++]=Math.max(0,Math.floor(i??0)),p[m++]=d,p[m++]=h.BYTES_PER_ELEMENT;for(const A of t)p[m++]=A.length-2,p[m++]=A[0],p[m++]=A[1];const y=new CompressionStream("deflate-raw"),b=y.writable.getWriter();await b.ready,b.write(p);const x=h.prototype.constructor;for(const A of t){const _=new x(A.length-2);for(let S=2,T=A.length;S<T;S++)_[S-2]=A[S]-A[S-2];b.write(_)}b.close();const w=await new Response(y.readable).arrayBuffer(),E=new Uint8Array(w);return Tv(E)}static async decompressSignature(t){try{const e=mw(t),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),n=s.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,o=0;for await(const A of i)r||(r=new Uint8Array(new Uint32Array(A.buffer,0,4)[0])),r.set(A,o),o+=A.length;const c=new Uint32Array(r.buffer,0,r.length>>2),h=c[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const d=c[2],u=c[3],p=c[4]===0,m=c[5],y=c[6],b=c[7],x=[],w=(bd+cl*y)*Uint32Array.BYTES_PER_ELEMENT;let E;switch(b){case Int8Array.BYTES_PER_ELEMENT:E=new Int8Array(r.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:E=new Int16Array(r.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:E=new Int32Array(r.buffer,w);break}o=0;for(let A=0;A<y;A++){const _=c[cl*A+bd],S=new Float32Array(_+2);x.push(S);for(let T=0;T<cl-1;T++)S[T]=c[cl*A+bd+T+1];for(let T=0;T<_;T++)S[T+2]=S[T]+E[o++]}return{areContours:p,thickness:m,outlines:x,width:d,height:u}}catch(e){return W(`decompressSignature: ${e}`),null}}}Xa=new WeakMap,Wh=new WeakSet,Og=function(t,e,i,s){return i-=t,s-=e,i===0?s>0?0:4:i===1?s+6:2-s},bi=new WeakMap,Hp=new WeakSet,_y=function(t,e,i,s,n,r,o){const c=v(this,Wh,Og).call(this,i,s,n,r);for(let h=0;h<8;h++){const d=(-h+c-o+16)%8,u=a(this,bi)[2*d],p=a(this,bi)[2*d+1];if(t[(i+u)*e+(s+p)]!==0)return d}return-1},$p=new WeakSet,Sy=function(t,e,i,s,n,r,o){const c=v(this,Wh,Og).call(this,i,s,n,r);for(let h=0;h<8;h++){const d=(h+c+o+16)%8,u=a(this,bi)[2*d],p=a(this,bi)[2*d+1];if(t[(i+u)*e+(s+p)]!==0)return d}return-1},qh=new WeakSet,jg=function(t,e,i,s){const n=t.length,r=new Int32Array(n);for(let d=0;d<n;d++)r[d]=t[d]<=s?1:0;for(let d=1;d<i-1;d++)r[d*e]=r[d*e+e-1]=0;for(let d=0;d<e;d++)r[d]=r[e*i-1-d]=0;let o=1,c;const h=[];for(let d=1;d<i-1;d++){c=1;for(let u=1;u<e-1;u++){const p=d*e+u,m=r[p];if(m===0)continue;let y=d,b=u;if(m===1&&r[p-1]===0)o+=1,b-=1;else if(m>=1&&r[p+1]===0)o+=1,b+=1,m>1&&(c=m);else{m!==1&&(c=Math.abs(m));continue}const x=[u,d],w=b===u+1,E={isHole:w,points:x,id:o,parent:0};h.push(E);let A;for(const M of h)if(M.id===c){A=M;break}A?A.isHole?E.parent=w?A.parent:c:E.parent=w?c:A.parent:E.parent=w?c:0;const _=v(this,Hp,_y).call(this,r,e,d,u,y,b,0);if(_===-1){r[p]=-o,r[p]!==1&&(c=Math.abs(r[p]));continue}let S=a(this,bi)[2*_],T=a(this,bi)[2*_+1];const C=d+S,P=u+T;y=C,b=P;let k=d,D=u;for(;;){const M=v(this,$p,Sy).call(this,r,e,k,D,y,b,1);S=a(this,bi)[2*M],T=a(this,bi)[2*M+1];const q=k+S,G=D+T;x.push(G,q);const O=k*e+D;if(r[O+1]===0?r[O]=-o:r[O]===1&&(r[O]=o),q===d&&G===u&&k===C&&D===P){r[p]!==1&&(c=Math.abs(r[p]));break}else y=k,b=D,k=q,D=G}}}return h},Go=new WeakSet,Ud=function(t,e,i,s){if(i-e<=4){for(let C=e;C<i-2;C+=2)s.push(t[C],t[C+1]);return}const n=t[e],r=t[e+1],o=t[i-4]-n,c=t[i-3]-r,h=Math.hypot(o,c),d=o/h,u=c/h,p=d*r-u*n,m=c/o,y=1/h,b=Math.atan(m),x=Math.cos(b),w=Math.sin(b),E=y*(Math.abs(x)+Math.abs(w)),A=y*(1-E+E**2),_=Math.max(Math.atan(Math.abs(w+x)*A),Math.atan(Math.abs(w-x)*A));let S=0,T=e;for(let C=e+2;C<i-2;C+=2){const P=Math.abs(p-d*t[C+1]+u*t[C]);P>S&&(T=C,S=P)}S>(h*_)**2?(v(this,Go,Ud).call(this,t,e,T+2,s),v(this,Go,Ud).call(this,t,T,i,s)):s.push(n,r)},Up=new WeakSet,Cy=function(t){const e=[],i=t.length;return v(this,Go,Ud).call(this,t,0,i,e),e.push(t[i-2],t[i-1]),e.length<=4?null:e},Gp=new WeakSet,Ty=function(t,e,i,s,n,r){const o=new Float32Array(r**2),c=-2*s**2,h=r>>1;for(let b=0;b<r;b++){const x=(b-h)**2;for(let w=0;w<r;w++)o[b*r+w]=Math.exp((x+(w-h)**2)/c)}const d=new Float32Array(256),u=-2*n**2;for(let b=0;b<256;b++)d[b]=Math.exp(b**2/u);const p=t.length,m=new Uint8Array(p),y=new Uint32Array(256);for(let b=0;b<i;b++)for(let x=0;x<e;x++){const w=b*e+x,E=t[w];let A=0,_=0;for(let T=0;T<r;T++){const C=b+T-h;if(!(C<0||C>=i))for(let P=0;P<r;P++){const k=x+P-h;if(k<0||k>=e)continue;const D=t[C*e+k],M=o[T*r+P]*d[Math.abs(D-E)];A+=D*M,_+=M}}const S=m[w]=Math.round(A/_);y[S]++}return[m,y]},Vp=new WeakSet,ky=function(t){const e=new Uint32Array(256);for(const i of t)e[i]++;return e},Xh=new WeakSet,Bg=function(t){const e=t.length,i=new Uint8ClampedArray(e>>2);let s=-1/0,n=1/0;for(let o=0,c=i.length;o<c;o++){if(t[(o<<2)+3]===0){s=i[o]=255;continue}const d=i[o]=t[o<<2];d>s&&(s=d),d<n&&(n=d)}const r=255/(s-n);for(let o=0;o<e;o++)i[o]=(i[o]-n)*r;return i},Yh=new WeakSet,zg=function(t){let e,i=-1/0,s=-1/0;const n=t.findIndex(c=>c!==0);let r=n,o=n;for(e=n;e<256;e++){const c=t[e];c>i&&(e-r>s&&(s=e-r,o=e-1),i=c,r=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e},Wp=new WeakSet,Py=function(t){const e=t,{width:i,height:s}=t,{maxDim:n}=a(this,Xa);let r=i,o=s;if(i>n||s>n){let p=i,m=s,y=Math.log2(Math.max(i,s)/n);const b=Math.floor(y);y=y===b?b-1:b;for(let w=0;w<y;w++){r=Math.ceil(p/2),o=Math.ceil(m/2);const E=new OffscreenCanvas(r,o);E.getContext("2d").drawImage(t,0,0,p,m,0,0,r,o),p=r,m=o,t!==e&&t.close(),t=E.transferToImageBitmap()}const x=Math.min(n/r,n/o);r=Math.round(r*x),o=Math.round(o*x)}const h=new OffscreenCanvas(r,o).getContext("2d",{willReadFrequently:!0});h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,r,o);const d=h.getImageData(0,0,r,o).data;return[v(this,Xh,Bg).call(this,d),r,o]},f(Nt,Wh),f(Nt,Hp),f(Nt,$p),f(Nt,qh),f(Nt,Go),f(Nt,Up),f(Nt,Gp),f(Nt,Vp),f(Nt,Xh),f(Nt,Yh),f(Nt,Wp),f(Nt,Xa,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),f(Nt,bi,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class dm extends by{constructor(){super(),super.updateProperties({fill:gt._defaultLineColor,"stroke-width":0})}clone(){const t=new dm;return t.updateAll(this),t}}class um extends nf{constructor(t){super(t),super.updateProperties({stroke:gt._defaultLineColor,"stroke-width":1})}clone(){const t=new um(this._viewParameters);return t.updateAll(this),t}}var mn,$i,vn,Ya;const De=class De extends su{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});f(this,mn,!1);f(this,$i,null);f(this,vn,null);f(this,Ya,null);this._willKeepAspectRatio=!0,g(this,vn,e.signatureData||null),g(this,$i,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,i){gt.initialize(e,i),this._defaultDrawingOptions=new dm,this._defaultDrawnSignatureOptions=new um(i.viewParameters)}static getDefaultDrawingOptions(e){const i=this._defaultDrawingOptions.clone();return i.updateProperties(e),i}static get supportMultipleDrawings(){return!1}static get typesMap(){return J(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!a(this,$i)}}static computeTelemetryFinalData(e){const i=e.get("hasDescription");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,i;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,e=this.x,i=this.y),super.render(),this._drawId===null)if(a(this,vn)){const{lines:n,mustSmooth:r,areContours:o,description:c,uuid:h,heightInPage:d}=a(this,vn),{rawDims:{pageWidth:u,pageHeight:p},rotation:m}=this.parent.viewport,y=Nt.processDrawnLines({lines:n,pageWidth:u,pageHeight:p,rotation:m,innerMargin:De._INNER_MARGIN,mustSmooth:r,areContours:o});this.addSignature(y,d,c,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return s&&(this._isCopy=!0,this._moveAfterPaste(e,i)),this.div}setUuid(e){g(this,Ya,e),this.addEditToolbar()}getUuid(){return a(this,Ya)}get description(){return a(this,$i)}set description(e){g(this,$i,e),super.addEditToolbar().then(i=>{i==null||i.updateEditSignatureButton(e)})}getSignaturePreview(){const{newCurves:e,areContours:i,thickness:s,width:n,height:r}=a(this,vn),o=Math.max(n,r),c=Nt.processDrawnLines({lines:{curves:e.map(h=>({points:h})),thickness:s,width:n,height:r},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:i});return{areContours:i,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,i,s,n){const{x:r,y:o}=this,{outline:c}=g(this,vn,e);g(this,mn,c instanceof Ng),this.description=s,this.div.setAttribute("data-l10n-args",JSON.stringify({description:s}));let h;a(this,mn)?h=De.getDefaultDrawingOptions():(h=De._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:h});const[d,u]=this.parentDimensions,[,p]=this.pageDimensions;let m=i/p;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(d*this.width,u*this.height),this.x=r,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return Nt.process(e,i,s,n,De._INNER_MARGIN)}getFromText(e,i){const{rawDims:{pageWidth:s,pageHeight:n},rotation:r}=this.parent.viewport;return Nt.extractContoursFromText(e,i,s,n,r,De._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return Nt.processDrawnLines({lines:e,pageWidth:i,pageHeight:s,rotation:n,innerMargin:De._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:i}){e?this._drawingOptions=De.getDefaultDrawingOptions():(this._drawingOptions=De._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":i}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:i,points:s,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,o={annotationType:V.SIGNATURE,isSignature:!0,areContours:a(this,mn),color:[0,0,0],thickness:a(this,mn)?0:r,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(o.paths={lines:i,points:s},o.uuid=a(this,Ya),o.isCopy=!0):o.lines=i,a(this,$i)&&(o.accessibilityData={type:"Figure",alt:a(this,$i)}),o}static deserializeDraw(e,i,s,n,r,o){return o.areContours?Ng.deserialize(e,i,s,n,r,o):ld.deserialize(e,i,s,n,r,o)}static async deserialize(e,i,s){var r;const n=await super.deserialize(e,i,s);return g(n,mn,e.areContours),g(n,$i,((r=e.accessibilityData)==null?void 0:r.alt)||""),g(n,Ya,e.uuid),n}};mn=new WeakMap,$i=new WeakMap,vn=new WeakMap,Ya=new WeakMap,I(De,"_type","signature"),I(De,"_editorType",V.SIGNATURE),I(De,"_defaultDrawingOptions",null);let Hg=De;var bt,qt,bn,Cs,yn,Vo,Ts,Ka,Ui,Ve,Wo,Ja,Tl,Qa,kl,qo,Gd,Xo,Vd,Yo,Wd,Kh,Ug,Ko,qd,qp,Ry;class $g extends gt{constructor(e){super({...e,name:"stampEditor"});f(this,Ja);f(this,Qa);f(this,qo);f(this,Xo);f(this,Yo);f(this,Kh);f(this,Ko);f(this,qp);f(this,bt,null);f(this,qt,null);f(this,bn,null);f(this,Cs,null);f(this,yn,null);f(this,Vo,"");f(this,Ts,null);f(this,Ka,!1);f(this,Ui,null);f(this,Ve,!1);f(this,Wo,!1);g(this,Cs,e.bitmapUrl),g(this,yn,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,i){gt.initialize(e,i)}static isHandlingMimeForPasting(e){return Zd.includes(e)}static paste(e,i){i.pasteEditor({mode:V.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const i=e.get("hasAltText");return{hasAltText:i.get(!0)??0,hasNoAltText:i.get(!1)??0}}async mlGuessAltText(e=null,i=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:r,height:o}=e||this.copyCanvas(null,null,!0).imageData,c=await s.guess({name:"altText",request:{data:n,width:r,height:o,channels:n.length/(r*o)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const h=c.output;return await this.setGuessedAltText(h),i&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var e;a(this,qt)&&(g(this,bt,null),this._uiManager.imageManager.deleteId(a(this,qt)),(e=a(this,Ts))==null||e.remove(),g(this,Ts,null),a(this,Ui)&&(clearTimeout(a(this,Ui)),g(this,Ui,null))),super.remove()}rebuild(){if(!this.parent){a(this,qt)&&v(this,qo,Gd).call(this);return}super.rebuild(),this.div!==null&&(a(this,qt)&&a(this,Ts)===null&&v(this,qo,Gd).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(a(this,bn)||a(this,bt)||a(this,Cs)||a(this,yn)||a(this,qt)||a(this,Ka))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,i;return this._isCopy&&(e=this.x,i=this.y),super.render(),this.div.hidden=!0,this.createAltText(),a(this,Ka)||(a(this,bt)?v(this,Xo,Vd).call(this):v(this,qo,Gd).call(this)),this._isCopy&&this._moveAfterPaste(e,i),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,i){const{id:s,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,i);i.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(g(this,qt,s),n&&g(this,bt,n),g(this,Ka,!1),v(this,Xo,Vd).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,Ui)!==null&&clearTimeout(a(this,Ui)),g(this,Ui,setTimeout(()=>{g(this,Ui,null),v(this,Kh,Ug).call(this)},200))}copyCanvas(e,i,s=!1){var m;e||(e=224);const{width:n,height:r}=a(this,bt),o=new wi;let c=a(this,bt),h=n,d=r,u=null;if(i){if(n>i||r>i){const P=Math.min(i/n,i/r);h=Math.floor(n*P),d=Math.floor(r*P)}u=document.createElement("canvas");const y=u.width=Math.ceil(h*o.sx),b=u.height=Math.ceil(d*o.sy);a(this,Ve)||(c=v(this,Yo,Wd).call(this,y,b));const x=u.getContext("2d");x.filter=this._uiManager.hcmFilter;let w="white",E="#cfcfd8";this._uiManager.hcmFilter!=="none"?E="black":(m=window.matchMedia)!=null&&m.call(window,"(prefers-color-scheme: dark)").matches&&(w="#8f8f9d",E="#42414d");const A=15,_=A*o.sx,S=A*o.sy,T=new OffscreenCanvas(_*2,S*2),C=T.getContext("2d");C.fillStyle=w,C.fillRect(0,0,_*2,S*2),C.fillStyle=E,C.fillRect(0,0,_,S),C.fillRect(_,S,_,S),x.fillStyle=x.createPattern(T,"repeat"),x.fillRect(0,0,y,b),x.drawImage(c,0,0,c.width,c.height,0,0,y,b)}let p=null;if(s){let y,b;if(o.symmetric&&c.width<e&&c.height<e)y=c.width,b=c.height;else if(c=a(this,bt),n>e||r>e){const E=Math.min(e/n,e/r);y=Math.floor(n*E),b=Math.floor(r*E),a(this,Ve)||(c=v(this,Yo,Wd).call(this,y,b))}const w=new OffscreenCanvas(y,b).getContext("2d",{willReadFrequently:!0});w.drawImage(c,0,0,c.width,c.height,0,0,y,b),p={width:y,height:b,data:w.getImageData(0,0,y,b).data}}return{canvas:u,width:h,height:d,imageData:p}}static async deserialize(e,i,s){var x;let n=null,r=!1;if(e instanceof Vb){const{data:{rect:w,rotation:E,id:A,structParent:_,popupRef:S},container:T,parent:{page:{pageNumber:C}},canvas:P}=e;let k,D;P?(delete e.canvas,{id:k,bitmap:D}=s.imageManager.getFromCanvas(T.id,P),P.remove()):(r=!0,e._hasNoCanvas=!0);const M=((x=await i._structTree.getAriaAttributes(`${tm}${A}`))==null?void 0:x.get("aria-label"))||"";n=e={annotationType:V.STAMP,bitmapId:k,bitmap:D,pageIndex:C-1,rect:w.slice(0),rotation:E,annotationElementId:A,id:A,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:_,popupRef:S}}const o=await super.deserialize(e,i,s),{rect:c,bitmap:h,bitmapUrl:d,bitmapId:u,isSvg:p,accessibilityData:m}=e;r?(s.addMissingCanvas(e.id,o),g(o,Ka,!0)):u&&s.imageManager.isValidId(u)?(g(o,qt,u),h&&g(o,bt,h)):g(o,Cs,d),g(o,Ve,p);const[y,b]=o.pageDimensions;return o.width=(c[2]-c[0])/y,o.height=(c[3]-c[1])/b,m&&(o.altTextData=m),o._initialData=n,g(o,Wo,!!n),o}serialize(e=!1,i=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:V.STAMP,bitmapId:a(this,qt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:a(this,Ve),structTreeParentId:this._structTreeParentId};if(e)return s.bitmapUrl=v(this,Ko,qd).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:n,altText:r}=this.serializeAltText(!1);if(!n&&r&&(s.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const c=v(this,qp,Ry).call(this,s);if(c.isSame)return null;c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,i===null)return s;i.stamps||(i.stamps=new Map);const o=a(this,Ve)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!i.stamps.has(a(this,qt)))i.stamps.set(a(this,qt),{area:o,serialized:s}),s.bitmap=v(this,Ko,qd).call(this,!1);else if(a(this,Ve)){const c=i.stamps.get(a(this,qt));o>c.area&&(c.area=o,c.serialized.bitmap.close(),c.serialized.bitmap=v(this,Ko,qd).call(this,!1))}return s}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}bt=new WeakMap,qt=new WeakMap,bn=new WeakMap,Cs=new WeakMap,yn=new WeakMap,Vo=new WeakMap,Ts=new WeakMap,Ka=new WeakMap,Ui=new WeakMap,Ve=new WeakMap,Wo=new WeakMap,Ja=new WeakSet,Tl=function(e,i=!1){if(!e){this.remove();return}g(this,bt,e.bitmap),i||(g(this,qt,e.id),g(this,Ve,e.isSvg)),e.file&&g(this,Vo,e.file.name),v(this,Xo,Vd).call(this)},Qa=new WeakSet,kl=function(){if(g(this,bn,null),this._uiManager.enableWaiting(!1),!!a(this,Ts)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,bt)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,bt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},qo=new WeakSet,Gd=function(){if(a(this,qt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,qt)).then(s=>v(this,Ja,Tl).call(this,s,!0)).finally(()=>v(this,Qa,kl).call(this));return}if(a(this,Cs)){const s=a(this,Cs);g(this,Cs,null),this._uiManager.enableWaiting(!0),g(this,bn,this._uiManager.imageManager.getFromUrl(s).then(n=>v(this,Ja,Tl).call(this,n)).finally(()=>v(this,Qa,kl).call(this)));return}if(a(this,yn)){const s=a(this,yn);g(this,yn,null),this._uiManager.enableWaiting(!0),g(this,bn,this._uiManager.imageManager.getFromFile(s).then(n=>v(this,Ja,Tl).call(this,n)).finally(()=>v(this,Qa,kl).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=Zd.join(",");const i=this._uiManager._signal;g(this,bn,new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),v(this,Ja,Tl).call(this,n)}s()},{signal:i}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:i})}).finally(()=>v(this,Qa,kl).call(this))),e.click()},Xo=new WeakSet,Vd=function(){var u;const{div:e}=this;let{width:i,height:s}=a(this,bt);const[n,r]=this.pageDimensions,o=.75;if(this.width)i=this.width*n,s=this.height*r;else if(i>o*n||s>o*r){const p=Math.min(o*n/i,o*r/s);i*=p,s*=p}const[c,h]=this.parentDimensions;this.setDims(i*c/n,s*h/r),this._uiManager.enableWaiting(!1);const d=g(this,Ts,document.createElement("canvas"));d.setAttribute("role","img"),this.addContainer(d),this.width=i/n,this.height=s/r,(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),v(this,Kh,Ug).call(this),a(this,Wo)||(this.parent.addUndoableEditor(this),g(this,Wo,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,Vo)&&this.div.setAttribute("aria-description",a(this,Vo)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Yo=new WeakSet,Wd=function(e,i){const{width:s,height:n}=a(this,bt);let r=s,o=n,c=a(this,bt);for(;r>2*e||o>2*i;){const h=r,d=o;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*i&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(r,o);u.getContext("2d").drawImage(c,0,0,h,d,0,0,r,o),c=u.transferToImageBitmap()}return c},Kh=new WeakSet,Ug=function(){const[e,i]=this.parentDimensions,{width:s,height:n}=this,r=new wi,o=Math.ceil(s*e*r.sx),c=Math.ceil(n*i*r.sy),h=a(this,Ts);if(!h||h.width===o&&h.height===c)return;h.width=o,h.height=c;const d=a(this,Ve)?a(this,bt):v(this,Yo,Wd).call(this,o,c),u=h.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,o,c)},Ko=new WeakSet,qd=function(e){if(e){if(a(this,Ve)){const n=this._uiManager.imageManager.getSvgUrl(a(this,qt));if(n)return n}const i=document.createElement("canvas");return{width:i.width,height:i.height}=a(this,bt),i.getContext("2d").drawImage(a(this,bt),0,0),i.toDataURL()}if(a(this,Ve)){const[i,s]=this.pageDimensions,n=Math.round(this.width*i*Ds.PDF_TO_CSS_UNITS),r=Math.round(this.height*s*Ds.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,r);return o.getContext("2d").drawImage(a(this,bt),0,0,a(this,bt).width,a(this,bt).height,0,0,n,r),o.transferToImageBitmap()}return structuredClone(a(this,bt))},qp=new WeakSet,Ry=function(e){var o;const{pageIndex:i,accessibilityData:{altText:s}}=this._initialData,n=e.pageIndex===i,r=(((o=e.accessibilityData)==null?void 0:o.alt)||"")===s;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&r,isSameAltText:r}},I($g,"_type","stamp"),I($g,"_editorType",V.STAMP);var Za,Jo,Gi,xn,ks,We,wn,Qo,tr,yi,Ps,Xt,Rs,An,Zo,H,En,Xp,Ly,si,Ci,Jh,Gg,Qh,Vg,tl,Xd;const ri=class ri{constructor({uiManager:t,pageIndex:e,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:r,drawLayer:o,textLayer:c,viewport:h,l10n:d}){f(this,Xp);f(this,si);f(this,Jh);f(this,Qh);f(this,tl);f(this,Za,void 0);f(this,Jo,!1);f(this,Gi,null);f(this,xn,null);f(this,ks,null);f(this,We,new Map);f(this,wn,!1);f(this,Qo,!1);f(this,tr,!1);f(this,yi,null);f(this,Ps,null);f(this,Xt,null);f(this,Rs,null);f(this,An,null);f(this,Zo,-1);f(this,H,void 0);const u=[...a(ri,En).values()];if(!ri._initialized){ri._initialized=!0;for(const p of u)p.initialize(d,t)}t.registerEditorTypes(u),g(this,H,t),this.pageIndex=e,this.div=i,g(this,Za,n),g(this,Gi,r),this.viewport=h,g(this,Xt,c),this.drawLayer=o,this._structTree=s,a(this,H).addLayer(this)}get isEmpty(){return a(this,We).size===0}get isInvisible(){return this.isEmpty&&a(this,H).getMode()===V.NONE}updateToolbar(t){a(this,H).updateToolbar(t)}updateMode(t=a(this,H).getMode()){switch(v(this,tl,Xd).call(this),t){case V.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case V.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case V.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const i of a(ri,En).values())e.toggle(`${i._type}Editing`,t===i._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=a(this,Xt))==null?void 0:e.div)}setEditingState(t){a(this,H).setEditingState(t)}addCommands(t){a(this,H).addCommands(t)}cleanUndoStack(t){a(this,H).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=a(this,Gi))==null||e.div.classList.toggle("disabled",!t)}async enable(){var i;g(this,tr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(i=a(this,An))==null||i.abort(),g(this,An,null);const t=new Set;for(const s of a(this,We).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(a(this,H).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!a(this,Gi)){g(this,tr,!1);return}const e=a(this,Gi).getEditableAnnotations();for(const s of e){if(s.hide(),a(this,H).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const n=await this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}g(this,tr,!1)}disable(){var s;if(g(this,Qo,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),a(this,Xt)&&!a(this,An)){g(this,An,new AbortController);const n=a(this,H).combinedSignal(a(this,An));a(this,Xt).div.addEventListener("pointerdown",r=>{const{clientX:c,clientY:h,timeStamp:d}=r,u=a(this,Zo);if(d-u>500){g(this,Zo,d);return}g(this,Zo,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const m=document.elementsFromPoint(c,h);if(p.toggle("getElements",!1),!this.div.contains(m[0]))return;let y;const b=new RegExp(`^${Av}[0-9]+$`);for(const w of m)if(b.test(w.id)){y=w.id;break}if(!y)return;const x=a(this,We).get(y);(x==null?void 0:x.annotationElementId)===null&&(r.stopPropagation(),r.preventDefault(),x.dblclick())},{signal:n,capture:!0})}const t=new Map,e=new Map;for(const n of a(this,We).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else e.set(n.annotationElementId,n);(s=this.getEditableAnnotation(n.annotationElementId))==null||s.show(),n.remove()}if(a(this,Gi)){const n=a(this,Gi).getEditableAnnotations();for(const r of n){const{id:o}=r.data;if(a(this,H).isDeletedAnnotationElement(o))continue;let c=e.get(o);if(c){c.resetAnnotationElement(r),c.show(!1),r.show();continue}c=t.get(o),c&&(a(this,H).addChangedExistingAnnotation(c),c.renderAnnotationElement(r)&&c.show(!1)),r.show()}}v(this,tl,Xd).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const n of a(ri,En).values())i.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),g(this,Qo,!1)}getEditableAnnotation(t){var e;return((e=a(this,Gi))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){a(this,H).getActive()!==t&&a(this,H).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=a(this,Xt))!=null&&t.div&&!a(this,Rs)){g(this,Rs,new AbortController);const e=a(this,H).combinedSignal(a(this,Rs));a(this,Xt).div.addEventListener("pointerdown",v(this,Xp,Ly).bind(this),{signal:e}),a(this,Xt).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=a(this,Xt))!=null&&t.div&&a(this,Rs)&&(a(this,Rs).abort(),g(this,Rs,null),a(this,Xt).div.classList.remove("highlighting"))}enableClick(){if(a(this,xn))return;g(this,xn,new AbortController);const t=a(this,H).combinedSignal(a(this,xn));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=a(this,xn))==null||t.abort(),g(this,xn,null)}attach(t){a(this,We).set(t.id,t);const{annotationElementId:e}=t;e&&a(this,H).isDeletedAnnotationElement(e)&&a(this,H).removeDeletedAnnotationElement(t)}detach(t){var e;a(this,We).delete(t.id),(e=a(this,Za))==null||e.removePointerInTextLayer(t.contentDiv),!a(this,Qo)&&t.annotationElementId&&a(this,H).addDeletedAnnotationElement(t)}remove(t){this.detach(t),a(this,H).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(a(this,H).addDeletedAnnotationElement(t.annotationElementId),gt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),a(this,H).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!a(this,tr)),a(this,H).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var i;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!a(this,ks)&&(t._focusEventsAllowed=!1,g(this,ks,setTimeout(()=>{g(this,ks,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:a(this,H)._signal}),e.focus())},0))),t._structTreeParentId=(i=a(this,Za))==null?void 0:i.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),i=()=>{t.remove()};this.addCommands({cmd:e,undo:i,mustExec:!1})}getNextId(){return a(this,H).getId()}combinedSignal(t){return a(this,H).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=a(this,si,Ci))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await a(this,H).updateMode(t.mode);const{offsetX:i,offsetY:s}=v(this,Qh,Vg).call(this),n=this.getNextId(),r=v(this,Jh,Gg).call(this,{parent:this,id:n,x:i,y:s,uiManager:a(this,H),isCentered:!0,...e});r&&this.add(r)}async deserialize(t){var e;return await((e=a(ri,En).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,a(this,H)))||null}createAndAddNewEditor(t,e,i={}){const s=this.getNextId(),n=v(this,Jh,Gg).call(this,{parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:a(this,H),isCentered:e,...i});return n&&this.add(n),n}addNewEditor(t={}){this.createAndAddNewEditor(v(this,Qh,Vg).call(this),!0,t)}setSelected(t){a(this,H).setSelected(t)}toggleSelected(t){a(this,H).toggleSelected(t)}unselect(t){a(this,H).unselect(t)}pointerup(t){var s;const{isMac:e}=Yt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!a(this,wn)||(g(this,wn,!1),(s=a(this,si,Ci))!=null&&s.isDrawer&&a(this,si,Ci).supportMultipleDrawings))return;if(!a(this,Jo)){g(this,Jo,!0);return}const i=a(this,H).getMode();if(i===V.STAMP||i===V.SIGNATURE){a(this,H).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var s;if(a(this,H).getMode()===V.HIGHLIGHT&&this.enableTextSelection(),a(this,wn)){g(this,wn,!1);return}const{isMac:e}=Yt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(g(this,wn,!0),(s=a(this,si,Ci))!=null&&s.isDrawer){this.startDrawingSession(t);return}const i=a(this,H).getActive();g(this,Jo,!i||i.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),a(this,yi)){a(this,si,Ci).startDrawing(this,a(this,H),!1,t);return}a(this,H).setCurrentDrawingSession(this),g(this,yi,new AbortController);const e=a(this,H).combinedSignal(a(this,yi));this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(g(this,Ps,null),this.commitOrRemove())},{signal:e}),a(this,si,Ci).startDrawing(this,a(this,H),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&g(this,Ps,e);return}a(this,Ps)&&setTimeout(()=>{var e;(e=a(this,Ps))==null||e.focus(),g(this,Ps,null)},0)}endDrawingSession(t=!1){return a(this,yi)?(a(this,H).setCurrentDrawingSession(null),a(this,yi).abort(),g(this,yi,null),g(this,Ps,null),a(this,si,Ci).endDrawing(t)):null}findNewParent(t,e,i){const s=a(this,H).findParent(e,i);return s===null||s===this?!1:(s.changeParent(t),!0)}commitOrRemove(){return a(this,yi)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,yi)&&a(this,si,Ci).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=a(this,H).getActive())==null?void 0:t.parent)===this&&(a(this,H).commitOrRemove(),a(this,H).setActiveEditor(null)),a(this,ks)&&(clearTimeout(a(this,ks)),g(this,ks,null));for(const i of a(this,We).values())(e=a(this,Za))==null||e.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove();this.div=null,a(this,We).clear(),a(this,H).removeLayer(this)}render({viewport:t}){this.viewport=t,_n(this.div,t);for(const e of a(this,H).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){a(this,H).commitOrRemove(),v(this,tl,Xd).call(this);const e=this.viewport.rotation,i=t.rotation;if(this.viewport=t,_n(this.div,{rotation:i}),e!==i)for(const s of a(this,We).values())s.rotate(i)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return a(this,H).viewParameters.realScale}};Za=new WeakMap,Jo=new WeakMap,Gi=new WeakMap,xn=new WeakMap,ks=new WeakMap,We=new WeakMap,wn=new WeakMap,Qo=new WeakMap,tr=new WeakMap,yi=new WeakMap,Ps=new WeakMap,Xt=new WeakMap,Rs=new WeakMap,An=new WeakMap,Zo=new WeakMap,H=new WeakMap,En=new WeakMap,Xp=new WeakSet,Ly=function(t){a(this,H).unselectAll();const{target:e}=t;if(e===a(this,Xt).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&a(this,Xt).div.contains(e)){const{isMac:i}=Yt.platform;if(t.button!==0||t.ctrlKey&&i)return;a(this,H).showAllEditors("highlight",!0,!0),a(this,Xt).div.classList.add("free"),this.toggleDrawing(),iu.startHighlighting(this,a(this,H).direction==="ltr",{target:a(this,Xt).div,x:t.x,y:t.y}),a(this,Xt).div.addEventListener("pointerup",()=>{a(this,Xt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,H)._signal}),t.preventDefault()}},si=new WeakSet,Ci=function(){return a(ri,En).get(a(this,H).getMode())},Jh=new WeakSet,Gg=function(t){const e=a(this,si,Ci);return e?new e.prototype.constructor(t):null},Qh=new WeakSet,Vg=function(){const{x:t,y:e,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,t),r=Math.max(0,e),o=Math.min(window.innerWidth,t+i),c=Math.min(window.innerHeight,e+s),h=(n+o)/2-t,d=(r+c)/2-e,[u,p]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:u,offsetY:p}},tl=new WeakSet,Xd=function(){for(const t of a(this,We).values())t.isEmpty()&&t.remove()},I(ri,"_initialized",!1),f(ri,En,new Map([Ag,Fg,$g,iu,Hg].map(t=>[t._editorType,t])));let nu=ri;var xi,ye,er,Zh,Yp,Dy,td,Wg,Kp,Iy,ed,qg;const jt=class jt{constructor({pageIndex:t}){f(this,td);f(this,Kp);f(this,ed);f(this,xi,null);f(this,ye,new Map);f(this,er,new Map);this.pageIndex=t}setParent(t){if(!a(this,xi)){g(this,xi,t);return}if(a(this,xi)!==t){if(a(this,ye).size>0)for(const e of a(this,ye).values())e.remove(),t.append(e);g(this,xi,t)}}static get _svgFactory(){return J(this,"_svgFactory",new Nl)}draw(t,e=!1,i=!1){const s=fe(jt,Zh)._++,n=v(this,td,Wg).call(this),r=jt._svgFactory.createElement("defs");n.append(r);const o=jt._svgFactory.createElement("path");r.append(o);const c=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke"),e&&a(this,er).set(s,o);const h=i?v(this,Kp,Iy).call(this,r,c):null,d=jt._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${c}`),this.updateProperties(n,t),a(this,ye).set(s,n),{id:s,clipPathId:`url(#${h})`}}drawOutline(t,e){const i=fe(jt,Zh)._++,s=v(this,td,Wg).call(this),n=jt._svgFactory.createElement("defs");s.append(n);const r=jt._svgFactory.createElement("path");n.append(r);const o=`path_p${this.pageIndex}_${i}`;r.setAttribute("id",o),r.setAttribute("vector-effect","non-scaling-stroke");let c;if(e){const u=jt._svgFactory.createElement("mask");n.append(u),c=`mask_p${this.pageIndex}_${i}`,u.setAttribute("id",c),u.setAttribute("maskUnits","objectBoundingBox");const p=jt._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const m=jt._svgFactory.createElement("use");u.append(m),m.setAttribute("href",`#${o}`),m.setAttribute("stroke","none"),m.setAttribute("fill","black"),m.setAttribute("fill-rule","nonzero"),m.classList.add("mask")}const h=jt._svgFactory.createElement("use");s.append(h),h.setAttribute("href",`#${o}`),c&&h.setAttribute("mask",`url(#${c})`);const d=h.cloneNode();return s.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,t),a(this,ye).set(i,s),i}finalizeDraw(t,e){a(this,er).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var c;if(!e)return;const{root:i,bbox:s,rootClass:n,path:r}=e,o=typeof t=="number"?a(this,ye).get(t):t;if(o){if(i&&v(this,ed,qg).call(this,o,i),s&&v(c=jt,Yp,Dy).call(c,o,s),n){const{classList:h}=o;for(const[d,u]of Object.entries(n))h.toggle(d,u)}if(r){const d=o.firstChild.firstChild;v(this,ed,qg).call(this,d,r)}}}updateParent(t,e){if(e===this)return;const i=a(this,ye).get(t);i&&(a(e,xi).append(i),a(this,ye).delete(t),a(e,ye).set(t,i))}remove(t){a(this,er).delete(t),a(this,xi)!==null&&(a(this,ye).get(t).remove(),a(this,ye).delete(t))}destroy(){g(this,xi,null);for(const t of a(this,ye).values())t.remove();a(this,ye).clear(),a(this,er).clear()}};xi=new WeakMap,ye=new WeakMap,er=new WeakMap,Zh=new WeakMap,Yp=new WeakSet,Dy=function(t,[e,i,s,n]){const{style:r}=t;r.top=`${100*i}%`,r.left=`${100*e}%`,r.width=`${100*s}%`,r.height=`${100*n}%`},td=new WeakSet,Wg=function(){const t=jt._svgFactory.create(1,1,!0);return a(this,xi).append(t),t.setAttribute("aria-hidden",!0),t},Kp=new WeakSet,Iy=function(t,e){const i=jt._svgFactory.createElement("clipPath");t.append(i);const s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=jt._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s},ed=new WeakSet,qg=function(t,e){for(const[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)},f(jt,Yp),f(jt,Zh,0);let au=jt;globalThis._pdfjsTestingUtils={HighlightOutliner:_g};globalThis.pdfjsLib={AbortException:Ls,AnnotationEditorLayer:nu,AnnotationEditorParamsType:Q,AnnotationEditorType:V,AnnotationEditorUIManager:Sn,AnnotationLayer:hm,AnnotationMode:Vi,AnnotationType:Pt,build:Ib,ColorPicker:Ol,createValidAbsoluteUrl:Jg,DOMSVGFactory:Nl,DrawLayer:au,FeatureTest:Yt,fetchData:nl,getDocument:am,getFilenameFromUrl:kv,getPdfFilenameFromUrl:Pv,getUuid:Zg,getXfaPageViewport:Rv,GlobalWorkerOptions:ni,ImageKind:Pl,InvalidPDFException:Qd,isDataScheme:ad,isPdfFile:tf,isValidExplicitDest:hb,MathClamp:de,noContextMenu:ai,normalizeUnicode:Cv,OPS:Ll,OutputScale:wi,PasswordResponses:_v,PDFDataRangeTransport:rm,PDFDateString:ef,PDFWorker:il,PermissionFlag:Ev,PixelsPerInch:Ds,RenderingCancelledException:Zp,ResponseException:Dl,setLayerDimensions:_n,shadow:J,SignatureExtractor:Nt,stopEvent:Dt,SupportedImageMimeTypes:Zd,TextLayer:Ml,TouchManager:Il,updateUrlHash:Qg,Util:$,VerbosityLevel:id,version:om,XfaLayer:lm};const HA=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Ls,AnnotationEditorLayer:nu,AnnotationEditorParamsType:Q,AnnotationEditorType:V,AnnotationEditorUIManager:Sn,AnnotationLayer:hm,AnnotationMode:Vi,AnnotationType:Pt,ColorPicker:Ol,DOMSVGFactory:Nl,DrawLayer:au,FeatureTest:Yt,GlobalWorkerOptions:ni,ImageKind:Pl,InvalidPDFException:Qd,MathClamp:de,OPS:Ll,OutputScale:wi,PDFDataRangeTransport:rm,PDFDateString:ef,PDFWorker:il,PasswordResponses:_v,PermissionFlag:Ev,PixelsPerInch:Ds,RenderingCancelledException:Zp,ResponseException:Dl,SignatureExtractor:Nt,SupportedImageMimeTypes:Zd,TextLayer:Ml,TouchManager:Il,Util:$,VerbosityLevel:id,XfaLayer:lm,build:Ib,createValidAbsoluteUrl:Jg,fetchData:nl,getDocument:am,getFilenameFromUrl:kv,getPdfFilenameFromUrl:Pv,getUuid:Zg,getXfaPageViewport:Rv,isDataScheme:ad,isPdfFile:tf,isValidExplicitDest:hb,noContextMenu:ai,normalizeUnicode:Cv,setLayerDimensions:_n,shadow:J,stopEvent:Dt,updateUrlHash:Qg,version:om},Symbol.toStringTag,{value:"Module"}));function My(l){var t,e,i="";if(typeof l=="string"||typeof l=="number")i+=l;else if(typeof l=="object")if(Array.isArray(l)){var s=l.length;for(t=0;t<s;t++)l[t]&&(e=My(l[t]))&&(i&&(i+=" "),i+=e)}else for(e in l)l[e]&&(i&&(i+=" "),i+=e);return i}function af(){for(var l,t,e=0,i="",s=arguments.length;e<s;e++)(l=arguments[e])&&(t=My(l))&&(i&&(i+=" "),i+=t);return i}var Ym=Object.prototype.hasOwnProperty;function Km(l,t,e){for(e of l.keys())if(xr(e,t))return e}function xr(l,t){var e,i,s;if(l===t)return!0;if(l&&t&&(e=l.constructor)===t.constructor){if(e===Date)return l.getTime()===t.getTime();if(e===RegExp)return l.toString()===t.toString();if(e===Array){if((i=l.length)===t.length)for(;i--&&xr(l[i],t[i]););return i===-1}if(e===Set){if(l.size!==t.size)return!1;for(i of l)if(s=i,s&&typeof s=="object"&&(s=Km(t,s),!s)||!t.has(s))return!1;return!0}if(e===Map){if(l.size!==t.size)return!1;for(i of l)if(s=i[0],s&&typeof s=="object"&&(s=Km(t,s),!s)||!xr(i[1],t.get(s)))return!1;return!0}if(e===ArrayBuffer)l=new Uint8Array(l),t=new Uint8Array(t);else if(e===DataView){if((i=l.byteLength)===t.byteLength)for(;i--&&l.getInt8(i)===t.getInt8(i););return i===-1}if(ArrayBuffer.isView(l)){if((i=l.byteLength)===t.byteLength)for(;i--&&l[i]===t[i];);return i===-1}if(!e||typeof l=="object"){i=0;for(e in l)if(Ym.call(l,e)&&++i&&!Ym.call(t,e)||!(e in t)||!xr(l[e],t[e]))return!1;return Object.keys(t).length===i}}return l!==l&&t!==t}function cd(l){let t=!1;return{promise:new Promise((i,s)=>{l.then(n=>!t&&i(n)).catch(n=>!t&&s(n))}),cancel(){t=!0}}}const $A=["onCopy","onCut","onPaste"],UA=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],GA=["onFocus","onBlur"],VA=["onInput","onInvalid","onReset","onSubmit"],WA=["onLoad","onError"],qA=["onKeyDown","onKeyPress","onKeyUp"],XA=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],YA=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],KA=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],JA=["onSelect"],QA=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],ZA=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],t0=["onScroll"],e0=["onWheel"],i0=["onAnimationStart","onAnimationEnd","onAnimationIteration"],s0=["onTransitionEnd"],n0=["onToggle"],a0=["onChange"],r0=[...$A,...UA,...GA,...VA,...WA,...qA,...XA,...YA,...KA,...JA,...QA,...ZA,...t0,...e0,...i0,...s0,...a0,...n0];function Fy(l,t){const e={};for(const i of r0){const s=l[i];s&&(t?e[i]=n=>s(n,t(i)):e[i]=s)}return e}var o0=!0,Pf="Invariant failed";function pt(l,t){if(!l){if(o0)throw new Error(Pf);var e=typeof t=="function"?t():t,i=e?"".concat(Pf,": ").concat(e):Pf;throw new Error(i)}}var l0=function(){},c0=l0;const ue=av(c0),h0=L.createContext(null),Ny=h0,d0="noopener noreferrer nofollow";class u0{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(t){this.pdfDocument=t}setViewer(t){this.pdfViewer=t}setExternalLinkRel(t){this.externalLinkRel=t}setExternalLinkTarget(t){this.externalLinkTarget=t}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return pt(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber||0}set page(t){pt(this.pdfViewer,"PDF viewer is not initialized."),this.pdfViewer.currentPageNumber=t}get rotation(){return 0}set rotation(t){}goToDestination(t){return new Promise(e=>{pt(this.pdfDocument,"PDF document not loaded."),pt(t,"Destination is not specified."),typeof t=="string"?this.pdfDocument.getDestination(t).then(e):Array.isArray(t)?e(t):t.then(e)}).then(e=>{pt(Array.isArray(e),`"${e}" is not a valid destination array.`);const i=e[0];new Promise(s=>{pt(this.pdfDocument,"PDF document not loaded."),i instanceof Object?this.pdfDocument.getPageIndex(i).then(n=>{s(n)}).catch(()=>{pt(!1,`"${i}" is not a valid page reference.`)}):typeof i=="number"?s(i):pt(!1,`"${i}" is not a valid destination reference.`)}).then(s=>{const n=s+1;pt(this.pdfViewer,"PDF viewer is not initialized."),pt(n>=1&&n<=this.pagesCount,`"${n}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({dest:e,pageIndex:s,pageNumber:n})})})}navigateTo(t){this.goToDestination(t)}goToPage(t){const e=t-1;pt(this.pdfViewer,"PDF viewer is not initialized."),pt(t>=1&&t<=this.pagesCount,`"${t}" is not a valid page number.`),this.pdfViewer.scrollPageIntoView({pageIndex:e,pageNumber:t})}addLinkAttributes(t,e,i){t.href=e,t.rel=this.externalLinkRel||d0,t.target=i?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}function wr({children:l,type:t}){return R.jsx("div",{className:`react-pdf__message react-pdf__message--${t}`,children:l})}const p0={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},Jm=p0;function f0(l,t){switch(t.type){case"RESOLVE":return{value:t.value,error:void 0};case"REJECT":return{value:!1,error:t.error};case"RESET":return{value:void 0,error:void 0};default:return l}}function sl(){return L.useReducer(f0,{value:void 0,error:void 0})}const rf=typeof window<"u",Oy=rf&&window.location.protocol==="file:";function g0(l){return typeof l<"u"}function Cn(l){return g0(l)&&l!==null}function m0(l){return typeof l=="string"}function v0(l){return l instanceof ArrayBuffer}function b0(l){return pt(rf,"isBlob can only be used in a browser environment"),l instanceof Blob}function Xg(l){return m0(l)&&/^data:/.test(l)}function Qm(l){pt(Xg(l),"Invalid data URI.");const[t="",e=""]=l.split(",");return t.split(";").indexOf("base64")!==-1?atob(e):unescape(e)}function y0(){return rf&&window.devicePixelRatio||1}const jy="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function Zm(){ue(!Oy,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${jy}`)}function x0(){ue(!Oy,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${jy}`)}function sr(l){l!=null&&l.cancel&&l.cancel()}function Yg(l,t){return Object.defineProperty(l,"width",{get(){return this.view[2]*t},configurable:!0}),Object.defineProperty(l,"height",{get(){return this.view[3]*t},configurable:!0}),Object.defineProperty(l,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(l,"originalHeight",{get(){return this.view[3]},configurable:!0}),l}function w0(l){return l.name==="RenderingCancelledException"}function A0(l){return new Promise((t,e)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return e(new Error("Error while reading a file."));t(i.result)},i.onerror=s=>{if(!s.target)return e(new Error("Error while reading a file."));const{error:n}=s.target;if(!n)return e(new Error("Error while reading a file."));switch(n.code){case n.NOT_FOUND_ERR:return e(new Error("Error while reading a file: File not found."));case n.SECURITY_ERR:return e(new Error("Error while reading a file: Security error."));case n.ABORT_ERR:return e(new Error("Error while reading a file: Aborted."));default:return e(new Error("Error while reading a file."))}},i.readAsArrayBuffer(l)})}const{PDFDataRangeTransport:E0}=HA,_0=(l,t)=>{switch(t){case Jm.NEED_PASSWORD:{const e=prompt("Enter the password to open this PDF file.");l(e);break}case Jm.INCORRECT_PASSWORD:{const e=prompt("Invalid password. Please try again.");l(e);break}}};function tv(l){return typeof l=="object"&&l!==null&&("data"in l||"range"in l||"url"in l)}const S0=L.forwardRef(function({children:t,className:e,error:i="Failed to load PDF file.",externalLinkRel:s,externalLinkTarget:n,file:r,inputRef:o,imageResourcesPath:c,loading:h="Loading PDF",noData:d="No PDF file specified.",onItemClick:u,onLoadError:p,onLoadProgress:m,onLoadSuccess:y,onPassword:b=_0,onSourceError:x,onSourceSuccess:w,options:E,renderMode:A,rotate:_,scale:S,...T},C){const[P,k]=sl(),{value:D,error:M}=P,[q,G]=sl(),{value:O,error:X}=q,F=L.useRef(new u0),N=L.useRef([]),ft=L.useRef(void 0),et=L.useRef(void 0);r&&r!==ft.current&&tv(r)&&(ue(!xr(r,ft.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),ft.current=r),E&&E!==et.current&&(ue(!xr(E,et.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),et.current=E);const pe=L.useRef({scrollPageIntoView:Z=>{const{dest:ct,pageNumber:_t,pageIndex:kt=_t-1}=Z;if(u){u({dest:ct,pageIndex:kt,pageNumber:_t});return}const Le=N.current[kt];if(Le){Le.scrollIntoView();return}ue(!1,`An internal link leading to page ${_t} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});L.useImperativeHandle(C,()=>({linkService:F,pages:N,viewer:pe}),[]);function ne(){w&&w()}function nt(){M&&(ue(!1,M.toString()),x&&x(M))}function st(){k({type:"RESET"})}L.useEffect(st,[r,k]);const Tt=L.useCallback(async()=>{if(!r)return null;if(typeof r=="string")return Xg(r)?{data:Qm(r)}:(Zm(),{url:r});if(r instanceof E0)return{range:r};if(v0(r))return{data:r};if(rf&&b0(r))return{data:await A0(r)};if(pt(typeof r=="object","Invalid parameter in file, need either Uint8Array, string or a parameter object"),pt(tv(r),"Invalid parameter object: need either .data, .range or .url"),"url"in r&&typeof r.url=="string"){if(Xg(r.url)){const{url:Z,...ct}=r;return{data:Qm(Z),...ct}}Zm()}return r},[r]);L.useEffect(()=>{const Z=cd(Tt());return Z.promise.then(ct=>{k({type:"RESOLVE",value:ct})}).catch(ct=>{k({type:"REJECT",error:ct})}),()=>{sr(Z)}},[Tt,k]),L.useEffect(()=>{if(!(typeof D>"u")){if(D===!1){nt();return}ne()}},[D]);function Kt(){O&&(y&&y(O),N.current=new Array(O.numPages),F.current.setDocument(O))}function xt(){X&&(ue(!1,X.toString()),p&&p(X))}L.useEffect(function(){G({type:"RESET"})},[G,D]),L.useEffect(function(){if(!D)return;const ct=E?{...D,...E}:D,_t=am(ct);m&&(_t.onProgress=m),b&&(_t.onPassword=b);const kt=_t,Le=kt.promise.then(Wi=>{G({type:"RESOLVE",value:Wi})}).catch(Wi=>{kt.destroyed||G({type:"REJECT",error:Wi})});return()=>{Le.finally(()=>kt.destroy())}},[E,G,D]),L.useEffect(()=>{if(!(typeof O>"u")){if(O===!1){xt();return}Kt()}},[O]),L.useEffect(function(){F.current.setViewer(pe.current),F.current.setExternalLinkRel(s),F.current.setExternalLinkTarget(n)},[s,n]);const it=L.useCallback((Z,ct)=>{N.current[Z]=ct},[]),Re=L.useCallback(Z=>{delete N.current[Z]},[]),we=L.useMemo(()=>({imageResourcesPath:c,linkService:F.current,onItemClick:u,pdf:O,registerPage:it,renderMode:A,rotate:_,scale:S,unregisterPage:Re}),[c,u,O,it,A,_,S,Re]),rt=L.useMemo(()=>Fy(T,()=>O),[T,O]);function Ae(){function Z(_t){return!!(_t!=null&&_t.pdf)}if(!Z(we))throw new Error("pdf is undefined");const ct=typeof t=="function"?t(we):t;return R.jsx(Ny.Provider,{value:we,children:ct})}function ae(){return r?O==null?R.jsx(wr,{type:"loading",children:typeof h=="function"?h():h}):O===!1?R.jsx(wr,{type:"error",children:typeof i=="function"?i():i}):Ae():R.jsx(wr,{type:"no-data",children:typeof d=="function"?d():d})}return R.jsx("div",{className:af("react-pdf__Document",e),ref:o,...rt,children:ae()})}),C0=S0;function By(){return L.useContext(Ny)}function zy(){for(var l=[],t=0;t<arguments.length;t++)l[t]=arguments[t];var e=l.filter(Boolean);if(e.length<=1){var i=e[0];return i||null}return function(n){for(var r=0,o=e;r<o.length;r++){var c=o[r];typeof c=="function"?c(n):c&&(c.current=n)}}}const T0=L.createContext(null),Hy=T0;function of(){return L.useContext(Hy)}function k0(){const l=By(),t=of();pt(t,"Unable to find Page context.");const e={...l,...t},{imageResourcesPath:i,linkService:s,onGetAnnotationsError:n,onGetAnnotationsSuccess:r,onRenderAnnotationLayerError:o,onRenderAnnotationLayerSuccess:c,page:h,pdf:d,renderForms:u,rotate:p,scale:m=1}=e;pt(d,"Attempted to load page annotations, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop."),pt(h,"Attempted to load page annotations, but no page was specified."),pt(s,"Attempted to load page annotations, but no linkService was specified.");const[y,b]=sl(),{value:x,error:w}=y,E=L.useRef(null);ue(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function A(){x&&r&&r(x)}function _(){w&&(ue(!1,w.toString()),n&&n(w))}L.useEffect(function(){b({type:"RESET"})},[b,h]),L.useEffect(function(){if(!h)return;const k=cd(h.getAnnotations()),D=k;return k.promise.then(M=>{b({type:"RESOLVE",value:M})}).catch(M=>{b({type:"REJECT",error:M})}),()=>{sr(D)}},[b,h]),L.useEffect(()=>{if(x!==void 0){if(x===!1){_();return}A()}},[x]);function S(){c&&c()}function T(P){ue(!1,`${P}`),o&&o(P)}const C=L.useMemo(()=>h.getViewport({scale:m,rotation:p}),[h,p,m]);return L.useEffect(function(){if(!d||!h||!s||!x)return;const{current:k}=E;if(!k)return;const D=C.clone({dontFlip:!0}),M={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:k,l10n:null,page:h,structTreeLayer:null,viewport:D},q={annotations:x,annotationStorage:d.annotationStorage,div:k,imageResourcesPath:i,linkService:s,page:h,renderForms:u,viewport:D};k.innerHTML="";try{new hm(M).render(q),S()}catch(G){T(G)}return()=>{}},[x,i,s,h,d,u,C]),R.jsx("div",{className:af("react-pdf__Page__annotations","annotationLayer"),ref:E})}const $y={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},P0=/^H(\d+)$/;function R0(l){return l in $y}function lf(l){return"children"in l}function Uy(l){return lf(l)?l.children.length===1&&0 in l.children&&"id"in l.children[0]:!1}function L0(l){const t={};if(lf(l)){const{role:e}=l,i=e.match(P0);if(i)t.role="heading",t["aria-level"]=Number(i[1]);else if(R0(e)){const s=$y[e];s&&(t.role=s)}}return t}function Gy(l){const t={};if(lf(l)){if(l.alt!==void 0&&(t["aria-label"]=l.alt),l.lang!==void 0&&(t.lang=l.lang),Uy(l)){const[e]=l.children;if(e){const i=Gy(e);return{...t,...i}}}}else"id"in l&&(t["aria-owns"]=l.id);return t}function D0(l){return l?{...L0(l),...Gy(l)}:null}function Vy({className:l,node:t}){const e=L.useMemo(()=>D0(t),[t]),i=L.useMemo(()=>!lf(t)||Uy(t)?null:t.children.map((s,n)=>R.jsx(Vy,{node:s},n)),[t]);return R.jsx("span",{className:l,...e,children:i})}function I0(){const l=of();pt(l,"Unable to find Page context.");const{onGetStructTreeError:t,onGetStructTreeSuccess:e}=l,[i,s]=sl(),{value:n,error:r}=i,{customTextRenderer:o,page:c}=l;function h(){n&&e&&e(n)}function d(){r&&(ue(!1,r.toString()),t&&t(r))}return L.useEffect(function(){s({type:"RESET"})},[s,c]),L.useEffect(function(){if(o||!c)return;const p=cd(c.getStructTree()),m=p;return p.promise.then(y=>{s({type:"RESOLVE",value:y})}).catch(y=>{s({type:"REJECT",error:y})}),()=>sr(m)},[o,c,s]),L.useEffect(()=>{if(n!==void 0){if(n===!1){d();return}h()}},[n]),n?R.jsx(Vy,{className:"react-pdf__Page__structTree structTree",node:n}):null}const ev=Vi;function M0(l){const t=of();pt(t,"Unable to find Page context.");const e={...t,...l},{_className:i,canvasBackground:s,devicePixelRatio:n=y0(),onRenderError:r,onRenderSuccess:o,page:c,renderForms:h,renderTextLayer:d,rotate:u,scale:p}=e,{canvasRef:m}=l;pt(c,"Attempted to render page canvas, but no page was specified.");const y=L.useRef(null);function b(){c&&o&&o(Yg(c,p))}function x(_){w0(_)||(ue(!1,_.toString()),r&&r(_))}const w=L.useMemo(()=>c.getViewport({scale:p*n,rotation:u}),[n,c,u,p]),E=L.useMemo(()=>c.getViewport({scale:p,rotation:u}),[c,u,p]);L.useEffect(function(){if(!c)return;c.cleanup();const{current:S}=y;if(!S)return;S.width=w.width,S.height=w.height,S.style.width=`${Math.floor(E.width)}px`,S.style.height=`${Math.floor(E.height)}px`,S.style.visibility="hidden";const T={annotationMode:h?ev.ENABLE_FORMS:ev.ENABLE,canvasContext:S.getContext("2d",{alpha:!1}),viewport:w};s&&(T.background=s);const C=c.render(T),P=C;return C.promise.then(()=>{S.style.visibility="",b()}).catch(x),()=>sr(P)},[s,c,h,w,E]);const A=L.useCallback(()=>{const{current:_}=y;_&&(_.width=0,_.height=0)},[]);return L.useEffect(()=>A,[A]),R.jsx("canvas",{className:`${i}__canvas`,dir:"ltr",ref:zy(m,y),style:{display:"block",userSelect:"none"},children:d?R.jsx(I0,{}):null})}function F0(l){return"str"in l}function N0(){const l=of();pt(l,"Unable to find Page context.");const{customTextRenderer:t,onGetTextError:e,onGetTextSuccess:i,onRenderTextLayerError:s,onRenderTextLayerSuccess:n,page:r,pageIndex:o,pageNumber:c,rotate:h,scale:d}=l;pt(r,"Attempted to load page text content, but no page was specified.");const[u,p]=sl(),{value:m,error:y}=u,b=L.useRef(null);ue(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function x(){m&&i&&i(m)}function w(){y&&(ue(!1,y.toString()),e&&e(y))}L.useEffect(function(){p({type:"RESET"})},[r,p]),L.useEffect(function(){if(!r)return;const P=cd(r.getTextContent()),k=P;return P.promise.then(D=>{p({type:"RESOLVE",value:D})}).catch(D=>{p({type:"REJECT",error:D})}),()=>sr(k)},[r,p]),L.useEffect(()=>{if(m!==void 0){if(m===!1){w();return}x()}},[m]);const E=L.useCallback(()=>{n&&n()},[n]),A=L.useCallback(C=>{ue(!1,C.toString()),s&&s(C)},[s]);function _(){const C=b.current;C&&C.classList.add("selecting")}function S(){const C=b.current;C&&C.classList.remove("selecting")}const T=L.useMemo(()=>r.getViewport({scale:d,rotation:h}),[r,h,d]);return L.useLayoutEffect(function(){if(!r||!m)return;const{current:P}=b;if(!P)return;P.innerHTML="";const k=r.streamTextContent({includeMarkedContent:!0}),D={container:P,textContentSource:k,viewport:T},M=new Ml(D),q=M;return M.render().then(()=>{const G=document.createElement("div");G.className="endOfContent",P.append(G);const O=P.querySelectorAll('[role="presentation"]');if(t){let X=0;m.items.forEach((F,N)=>{if(!F0(F))return;const ft=O[X];if(!ft)return;const et=t({pageIndex:o,pageNumber:c,itemIndex:N,...F});ft.innerHTML=et,X+=F.str&&F.hasEOL?2:1})}E()}).catch(A),()=>sr(q)},[t,A,E,r,o,c,m,T]),R.jsx("div",{className:af("react-pdf__Page__textContent","textLayer"),onMouseUp:S,onMouseDown:_,ref:b})}const iv=1;function O0(l){const e={...By(),...l},{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:s=!0,canvasBackground:n,canvasRef:r,children:o,className:c,customRenderer:h,customTextRenderer:d,devicePixelRatio:u,error:p="Failed to load the page.",height:m,inputRef:y,loading:b="Loading page",noData:x="No page specified.",onGetAnnotationsError:w,onGetAnnotationsSuccess:E,onGetStructTreeError:A,onGetStructTreeSuccess:_,onGetTextError:S,onGetTextSuccess:T,onLoadError:C,onLoadSuccess:P,onRenderAnnotationLayerError:k,onRenderAnnotationLayerSuccess:D,onRenderError:M,onRenderSuccess:q,onRenderTextLayerError:G,onRenderTextLayerSuccess:O,pageIndex:X,pageNumber:F,pdf:N,registerPage:ft,renderAnnotationLayer:et=!0,renderForms:pe=!1,renderMode:ne="canvas",renderTextLayer:nt=!0,rotate:st,scale:Tt=iv,unregisterPage:Kt,width:xt,...it}=e,[Re,we]=sl(),{value:rt,error:Ae}=Re,ae=L.useRef(null);pt(N,"Attempted to load a page, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop.");const Z=Cn(F)?F-1:X??null,ct=F??(Cn(X)?X+1:null),_t=st??(rt?rt.rotate:null),kt=L.useMemo(()=>{if(!rt)return null;let ht=1;const Mt=Tt??iv;if(xt||m){const Ee=rt.getViewport({scale:1,rotation:_t});xt?ht=xt/Ee.width:m&&(ht=m/Ee.height)}return Mt*ht},[m,rt,_t,Tt,xt]);L.useEffect(function(){return()=>{Cn(Z)&&s&&Kt&&Kt(Z)}},[s,N,Z,Kt]);function Le(){if(P){if(!rt||!kt)return;P(Yg(rt,kt))}if(s&&ft){if(!Cn(Z)||!ae.current)return;ft(Z,ae.current)}}function Wi(){Ae&&(ue(!1,Ae.toString()),C&&C(Ae))}L.useEffect(function(){we({type:"RESET"})},[we,N,Z]),L.useEffect(function(){if(!N||!ct)return;const Mt=cd(N.getPage(ct)),Ee=Mt;return Mt.promise.then(Ai=>{we({type:"RESOLVE",value:Ai})}).catch(Ai=>{we({type:"REJECT",error:Ai})}),()=>sr(Ee)},[we,N,ct]),L.useEffect(()=>{if(rt!==void 0){if(rt===!1){Wi();return}Le()}},[rt,kt]);const Is=L.useMemo(()=>Cn(Z)&&ct&&Cn(_t)&&Cn(kt)?{_className:i,canvasBackground:n,customTextRenderer:d,devicePixelRatio:u,onGetAnnotationsError:w,onGetAnnotationsSuccess:E,onGetStructTreeError:A,onGetStructTreeSuccess:_,onGetTextError:S,onGetTextSuccess:T,onRenderAnnotationLayerError:k,onRenderAnnotationLayerSuccess:D,onRenderError:M,onRenderSuccess:q,onRenderTextLayerError:G,onRenderTextLayerSuccess:O,page:rt,pageIndex:Z,pageNumber:ct,renderForms:pe,renderTextLayer:nt,rotate:_t,scale:kt}:null,[i,n,d,u,w,E,A,_,S,T,k,D,M,q,G,O,rt,Z,ct,pe,nt,_t,kt]),or=L.useMemo(()=>Fy(it,()=>rt&&(kt?Yg(rt,kt):void 0)),[it,rt,kt]),lr=`${Z}@${kt}/${_t}`;function cf(){switch(ne){case"custom":return pt(h,'renderMode was set to "custom", but no customRenderer was passed.'),R.jsx(h,{},`${lr}_custom`);case"none":return null;case"canvas":default:return R.jsx(M0,{canvasRef:r},`${lr}_canvas`)}}function hf(){return nt?R.jsx(N0,{},`${lr}_text`):null}function j(){return et?R.jsx(k0,{},`${lr}_annotations`):null}function U(){function ht(Ee){return!!(Ee!=null&&Ee.page)}if(!ht(Is))throw new Error("page is undefined");const Mt=typeof o=="function"?o(Is):o;return R.jsxs(Hy.Provider,{value:Is,children:[cf(),hf(),j(),Mt]})}function St(){return ct?N===null||rt===void 0||rt===null?R.jsx(wr,{type:"loading",children:typeof b=="function"?b():b}):N===!1||rt===!1?R.jsx(wr,{type:"error",children:typeof p=="function"?p():p}):U():R.jsx(wr,{type:"no-data",children:typeof x=="function"?x():x})}return R.jsx("div",{className:af(i,c),"data-page-number":ct,ref:zy(y,ae),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${kt}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:n||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...or,children:St()})}x0();ni.workerSrc="pdf.worker.mjs";ni.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${om}/pdf.worker.min.js`;const q0=({file:l,className:t="",showControls:e=!0,maxWidth:i=600,onPageChange:s,selectedPages:n=[]})=>{const[r,o]=L.useState(0),[c,h]=L.useState(1),[d,u]=L.useState(1),[p,m]=L.useState(0),[y,b]=L.useState(!0),[x,w]=L.useState(null);L.useEffect(()=>{h(1),u(1),m(0),w(null)},[l]);const E=({numPages:k})=>{o(k),b(!1),w(null)},A=k=>{console.error("Error loading PDF:",k),w("Failed to load PDF. Please make sure the file is a valid PDF document."),b(!1)},_=k=>{const D=c+k;D>=1&&D<=r&&(h(D),s==null||s(D))},S=k=>{k>=1&&k<=r&&(h(k),s==null||s(k))},T=()=>u(k=>Math.min(k+.2,2)),C=()=>u(k=>Math.max(k-.2,.5)),P=()=>m(k=>(k+90)%360);return l?R.jsxs("div",{className:`bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden ${t}`,children:[e&&R.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:R.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("button",{onClick:()=>_(-1),disabled:c<=1||y,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous page",children:R.jsx(tx,{className:"w-5 h-5"})}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("input",{type:"number",min:"1",max:r,value:c,onChange:k=>S(parseInt(k.target.value)||1),className:"w-16 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),R.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["of ",r||""]})]}),R.jsx("button",{onClick:()=>_(1),disabled:c>=r||y,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed",title:"Next page",children:R.jsx(ex,{className:"w-5 h-5"})})]}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("button",{onClick:C,disabled:d<=.5,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom out",children:R.jsx(ix,{className:"w-5 h-5"})}),R.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400 min-w-[3rem] text-center",children:[Math.round(d*100),"%"]}),R.jsx("button",{onClick:T,disabled:d>=2,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed",title:"Zoom in",children:R.jsx(sx,{className:"w-5 h-5"})}),R.jsx("button",{onClick:P,className:"p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400",title:"Rotate",children:R.jsx(nx,{className:"w-5 h-5"})})]})]})}),R.jsxs("div",{className:"p-4",children:[y&&R.jsxs("div",{className:"flex items-center justify-center p-8",children:[R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),R.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading PDF..."})]}),x&&R.jsx("div",{className:"flex items-center justify-center p-8 text-red-600 dark:text-red-400",children:R.jsx("p",{children:x})}),!y&&!x&&R.jsx("div",{className:"flex justify-center",children:R.jsx("div",{className:`border border-gray-300 dark:border-gray-600 shadow-lg ${n.includes(c)?"ring-2 ring-blue-500":""}`,style:{maxWidth:`${i}px`},children:R.jsx(C0,{file:l,onLoadSuccess:E,onLoadError:A,loading:"",error:"",children:R.jsx(O0,{pageNumber:c,scale:d,rotate:p,width:i,loading:"",error:""})})})})]})]}):R.jsx("div",{className:`flex items-center justify-center p-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg ${t}`,children:R.jsxs("div",{className:"text-center space-y-2",children:[R.jsx(Zy,{className:"w-12 h-12 text-gray-400 mx-auto"}),R.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No PDF file selected"})]})})},X0=({status:l,progress:t=0,message:e,onDownload:i,downloadFileName:s,className:n=""})=>{const r=()=>{switch(l){case"processing":return R.jsx(ox,{className:"w-6 h-6 text-blue-500 animate-spin"});case"success":return R.jsx(rx,{className:"w-6 h-6 text-green-500"});case"error":return R.jsx(rv,{className:"w-6 h-6 text-red-500"});default:return null}},o=()=>{switch(l){case"processing":return"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800"}},c=()=>{switch(l){case"processing":return e||"Processing PDF...";case"success":return e||"PDF processed successfully!";case"error":return e||"An error occurred while processing the PDF.";default:return e||"Ready to process"}};return l==="idle"?null:R.jsx("div",{className:`border rounded-lg p-4 ${o()} ${n}`,children:R.jsxs("div",{className:"flex items-start space-x-3",children:[r(),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"flex items-center justify-between",children:[R.jsx("p",{className:`text-sm font-medium ${l==="error"?"text-red-700 dark:text-red-300":l==="success"?"text-green-700 dark:text-green-300":"text-blue-700 dark:text-blue-300"}`,children:c()}),l==="success"&&i&&R.jsxs("button",{onClick:i,className:"ml-3 inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[R.jsx(ax,{className:"w-3 h-3 mr-1"}),"Download"]})]}),s&&l==="success"&&R.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["File: ",s]}),l==="processing"&&t>0&&R.jsxs("div",{className:"mt-2",children:[R.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[R.jsx("span",{children:"Progress"}),R.jsxs("span",{children:[Math.round(t),"%"]})]}),R.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:R.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${Math.min(t,100)}%`}})})]}),l==="processing"&&t===0&&R.jsx("div",{className:"mt-2",children:R.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:R.jsx("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse",style:{width:"30%"}})})})]})]})})};export{G0 as F,V0 as P,X0 as a,q0 as b};
